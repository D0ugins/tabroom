<%args>
	$tourn
	$tourn_settings
	$category_id
	$from          => undef
	$last_id       => undef
	$school_id     => undef
	$only_category => undef
</%args>
<%init>

	my $category = Tab::Category->retrieve($category_id);
	$category = $only_category if $only_category;
	my $school = Tab::School->retrieve($school_id) if $school_id;

	my $last = Tab::Judge->retrieve($last_id) if $last_id;

</%init>


%	if ($school) { 
		<& 
			"/register/menubar.mas", 
			school         => $school,
			whoami         => "judges",
			tourn          => $tourn,
			tourn_settings => $tourn_settings
		&>
%	} else { 

		<& 	"menu.mas",
			only_category  => $only_category,
			category       => $category,
			whoami         => "add",
			tourn          => $tourn,
			tourn_settings => $tourn_settings,
			last           => $last
		&>
		<div class="main">
%	}

		<h4>Add a judge by Tabroom account</h4>

			<table>

				<tr class="yellowrow centeralign">
		
					<td>
						<form action="add_save.mhtml" method="post">
						<input type="hidden" name="category_id" value="<% $category->id %>">
						<input type="hidden" name="from" value="1">
						<input type="email" name="email" placeholder="Email address" size="25">
					</td>

%					if ($category->setting("rounds_per")) { 

						<td>
							<input type="number" name="obligation" placeholder="Rounds" size="4" min=0 max=9999>
						</td>

						<td>
							<input type="number" name="hired" placeholder="Hired" size="4" min=0 max=9999>
						</td>
%					}

					<td>
						<select name="school_id" class="chosen fixedsmall" tabindex="-1">

							<option value="">Hired Judge</option>

%							foreach my $school ($tourn->schools) { 
								<option value="<% $school->id %>" <% $school->id == $school_id ? "selected" : "" %>> <% $school->name %> </option>
%							}
						</select>
					</td>

					<td>
						<input type="submit" value="Go" tabindex="-1" class="thin">
						</form>
					</td>

				</tr>

			</table>

			<h4 class="martop">Or, add a judge without an Tabroom account</h4>

			<table>

				<tr class="row">

					<td>
						<form action="add_save.mhtml" method="post">
						<input type="hidden" name="from" value="1">
						<input type="hidden" name="category_id" value="<% $category->id %>">
						First name
					</td>

					<td>
						<input type="text" name="first" placeholder="First name">
					</td>

				</tr>

				<tr class="row">

					<td>
						Last name
					</td>

					<td>
						<input type="text" name="last" placeholder="Last name">
					</td>

				</tr>

				<tr class="row">

					<td>
						ADA access required?
					</td>

					<td class="nospace">
						<label for="ada">
							<span class="quarter padleftmore hover">
							<input type="checkbox" id="ada" class="largecheck" name="ada" value="1">
							</span>
						</label>
					</td>

				</tr>

%				if ($category->setting("judge_contacts")) { 

					<tr class="row">

						<td>
							Phone Number
						</td>

						<td>
							<input type="tel" name="phone" size="30">
						</td>

					</tr>

%				}

%				if ($category->setting("tab_ratings")) { 

					<tr class="row">

						<td>
							Tab Rating
						</td>

						<td>
							<input type="number" name="tab_rating" value="">
						</td>

					</tr>
%				}

%				if ($category->setting("track_diversity")) { 

					<tr class="row">

						<td>
							Diversity Enhancing
						</td>

						<td class="nospace">
							<label for="diversity">
								<span class="quarter padleftmore hover">
									<input type="checkbox" id="diversity" name="track_diversity" value="1">
								</span>
							</label>
						</td>

					</tr>
%				}

				<tr class="row">

					<td>
						Gender
					</td>

					<td class="nospace">
						<label for="female">
							<span class="hover quarter padleftmore">
								Female <input type="radio" name="gender" value="F" id="female">
							</span>
						</label>
						<label for="male">
							<span class="hover quarter padleftmore">
								Male <input type="radio" name="gender" value="M" id="male">
							</span>
						</label>
						<label for="other">
							<span class="hover quarter padleftmore">
								Other <input type="radio" name="gender" value="O" id="other">
							</span>
						</label>
					</td>

				</tr>

				<tr class="row">

					<td>
						School:
					</td>

					<td>

						<select name="school_id" class="chosen fixed">

							<option value="">Hired Judge</option>

%							foreach my $school ($tourn->schools) { 
								<option value="<% $school->id %>" <% $school->id == $school_id ? "selected" : "" %>> <% $school->name %> </option>
%							}

						</select>

					</td>

				</tr>

%				if ($category->setting("rounds_per")) { 

					<tr class="row">

						<td>
							Rounds for school:
						</td>

						<td>
							<input type="number" name="obligation" size="5">
						</td>

					</tr>

					<tr class="row">

						<td>
							Rounds for hire:
						</td>

						<td>
							<input type="number" name="hired" size="5">
						</td>

					</tr>

%				}

%				if ($category->setting("coach_ratings")) { 

					<tr class="row">

						<td>
							Coach Rating
						</td>

						<td>

%						if ($category->rating_subsets) { 

% 							foreach my $subset ($category->rating_subsets) { 

									<span class="smallspan">
										<% $subset->name %>
									</span>
						
									<select name="<% $subset->id %>_rating" class="fixedsmall">
										<option value="">Unrated</option>
	
%										foreach my $tier (sort {$a->name cmp $b->name} $category->rating_tiers(type => "coach")) { 

											<option value="<% $tier->id %>">
												<% $tier->name %> - <% substr($tier->description,0,15) %>
											</option>
%										}

									</select>
%							} 

%						}  else { 

							<select name="rating">

								<option value="">
									Unrated
								</option>

%								foreach my $tier (sort {$a->name cmp $b->name} $category->rating_tiers(type => "coach")) { 
									<option value="<% $tier->id %>">
										<% $tier->name %> - <% substr($tier->description,0,15) %>
									</option>
%								}

							</select>
		
%						}

						</td>

					</tr>

%				}

%				if ($category->setting("first_year_outs")) {

					<tr class="row">

						<td>
							First year judging?
						</td>

						<td>
							<input type="checkbox" name="first_year" value="1">
						</td>

 					</tr>

%				}

				<tr class="row">

					<td>
						Tab/Special Job 
					</td>
		
					<td>
						<input type="text" name="special" size="33">
					</td>

				</tr> 
		
				<tr class="row">

					<td>
						Coaches Notes
					</td>

					<td>
						<input type="text" name="notes" size="33">
					</td>

				</tr>

% 				if ($category->jpools) {
				
					<tr class="row">

						<td>
							Judge Pools
						</td>

						<td>

%							foreach my $jpool ($category->jpools) { 

								<label for="<% $jpool->id %>">

									<span class="hover third nospace">
										<span class="threequarter nowrap">
											<% $jpool->name %>
										</span>
										<span class="quarter centeralign">
											<input type="checkbox" class="largecheck" name="<% $jpool->id %>" value="1" id="<% $jpool->id %>">
										</span>

									</span>
								</label>

%							} 
						</td>

					</tr>
%				} 

				<tr class="liblrow">

					<td colspan="2" class="rightalign">
						<input type="submit" value="Save and Add Another">
					</td>

				</tr>

			</table>

	</div>

%	if ($school) { 
		<& /register/school/judge_menu.mas, school => $school, tourn => $tourn &>
%	}

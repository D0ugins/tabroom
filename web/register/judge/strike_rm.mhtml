<%args> 
	$tourn
	$person
	$target_id => undef
</%args>
<%init>

	$m->clear_buffer();
	$r->content_type('application/json');

	unless ($target_id) { 
		$m->print('{ "error": true, "message": "No strike ID sent"}');
		$m->abort();
	}

	my $strike = Tab::Strike->retrieve($target_id);

	unless ($strike) { 
		$m->print('{ "error": true, "message": "No strike/constraint found for ID '.$target_id.'"}');
		$m->abort();
	}

	my $judge = $strike->judge;
	my $message = $m->comp(
		"/funclib/strike_name.mas", 
		nohtml => 1,
		strike => $strike
	)." removed for judge ".$judge->first." ".$judge->last;

	$strike->delete();

	$m->print('{ 
		"error": false, 
		"message": "'.$message.'"
	}');

	my $now = DateTime->now();

    Tab::ChangeLog->create({
        type        => 'tabbing',
        category    => $judge->category->id,
        tourn       => $tourn->id,
        person      => $person->id,
        created     => $now,
        description => $message
    });

	$m->abort();

</%init>

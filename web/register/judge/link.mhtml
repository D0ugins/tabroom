<%args>
	$tourn
	$judge_id
	$email => undef
</%args>
<%init>

	my $judge = Tab::Judge->retrieve($judge_id);

	if ($email) { 
		my $person = Tab::Person->search( email => $email)->first;
		$m->redirect("edit.mhtml?judge_id=$judge_id&err=No such person found") unless $person;

		$judge->person($person->id);
		$judge->update;
	
		$m->comp("/funclib/conflict.mas", tourn => $tourn, person => $person);
		$m->redirect("edit.mhtml?judge_id=$judge_id&msg=Account found and linked");

	}

	$m->redirect("edit.mhtml?judge_id=$judge_id&err=No email address entered");

</%init>

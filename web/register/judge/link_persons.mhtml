<%args>
	$tourn
	$person
	$category_id => undef
	$only_category => undef
</%args>
<%init>

	my $category = Tab::Category->retrieve($category_id); 
	$category = $only_category if $only_category;

	my @judges = sort {$a->last cmp $b->last } Tab::Judge->search(  person => 0, category => $category->id );

</%init>

	<& menu.mas, only_category => $only_category,  tourn => $tourn, whoami => "link", category => $category &>

	<div class="main">

		<div class="full nospace">
			<span class="threequarters">
				<h2>Link judges to accounts</h4>
			</span>

%			if ($person->site_admin) { 
				<span class="quarter">
					<a class="dkblue full" href="autolink_persons.mhtml?category_id=<%$category_id %>">
						Auto-link accounts
					</a>
				</span>
%			} 

		</div>

		<& "/funclib/tablesorter.mas", table => "sortable" &>

		<form action="link_persons_save.mhtml" method="post">
		<input type="hidden" name="category_id" value="<% $category->id %>">

		<table id="sortable">

			<thead>

			<tr class="smallish yellowrow">

				<th>
				</th>

				<th>
					Judge
				</th>

				<th>
					School
				</th>

				<th>
					Email address of account
				</th>

			</tr>
			</thead>

			<tbody>

%			my $counter++;

%			foreach my $judge (@judges) { 

				<tr>

					<td class="centeralign smallish">
						<% $counter++ %>
					</td>

					<td>
						<% $judge->first." ".$judge->last %>
					</td>

					<td>
						<% $judge->school > 0 ? $judge->school->name : "Hired" %>
					</td>

					<td>
						<input type="email" name="<% $judge->id %>" size="30">
					</td>

				</tr>

%			}
			</tbody>

			<tr class="liblrow">

				<td colspan="4" class="rightalign">
					<input type="submit" value=" Link Accounts">
				</td>
			</tr>

		</table>

		</form>
	</div>


<%args>
	$tourn
</%args>
<%init>

	my $whoami = "deadbeats";

</%init>

	<script>

		function showOwed () { 

			$(".owed").removeClass('hidden');
			$(".owed").addClass('row');

			$(".owing").addClass('hidden');
			$(".owing").removeClass('row');

			$(".controls").removeClass("invert");
			$("#showOwed").addClass('invert');

			zebraRows();
		};

		function showOwing () { 

			$(".owing").removeClass('hidden');
			$(".owing").addClass('row');

			$(".owed").addClass('hidden');
			$(".owed").removeClass('row');

			$(".controls").removeClass("invert");
			$("#showOwing").addClass('invert');

			zebraRows();
		};

		function showBoth () { 
			$(".owing").removeClass('hidden');
			$(".owed").removeClass('hidden');

			$(".owing").addClass('row');
			$(".owed").addClass('row');

			$(".controls").removeClass("invert");
			$("#showBoth").addClass('invert');

			zebraRows();
		}

	</script>


	<& "menu.mas", tourn => $tourn, whoami => $whoami &>

	<div class="main">

		<div class="full nospace">

			<span class="half">
				<h4>Schools with non zero balances </h4>
			</span>

			<span class="half nospace rightalign">

				<a 
					id="showBoth"
					class="button buttonwhite bluetext invert controls hover"
					onClick="showBoth();";
				>
					Show Both
				</a>

				<a 
					id="showOwing"
					class="button buttonwhite bluetext controls hover"
					onClick="showOwing();";
				>
					Show Owing
				</a>

				<a 
					id="showOwed"
					class="button buttonwhite bluetext controls hover"
					onClick="showOwed();";
				>
					Show Refunds
				</a>

				<a 
					href="deadbeats_csv.mhtml" 
					class="button buttonwhite greentext fa fa-lg fa-file-excel-o"
				></a>
			</span>

		</div>

		<& "/funclib/tablesorter.mas", table => "sortme" &>

		<table id="sortme">

			<thead>

				<tr class="smallish yellowrow">

					<th>
						School Name
					</th>

					<th>
						Direction
					</th>

					<th>
						Amount
					</th>

					<th>
					</th>

				</tr>

			</thead>

			<tbody>

%			foreach my $school (sort {$a->name cmp $b->name} $tourn->schools) {

<%perl>

				my ($total, $feline_ref, $total_ref) = 
					$m->comp("/funclib/school_fees.mas", 
						school_id => $school->id,
						all       => 1);

				next if $total == -0;
				next if $total > 0 && $whoami eq "owed_only";
				next if $total < 0 && $whoami eq "owing_only";

</%perl>
				<tr class="row <% $total < 0 ? "owed" : "owing" %>">
					
					<td>
						<a 
							class="white" 
							target="_blank"
							href="/register/school/edit.mhtml?school_id=<% $school->id %>"
						>
							<% $school->name %>
						</a>
					</td>
				
					<td>
						<% ($total < 0) ? "Refund Due:" : "Owes:" %>
					</td> 
				
					<td class="rightalign code">
						<% sprintf ("%.2f", $total ) %>
					</td>

					<td class="centeralign nospace">
						<a 
							class  = "dkblue button buttonwhite fa fa-lg fa-credit-card"
							target = "_blank"
							title  = "Edit money screen"
							href   = "/register/school/invoice.mhtml?school_id=<% $school->id %>"
						>
						</a>
						<a 
							class  = "dkblue button buttonwhite fa fa-lg fa-file-pdf-o"
							target = "_blank"
							title  = "Printable invoice"
							href   = "/register/school/invoice_print.mhtml?school_id=<% $school->id %>"
						>
						</a>
					</td>
					
				</tr>

%			} # end of foreach school

			</tbody>

		</table>

	</div>



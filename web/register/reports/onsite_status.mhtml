<%args>
	$tourn
	$tourn_settings
	$session
</%args>
<%init>

	Tab::School->set_sql(not_onsite_by_event =>  "
		select distinct school.* 
		from school, entry
		where school.onsite != 1
		and school.id = entry.school
		and entry.event = ? 
		and entry.active = 1
		order by school.name ");

</%init>

	<& "menu.mas", 
		tourn          => $tourn,
		tourn_settings => $tourn_settings,
		whoami         => "onsite_status",
		session        => $session
	&>

	<div class="main">

		<h2>Event/Division Registration Status</h2>,

		<table>

			<tr class="yellowrow">

				<th>
					Event
				</th>

				<th>
					Not Checked In
				</th>

			</tr>

<%perl>

			my $switch;

			EVENT:
			foreach my $event (
				sort {$a->name cmp $b->name} 
				$tourn->events
			) { 


				if ($session->weekend) { 
					next EVENT if $session->weekend->id != $event->setting("weekend");
				}

				my @schools = Tab::School->search_not_onsite_by_event($event->id);
</%perl>

				<tr class="row">

					<td>
						<% $event->abbr %>
					</td>

					<td>

%						if (@schools) { 

%							if (scalar @schools < 10) { 

%								foreach my $school (@schools) { 
				
									<a 
										class  = "white namespan smallish nowrap"
										style  = "width: 140px;"
										target = "_blank"
										href="/register/school/entries.mhtml?school_id=<% $school->id %>&event_id=<% $event->id %>" 
									>
										<% scalar Tab::Entry->search( 
											school => $school->id,
											event  => $event->id,
											active => 1
										) %>:
										<% $school->short_name %> 
									</a>

%								}	

%							} else { 
								
								<% scalar @schools %> schools not checked in

%							} 

%						} else { 

							<div class="full centeralign greentext">
								READY TO PAIR
							</div>
%						} 
					
					</td>
			
				</tr>

%			}

		</table>

	</div>

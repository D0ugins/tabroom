<%args>
	$tourn
	$tourn_settings
</%args>
<%init>

	my @categories = sort {$a->name cmp $b->name} $tourn->categories;

	my %settings;

	foreach my $category (@categories) { 
		$settings{$category->id} = {$category->all_settings()};
	}

</%init>

	<& "menu.mas", 
		tourn          => $tourn,
		tourn_settings => $tourn_settings,
		whoami         => "burdens" 
	&>

	<div class="main">

		<div class="nospace">
			<span class="third nospace">
				<h2>Judge Burdens</h2>
			</span>

			<span class="twothird rightalign">
				Numbers indicate entries uncovered by judging
			</span>

		</div>

		<& "/funclib/tablesorter.mas", table => "burdens" &>

		<table id="burdens" class="smallish">

			<thead>

				<tr class="yellowrow">
					<th>
						School
					</th>

					<th>
						State
					</th>

%					foreach my $category (@categories) {
						<th>
							<% $category->abbr %>
						</th>
%					}

				</tr>
			<thead>

			<tbody>

%			foreach my $school (sort {$a->name cmp $b->name} $tourn->schools) { 

				<tr>

					<th>
						<a class="plain" href="/register/school/edit.mhtml?school_id=<% $school->id %>">
							<% $school->name %>
						</a>
					</th>

					<td class="centeralign">
						<% $school->chapter->state %>
					</td>

<%perl>

					foreach my $category (@categories) { 

						my ($uncovered, $overage) = 
							$m->comp(
								"/funclib/judgemath/uncovered_burden_by_category.mas", 
								category          => $category,
								category_settings => $settings{$category->id},
								school            => $school
							);

</%perl>

						<td class="<% ($uncovered) 
							? "red rightalign" : $overage 
							? "libl rightalign" : "" %> halflimit">
							<% $uncovered ? "-".$uncovered : $overage ? "+".$overage : "" %>
						</td>
%					}

				</tr>

%			}

			</tbody>

		</table>

	</div>

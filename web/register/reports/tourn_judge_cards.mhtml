<%args> 
	$tourn 
	$session
	$category_id => undef
	$sort_by     => undef
</%args>
<%init>

	my $name = $tourn->name;
	$name =~ s/[\W_]//g;

    my $filename = "JudgeCards-$name-".$session->id;

    my $filepath = $Tab::file_root."/tmp/$filename";

	system "/bin/rm -rf $filepath.*";

	$m->comp("/funclib/printout.mas", 
		tourn    => $tourn,
		filename => $filename,
		head     => 1
	);

	my @judges = $m->comp(
		"/funclib/tourn_judges.mas", 
		tourn => $tourn
	);

	@judges = sort {$a->last cmp $b->last} @judges if $sort_by eq "name";

	if ($category_id) { 
		@judges = Tab::Judge->search( category => $category_id );
	}

	foreach my $judge (@judges) { 

		$m->comp("/register/judge/print/sheet.mas", 
			filename   => $filename,
			judge      => $judge,
			tourn      => $tourn,
			linebreaks => "woof"
		);
	}

	$m->comp("/funclib/printout.mas", 
		tourn    => $tourn,
		filename => $filename,
		tail     => 1,
		debug => 1
	);

</%init>


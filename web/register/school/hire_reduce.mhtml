<%args>
	$person
	$hire_id
</%args>
<%init>

	my $hire = Tab::JudgeHire->retrieve($hire_id);
	my $category = $hire->category;
	my $school = $hire->school;

	my $reduction = $category->setting("judge_per") if $category->setting("hired_fee") && $category->setting("judge_per");
	$reduction = 1 unless $reduction;

	if ($hire->covers) { 
		$hire->covers($hire->covers - $reduction);
		$hire->accepted($hire->covers) if $hire->accepted > $hire->covers;
	}

	if ($hire->rounds) { 
		$hire->rounds($hire->rounds - $reduction);
		$hire->rounds_accepted($hire->rounds) if $hire->rounds_accepted > $hire->rounds;
	}

	$hire->update;

	$hire->delete if $hire->covers < 1 && $hire->rounds < 1; 

	my $msg = "Hired judging reduced by 1";

	$m->redirect("judges.mhtml?category_id=".$category->id."&school_id=".$school->id."&msg=$msg");

</%init>


<%args>
	$tourn
	$school
	$category          => undef
	$category_settings => undef
</%args>
<%init>

	my $switch;

	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;

</%init>

	<div class="menu">

%		if ($category) { 

			<div class="sidenote">

			<h4>Add Judges:</h4>

%			my @chapter_judges = $m->comp("/funclib/chapter_judges_free.mas", school => $school);
%			my $now = DateTime->now;

%			if (@chapter_judges) { 

				<table>

					<tr>
						<td class="centeralign">

							<form action="judge_save.mhtml" method="post">
							<input type="hidden" name="category_id" value="<% $category->id %>">
							<input type="hidden" name="school_id" value="<% $school->id %>">
	
							<select name="chapter_judge_id"  class="fixedmedsmall chosen">
%								foreach my $chapter_judge (sort {$a->last cmp $b->last} @chapter_judges) { 
									<option value="<% $chapter_judge->id %>"><% $chapter_judge->last.", ".$chapter_judge->first %></option>
%								}
							</select>
						</td>
					</tr>

					<tr class="liblrow">

						<td class="rightalign">
							<input type="submit" class="thin" value=" Enter Judge">
							</form>
						</td>
		
					</tr>

				</table>

%			}

%			if ($school->chapter) { 
				<a class="yellow block" href="/register/judge/add.mhtml?school_id=<% $school->id %>&category_id=<% $category->id %>&chapter_id=<% $school->chapter->id %>&from=school">
					Add Judge Not On Roster
				</a>
%			}

			<hr />
	
			</div>

%		}

		<div class="sidenote">
		
		<h4>Judge Categories</h4>

		<a class="white">Red means below obligation:</a>

<%perl>
		my $hires;

			foreach my $other_category (sort {$a->name cmp $b->name} $tourn->categories) {

				my %other_settings = $other_category->all_settings();

				$hires++ if $other_category->setting("track_judge_hires");
   
				my ($uncovered, $overage) = 
					$m->comp("/funclib/judgemath/uncovered_burden_by_category.mas", 
						school            => $school,
						category_settings => \%other_settings,
						category          => $other_category
					); 

				my $obligation = $m->comp(
					"/funclib/judgemath/judges_needed_by_category.mas", 
						school            => $school,
						category_settings => \%other_settings,
						category          => $other_category
					);

</%perl>

				<a href="/register/school/judges.mhtml?school_id=<% $school->id %>&category_id=<% $other_category->id %>" 
					class="
						<% 
							($category && $other_category->id == $category->id) ? "dk" : "" 
						%><% 
							($uncovered < 1) ? "blue" : "red" 
						%> full nowrap">

						<span class="quarter nowrap">
							<% $other_category->abbr %>
						</span>
						<span class="threequarter nowrap">
							<% $obligation %> owed
						</span>
				</a>

%			}

		</div>

	</div>


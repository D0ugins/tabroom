<%args>
	$region
	$tourn          => undef
	$tourn_settings => undef
	$whoami         => undef
	$nodiv          => undef
</%args>
<%init>

	return unless $tourn;

	my @regions = sort {$a->name cmp $b->name} $m->comp("/funclib/tourn_regions.mas", tourn => $tourn);

	if ($region) {
		$region->registered($region->setting("registered_".$tourn->id));
	}

	my @unregged;
	my @regged;

	foreach my $cregion (@regions) {

		if ($cregion->registered) {
			push @regged, $cregion;
		} else {
			push @unregged, $cregion;
		}

	}

</%init>

%   unless ($nodiv) {
        <div class="blank">
%   }

		<div class="odd truefull">

			<span class="half">

			<span class="quarter semibold bluetext">
				Not In
			</span>

			<span class="threequarters">

%				if ($r->uri =~ "tourn_entries.mhtml") {
					<form
						action = "/register/region/tourn_entries.mhtml"
						method = "post"
					>

%				} elsif ($r->uri =~ "tourn_judges.mhtml") {
					<form
						action   = "/register/region/tourn_judges.mhtml"
						method   = "post"
					>
%				} elsif ($r->uri =~ "invoice.mhtml") {
					<form
						action = "/register/region/invoice.mhtml"
						method = "post"
					>
%				} else {
					<form
						action="/register/region/tourn.mhtml"
						method="post">
%				}

				<select
					class    = "notfirst fixed chosen leftalign"
					name     = "region_id"
					onchange = 'this.form.submit()'
					<% ($region) ? "" : 'size="25"' %>
				>
%					if ($region) {
						<option value=""></option>
%					}

<%perl>

					foreach my $oregion (@unregged) {
						my $code = substr($oregion->code, 0, 4);
						if ($code) {
			    			foreach ( length($code) .. 6) {
			   	   	       		$code .= "&nbsp;";
		   	   	   	 		}
						}

</%perl>

						<option
							value="<% $oregion->id %>"
							<%  ($region && $region->id == $oregion->id) ? "selected" : ""  %>
						> <% $code %> <% substr($oregion->name,0,25) %> </option>
%					}

				</select>

				<noscript>
					<input type="submit" value="Show">
				</noscript>

				</form>
			</span>

			</span>

			<span class="half">

			<span class="quarter semibold bluetext">
				Checked In
			</span>

			<span class="threequarters">

%				if ($r->uri =~ "tourn_entries.mhtml") {
					<form
						action = "/register/region/tourn_entries.mhtml"
						method = "post"
					>
%				} elsif ($r->uri =~ "tourn_judges.mhtml") {
					<form
						action   = "/register/region/tourn_judges.mhtml"
						method   = "post"
					>
%				} elsif ($r->uri =~ "invoice.mhtml") {

					<form
						action = "/register/region/invoice.mhtml"
						method = "post"
					>

%				} else {

					<form
						action = "/register/region/tourn.mhtml"
						method = "post"
					>

%				}

				<select
					class    = "notfirst fixed chosen leftalign"
					name     = "region_id"
					onchange = 'this.form.submit()'
					<% ($region) ? "" : "size=\"25\""%>
				>

%					if ($region) {
   						<option value=""></option>
%					}
<%perl>

					foreach my $oregion (@regged) {
						my $code = substr($oregion->code, 0, 4);
						if ($code) {
			    			foreach ( length($code) .. 6) {
			   	   	       		$code .= "&nbsp;";
		   	   	   	 		}
						}

</%perl>
						<option
							value="<% $oregion->id %>"
								<%  $region && $region->id == $oregion->id
									? 'selected="selected"'
									: ""
								%>
							> <% $code %> <% substr($oregion->name,0,25) %> </option>
%					}

				</select>

				<noscript>
					<span class="smallspan">
						<input type="submit" value="Show">
					</span>
				</noscript>

				</form>

			</span>

			</span>

		</div>

%  	 unless ($nodiv) {
		</div>
        <div class="main padtop">
% 	  }

%	if ($region) {

		<div class="nospace full">
			<span class="threequarter">
				<h2>
					<% $region->setting("arch") ? "Archdiocese" : "Diocese" %>
					of <% $region->name %>
				</h2>
			</span>
			<span class="quarter rightalign">
				<h2><% $region->code %></h2>
			</span>
		</div>

		<ul id="tabnav" style="margin-bottom: 5px;">

			<li class=<% $whoami eq "summary" ? "selected" : "" %>>
				<a href="/register/region/tourn.mhtml?tourn_id=<% $tourn->id %>&region_id=<% $region->id %>">Summary</a>
			</li>

			<li class=<% $whoami eq "schools" ? "selected" : "" %>>
				<a href="/register/region/tourn_schools.mhtml?tourn_id=<% $tourn->id %>&region_id=<% $region->id %>">Schools</a>
			</li>

			<li class=<% $whoami eq "entries" ? "selected" : "" %>>
				<a href="/register/region/tourn_entries.mhtml?tourn_id=<% $tourn->id %>&region_id=<% $region->id %>">Entries</a>
			</li>

			<li class=<% $whoami eq "judges" ? "selected" : "" %>>
				<a href="/register/region/tourn_judges.mhtml?tourn_id=<% $tourn->id %>&region_id=<% $region->id %>">Judges</a>
			</li>

			<li class=<% $whoami eq "money" ? "selected" : "" %>>
				<a href="/register/region/invoice.mhtml?tourn_id=<% $tourn->id %>&region_id=<% $region->id %>">Invoice</a>
			</li>

			<li class=<% $whoami eq "access" ? "selected" : "" %>>
				<a href="/register/region/access.mhtml?tourn_id=<% $tourn->id %>&region_id=<% $region->id %>">Access</a>
			</li>

		</ul>

%	}

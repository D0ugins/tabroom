<%args>
	$tourn
	$tourn_settings
	$default     => "General"
	$district_id => undef
</%args>
<%init> 

	my @tabs = ("General", "Schools", "Entries", "Judges", "Congress"); 
			
	my $district = Tab::District->retrieve($district_id) if $district_id;

	my $now = DateTime->now();

</%init>

	<& "/register/district/menubar.mas", 	
		tourn          => $tourn,
		tourn_settings => $tourn_settings,
		district       => $district
	&>

	<div class="main">

<%perl>
		if ($district) { 

</%perl>

			<span class="fourfifths nospace">
				<h3 class="nospace"><% $district->name %></h3>
			</span>

			<span class="fifth rightalign">
				<h5 class="bluetext nospace">
					<% $district->code %>
				</h5>
			</span>

			<& "/funclib/tabs.mas", 
				tabs    => \@tabs,
				default => $default
			&>

			<div class="screens General">
				<h4>
					General
				</h4>
			</div>

			<div class="screens Schools">

				<span class="fourfifths">
					<h4>
						Schools
					</h4>
				</span>

				<span 
					id="schools_buttonarea"
					class="fifth rightalign">
				</span>

				<& "/funclib/tablesorter.mas", table => "schools" &> 

				<table id="schools">
					<thead>
						<tr class="ltyellow">
							<th>
								School
							</th>
							<th>
								Contact
							</th>
							<th>
								Phone
							</th>
							<th>
								Email
							</th>
							<th>
								Status
							</th>
						</tr>
					</thead>

					<tbody>
<%perl>
					foreach my $school (
						sort {$a->name cmp $b->name} 
						$district->schools(tourn => $tourn->id)
					) { 
</%perl>
						<tr>
							<td class="nospace">
								<a 
									href="/register/school/edit.mhtml?school_id=<% $school->id %>"
									class="white full padvert padleftmore"
								>
									<% $school->short_name %>
								</a>
							</td>

							<td>
								<% $school->setting("contact_name") %>
							</td>

							<td>
								<% $school->setting("contact_number") %>
							</td>

							<td>
								<% $school->setting("contact_email") %>
							</td>

							<td class="nospace centeralign">
								<label for="<% $school->id %>_onsite">

									<div class="hover nospace">
										<span class="hidden"><% $school->onsite %></span>

										<label class="switch smaller">
											<input 
												type          = "checkbox"
												value         = "1"
												id            = "<% $school->id %>_onsite"
												property_name = "onsite"
												target_type   = "school"
												target_id     = "<% $school->id %>" 
												onChange      = "postSwitch( this, '/register/school/school_switch.mhtml');"

												<% $school->onsite ? 'checked="checked"' : "" %>
											>
											<div class="slider"></div>

										</label>

									</div>
								</label>
							</td>

						</tr>

%					} 

					</tbody>
				</table>

			</div>

			<div class="screens Entries">

				<span class="fourfifths">
					<h4>
						Entries
					</h4>
				</span>

				<span 
					id="entries_buttonarea"
					class="fifth rightalign">
				</span>

				<& "/funclib/tablesorter.mas", table => "entries" &> 

				<table id="entries">
					<thead>
						<tr class="ltyellow">
							<th>
								Event
							</th>
							<th>
								Code
							</th>
							<th>
								Name
							</th>
							<th>
								School
							</th>
							<th>
								Status
							</th>
						</tr>
					</thead>

					<tbody>
<%perl>
					foreach my $entry (
						$m->comp("/funclib/nationals_entry.mas", 
							district => $district, 
							tourn => $tourn
						) 
					) { 

						my ($status, $statusclass) = 
							$m->comp(
								'/funclib/nationals_entry_status.mas', 
								entry => $entry
							);
</%perl>
						<tr>
							<td class="nospace">
								<% $entry->event->abbr %>
							</td>

							<td class="nospace">
								<a 
									href="/register/entry/edit.mhtml?entry_id=<% $entry->id %>"
									class="white full padvert padleftmore"
								>
									<% $entry->code %>
								</a>
							</td>

							<td class="nospace">
								<a 
									href="/register/entry/edit.mhtml?entry_id=<% $entry->id %>"
									class="white full padvert padleftmore"
								>
									<% $entry->name %>
								</a>
							</td>

							<td class="nospace">
								<a 
									href="/register/school/edit.mhtml?entry_id=<% $entry->school->id %>"
									class="white full padvert padleftmore"
								>
									<% $entry->school->short_name %>
								</a>
							</td>
							<td class="nospace centeralign <% $statusclass %>">
								<% $status %>
							</td>
						</tr>

%					}
					</tbody>
			</table>

			</div>

			<div class="screens Judges">

				<span class="fourfifths">
					<h4>
						Judges
					</h4>
				</span>

				<span 
					id="judges_buttonarea"
					class="fifth rightalign">
				</span>

				<& "/funclib/tablesorter.mas", table => "judges" &> 

				<table id="judges">
					<thead>
						<tr class="ltyellow">
							<th>
								Event
							</th>
							<th>
								Code
							</th>
							<th>
								Name
							</th>
							<th>
								School
							</th>
							<th>
								Rounds
							</th>
							<th>
								Pools
							</th>
						</tr>
					</thead>

					<tbody>
<%perl>
					foreach my $judge (
						$m->comp("/funclib/nationals_judges.mas", 
							district => $district, 
							tourn => $tourn
						) 
					) { 

</%perl>
						<tr>
							<td class="nospace">
								<% $judge->category->abbr %>
							</td>

							<td class="nospace">
								<a 
									href="/register/judge/edit.mhtml?judge_id=<% $judge->id %>"
									class="white full padvert padleftmore"
								>
									<% $judge->first %>
								</a>
							</td>

							<td class="nospace">
								<a 
									href="/register/judge/edit.mhtml?judge_id=<% $judge->id %>"
									class="white full padvert padleftmore"
								>
									<% $judge->last %>
								</a>
							</td>

							<td class="nospace">
								<a 
									href="/register/school/edit.mhtml?judge_id=<% $judge->school->id %>"
									class="white full padvert padleftmore"
								>
									<% $judge->school->short_name %>
								</a>
							</td>

							<td class="nospace centeralign">
								<% $judge->obligation %> 
							</td>

							<td class="nospace centeralign"> 
								<% $judge->jpoolnames %> 
							</td>
						</tr>

%					}
					</tbody>
			</table>

			</div>

			<div class="screens Congress">

				<h4>District Congress Legislation</h4>

<%perl>
				foreach my $file ($tourn->files( 
						type     => "bill",
						tourn    => $tourn->id,
						district => $district->id
					) 
				) { 

</%perl>

					<div class="row">
						
						<span class="half">
							<a 
								class = "plain semibold bluetext"
								href  = "<% $Tab::s3_url %>/<% $tourn->id %>/bills/<% $district->id %>/<% $file->id %>/<% $file->filename %>"
							><% $file->filename %></a>
						</span>

						<span class="fourtenths">
							<div class="full nospace padless">
								Posted by <% $file->person->first." ".$file->person->last %>
							</div>
							<div class="full nospace padless">
								at <% Tab::csvdt($file->uploaded) %>
							</div>
						</span>

%						my $warn = "This will delete this piece of legistlation.  Are you sure?";

						<span class="tenth">
							<a 
								<& "/funclib/confirm.mas", warn => $warn &> 
								class="fa fa-sm fa-trash buttonwhite redtext"
								href="/user/nsda/legislation_rm.mhtml?file_id=<% $file->id %>&district_id=<% $district %>"
							></a>
						</span>

					</div>

%				}

				<form 
					action   = "/user/nsda/upload_legislation.mhtml"
					enctype = "multipart/form-data"
					method   = "post"
				>

					<input 
						type  = "hidden"
						value = "<% $district->id %>"
						name  = "district_id"
					>

					<input 
						type  = "hidden"
						value = "<% $tourn->id %>"
						name  = "tourn_id"
					>

					<div class="row">

						<span class="quarter semibold">
							Upload Legislation:
						</span>

						<span class="half centeralign nospace">
							<div class="uploader wider">

								<input 
									type     = "file"
									name     = "bill"
									style    = "opacity: 0;"
									onchange = "uploaderName('bill', 'bill_file');"
									id       = "bill"
								>

								<span 
									id    = "bill_file"
									class = "filename"
									style = "-webkit-user-select: none;"
								>No file selected</span>

								<span 
									class = "action"
									style = "-webkit-user-select: none;"
								>Choose File</span>

							</div>
						</span>

						<span class="quarter rightalign">
							<input type="submit" value="Upload Bill">
						</span>

					</div>

				</form>

			</div>

%		}

</div>



<%args>
	$tourn
	$person
	$event_id => undef
	$breakout => undef
</%args>
<%init>

	use JSON;

	my $event = Tab::Event->retrieve($event_id) if $event_id;

	my $label = $event->setting("breakout_".$breakout."_label");
	my $deleted = $event->setting("breakout_".$breakout."_deleted");

	if ($label && not defined $deleted) { 

		my @students = $m->comp("/funclib/event_students.mas", event => $event);

		my %flagged_students = ();

		foreach my $student (@students) { 
			$flagged_students{$student->id} = $ARGS{"flagged_".$student->id} if $ARGS{"flagged_".$student->id} > 0;
		}

		$event->setting('breakout_'.$breakout.'_students', "text", JSON::encode_json(\%flagged_students));

		my $msg = "$label status saved";
		$m->redirect("flag_students.mhtml?event_id=$event_id&breakout=$breakout&msg=$msg");

	} else { 

		my $err = "No valid breakout flag sent";
		$m->redirect("flag_students.mhtml?event_id=$event_id&breakout=$breakout&err=$err");
	}


</%init>

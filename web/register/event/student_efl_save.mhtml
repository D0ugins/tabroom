<%args>
	$tourn
	$person
	$event_id => undef
</%args>
<%init>

	use JSON;

	my $event = Tab::Event->retrieve($event_id) if $event_id;

	my @students = $m->comp("/funclib/event_students.mas", event => $event);

	my %efl_students = ();
	my %esl_students = ();

	if ($event) { 

		%efl_students = %{JSON::decode_json($event->setting('efl_students'))}
			if $event->setting('efl_students');

		%esl_students = %{JSON::decode_json($event->setting('esl_students'))}
			if $event->setting('esl_students');
	}

	foreach my $student (@students) { 
		$efl_students{$student->id} = $ARGS{"efl_".$student->id} if $ARGS{"efl_".$student->id};
		$esl_students{$student->id} = $ARGS{"esl_".$student->id} if $ARGS{"esl_".$student->id};
	}

	$event->setting('efl_students', "text", JSON::encode_json(\%efl_students));
	$event->setting('esl_students', "text", JSON::encode_json(\%esl_students));

	my $msg = "EFL/ESL status saved";

	$m->redirect("student_efl.mhtml?event_id=$event_id&msg=$msg");


</%init>

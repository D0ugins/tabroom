<%args>
	$event_id
	$tourn
	$tourn_settings
	$only_category => undef
</%args>
<%init>

	my $event = Tab::Event->retrieve($event_id);
	$m->abort unless $event;

	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;

	my $round = $event->rounds(type => "prelim")->first; 

	my %chamber;

	if ($round) { 
		foreach my $entry ($m->comp("/funclib/round_entries.mas", round => $round)) { 
			$chamber{$entry->id} = $entry->panelletter;
		}
	}


</%init>

	<& "menu.mas", 
		tourn          => $tourn,
		event          => $event,
		only_category  => $only_category,
		tourn_settings => $tourn_settings,
		whoami         => "legislation"
	&>

	<div class="main">

		<div class="full nospace">

			<span class="fourfifths">
				<h5>Legislation: <% $event->abbr %></h4>
			</span>

			<span 
				id="bills_buttonarea"
				class="fifth rightalign">
			</span>

		</div>

		<& "/funclib/tablesorter.mas", table => "bills" &>

		<table id="bills">

			<thead>

				<tr class="yellowrow smallish">

					<th>
						School
					</th>

					<th>
						Title
					</th>

					<th>
						Submitted
					</th>

					<th>
						Category
					</th>

					<th>
						Author
					</th>

					<th>
						Chamber
					</th>

					<th>
						File
					</th>

					<th>
					</th>

				</tr>

			</thead>

			<tbody>

%				foreach my $file ($event->files( type => "legislation")) { 

					<tr class="smaller">

						<td>
							<% $file->school->short_name %>
						</td>

						<td>
							<% $file->label %>
						</td>

						<td>
							<% Tab::csvdt($file->uploaded->set_time_zone($tz)) %>
						</td>

						<td>
							<% $file->tag %>
						</td>

						<td>
							<% $file->entry ? $file->entry->code : "" %>
						</td>

						<td class="centeralign nospace">
							<% $file->entry ? $chamber{$file->entry->id} : "" %>
						</td>


						<td class="centeralign nospace">
							<a 
								class = "buttonwhite greentext fa fa-sm fa-arrow-down"
								href  = "<% $Tab::s3_url %>/<% $tourn->id."/legislation/".$file->id."/".$file->filename %>">
							 </a>
						</td>


						<td class="centeralign">

%                   		my $warn = "This will delete ".$file->label." irrevocably.  You cannot recover it if you do this.  Please be certain";

							<a
								class = "redtext buttonwhite fa fa-sm fa-trash"
								href  = "legislation_rm.mhtml?file_id=<% $file->id %>"
								<& "/funclib/confirm.mas", warn => $warn &>
							></a>

						</td>

					</tr>
%				}

			</tbody>


		</table>

	</div>


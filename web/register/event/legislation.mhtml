<%args>
	$event_id
	$tourn
	$tourn_settings
	$only_category => undef
</%args>
<%init>

	my $event = Tab::Event->retrieve($event_id);
	$m->abort unless $event;

	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;

</%init>

	<& "menu.mas", 
		tourn          => $tourn,
		event          => $event,
		only_category  => $only_category,
		tourn_settings => $tourn_settings,
		whoami         => "legislation"
	&>

	<div class="main">

		<div class="full nospace">

			<span class="threefifths">
				<h4><% $event->abbr %></h4>
			</span>

			<span class="twofifths rightalign">
				<h5>Submitted Legislation</h5>
			</span>

		</div>

		<& "/funclib/tablesorter.mas", table => "rezzes" &>

		<table id="rezzes">

			<thead>

				<tr class="yellowrow smallish">

					<th>
						School
					</th>

					<th>
						Title
					</th>

					<th>
						Submitted
					</th>

					<th>
						File
					</th>

					<th>
					</th>

				</tr>

			</thead>

			<tbody>

%				foreach my $file ($event->files( type => "legislation")) { 

					<tr>

						<td>
							<% $file->school->short_name %>
						</td>

						<td>
							<% $file->label %>
						</td>

						<td>
							<% Tab::csvdt($file->uploaded->set_time_zone($tz)) %>
						</td>

						<td class="centeralign">
							<a 
								class = "buttonwhite greentext fa fa-lg fa-arrow-down"
								href  = "<% $Tab::s3_url %>/<% $tourn->id."/legislation/".$file->id."/".$file->filename %>">
							 </a>
						</td>

						<td class="centeralign">

%                   		my $warn = "This will delete ".$file->label." irrevocably.  You cannot recover it if you do this.  Please be certain";

							<a
								class = "redtext buttonwhite fa fa-lg fa-trash"
								href  = "legislation_rm.mhtml?file_id=<% $file->id %>"
								<& "/funclib/confirm.mas", warn => $warn &>
							></a>

						</td>

					</tr>
%				}

			</tbody>


		</table>

	</div>


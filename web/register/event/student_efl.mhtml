<%args>
	$tourn
	$person
	$event_id => undef
</%args>
<%init>

	use JSON;

	my $event = Tab::Event->retrieve($event_id) if $event_id;

	my @students = $m->comp("/funclib/event_students.mas", event => $event);

	my %efl_students = ();
	my %esl_students = ();

	if ($event) { 

		%efl_students = %{JSON::decode_json $event->setting('efl_students')}
			if $event->setting('efl_students');

		%esl_students = %{JSON::decode_json $event->setting('esl_students')}
			if $event->setting('esl_students');
	}

	my %entries = map {$_->id => $_} $event->entries;

</%init>

	<& menu.mas, 
		tourn  => $tourn,
		event  => $event,
		eflesl => 1
	&>

	<div class="main">

		<div class="full nospace">

			<span class="half">
				<h4><% $event->abbr %></h4> 
			</span>

			<span class="half martop rightalign">
				<h6>EFL/ESL Status for Speaker Awards</h6>
			</span>

		</span>

		<form action="student_efl_save.mhtml" method="post">
		<input type="hidden" name="event_id" value="<% $event->id %>">
		
		<& /funclib/tablesorter.mas, table => "sortme" &>

		<table id="sortme">

			<thead>

				<tr class="yellowrow">

					<th>
						First
					</th>

					<th>
						Last
					</th>

					<th>
						Entry
					</th>

					<th>
						Institution
					</th>

					<th>
						EFL
					</th>

					<th>
						ESL
					</th>

				</tr>

			</thead>

			<tbody>

%			foreach my $student (@students) { 

				<tr>

					<td>
						<% $student->first %>
					</td>

					<td>
						<% $student->last %>
					</td>

					<td>
						<a class="full button white leftalign" href="/register/entry/edit.mhtml?entry_id=<% $student->entry %>">
							<% $entries{$student->entry}->code %>
						</a>
					</td>

					<td>
						<a class="full button white leftalign" href="/register/index.mhtml?school_id=<% $entries{$student->entry}->school->id %>">
							<% $entries{$student->entry}->school->short_name %>
						</a>
					</td>

					<td title="EFL" class="nospace">
						<label for="efl_<% $student->id %>">
							<span class="full marno padmore hover centeralign">
								<input type="checkbox" value="1" name="efl_<% $student->id %>"
									id="efl_<% $student->id %>"
									<% $efl_students{$student->id} ? 'checked="checked"' : "" %> >
							</span>
						</label>
					</td>

					<td title="ESL" class="nospace">
						<label for="esl_<% $student->id %>">
							<span class="full marno padmore hover centeralign">
								<input type="checkbox" value="1" name="esl_<% $student->id %>"
									id="esl_<% $student->id %>"
									<% $esl_students{$student->id} ? 'checked="checked"' : "" %> >
							</span>
						</label>
					</td>

				</tr>
%			}

			</tbody>

			<tr class="liblrow">

				<td colspan="6" class="rightalign">
					<input type="submit" value="Save EFL/ESL Status">
					</form>
				</td>

			</tr>

			</form> 

		</table>

	</div>


<%args>
	$tourn
	$person
	$msg => undef
</%args>
<%init>

	use JSON;

	my @districts = Tab::District->search(realm => "NFL");

	my @regions = $tourn->regions;

	my %regions = %{JSON::decode_json $tourn->setting('district_regions')} 
		if $tourn->setting('district_regions');

	if ($msg) { 

		foreach my $district (@districts) { 
			$regions{$district->id} = $ARGS{$district->id};
		}

		$tourn->setting('district_regions', "text", JSON::encode_json(\%regions));

	}

</%init>

	<& menu.mas, 
		tourn  => $tourn,
		person => $person,
		whoami => "district_regions"
	&>

	<div class="main">

		<h2>Districts Regional Constraints</h2>

		<form action="district_regions.mhtml">

		<input 
			type  = "hidden"
			name  = "msg"
			value = "District regions saved"
		>

		<& "/funclib/tablesorter.mas", table => "sortdistauth" &>

		<table id="sortdistauth">

			<thead>
		
			<tr class="yellow smallish">
			
				<th>
					Code
				</th>

				<th>
					District
				</th>

				<th>
					Location
				</th>

				<th>
					Region
				</th>
				
			</tr>

			</thead>
			<tbody>

%			foreach my $district (@districts) { 


				<tr class="row">

					<td>
						<% $district->code %>
					</td>

					<td>
						<% $district->name %>
					</td>

					<td>
						<% $district->location %>
					</td>
				
					<td class="centeralign nospace">

						<span class="hidden">
							<% $regions{$district->id} %>
						</span>

						<select 
							name="<% $district->id %>" 
							class="plain fixedmed"
						>

							<option value=""></option>

%							foreach my $region (@regions) { 
								<option 
									value="<% $region->id %>"
									<% $region->id == $regions{$district->id} 
										? "selected='selected'"
										: ""
									%>
								>
									<% $region->name %>
								</option>
%							}

						</select>

					</td>

				</tr>
%			}

			</tbody>


			<tr class="libl">

				<td colspan="5" class="rightalign">
					<input 
						type  = "submit"
						value = "Save District Regions"
					>
					</form> 
				</td>
			</tr>

		</table>

	</div>


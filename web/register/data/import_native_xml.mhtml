<%args>
	$tourn
	$tourn_settings
	$person
	$session
</%args>
<%init>

	my $ok;
	$ok++ if $person->site_admin;

</%init>

	<& "menu.mas",
		tourn          => $tourn,
		tourn_settings => $tourn_settings,
		person         => $person,
		whoami         => 'import_native_xml',
		ok             => $ok
	&>

	<div class="main">

		<h3><% $tourn->name %></h3>

%		if ($person->id == 1) {

			<h5 class="martopmore">Import TabJSON</h5>

			<form
				name     = "tab_json"
				enctype  = "multipart/form-data"
				action   = "/api/upload_data.mhtml"
				method   = "post"
			>

			<div class="even">

				<span class="fourfifths">

					<div class="uploader full">

						<input
							type     = "file"
							name     = "tab_json"
							style    = "opacity: 0;"
							onchange = "uploaderName()"
							id       = "upload"
						>

						<span
							id    = "filename"
							class = "filename"
							style = "-webkit-user-select: none;"
						>No file selected</span>

						<span
							class = "action"
							style = "-webkit-user-select: none;"
						>Choose File</span>

					</div>
				</span>

				<span class="fifth rightalign">
					<input type="submit" value="Upload Data">
				</span>

			</div>

			</form>

%		}

		<h5 class="martopmore">Import Full Tournament</h5>

		<p>
			Use this ONLY to import data directly downloaded from Tabroom in
			either the STA (Smart Tournament Administrator) or CAT (Computer
			Assisted Tab) systems.  Imports should use the "Import TRPC XML"
			system at right.
		</p>

		<form
			name     = "native_xml"
			enctype  = "multipart/form-data"
			action   = "/api/upload_tourn.mhtml"
			method   = "post"
		>

		<input
			type  = "hidden"
			name  = "tourn_id"
			value = "<% $tourn->id %>"
		>

		<input
			type  = "hidden"
			name  = "person_id"
			value = "<% $person->id %>"
		>

		<input
			type  = "hidden"
			name  = "session_id"
			value = "<% $session->id %>"
		>

		<div class="even">

			<span class="twofifth">

				<div class="uploader wider">

					<input
						type     = "file"
						name     = "native_xml"
						style    = "opacity: 0;"
						onchange = "uploaderName()"
						id       = "upload"
					>

					<span
						id    = "filename"
						class = "filename"
						style = "-webkit-user-select: none;"
					>No file selected</span>

					<span
						class = "action"
						style = "-webkit-user-select: none;"
					>Choose File</span>

				</div>
			</span>

			<label for="no_prefs_full">
				<span class="twofifth hover">
					Skip Prefs:
						<input
							type    = "checkbox"
							id      = "no_prefs_full"
							name    = "no_prefs"
							value   = "1"
							checked = "checked"
						>
					(for faster uploads)
				</span>
			</label>

			<span class="fifth rightalign">
				<input type="submit" value="Upload Data">
			</span>

		</div>

		</form>

		<h5 class="martopmore">Import One Round</h5>

		<form
			name     = "round_xml"
			enctype  = "multipart/form-data"
			action   = "/api/upload_round.mhtml"
			method   = "post"
		>

		<input type="hidden" name="tourn_id" value="<% $tourn->id %>">
		<input type="hidden" name="person_id" value="<% $person->id %>">
		<input type="hidden" name="session_id" value="<% $session->id %>">

		<div class="even">

			<span class="twofifth">
				<div class="uploader wider">

					<input
						type     = "file"
						name     = "round_xml"
						style    = "opacity: 0;"
						onchange = "uploaderName('round_xml','xml_filename')"
						id       = "round_xml"
					>
					<span
						id    = "xml_filename"
						class = "filename"
						style = "-webkit-user-select: none;"
					>No file selected</span>

					<span class="action"
						style="-webkit-user-select: none;"
					>Choose File</span>
				</div>
			</span>

			<span class="twofifth">
			</span>


			<span class="fifth rightalign">
				<input type="submit" value="Upload Data">
			</span>

		</div>

		</form>

		<h5 class="martopmore">Import from Scratch</h5>

		<p>
			Let's say you blew away your tournament and need to restore in
			place.  This is where you go.  <br />Note: please don't do this often.
		</p>

		<form
			name     = "native_xml"
			enctype  = "multipart/form-data"
			action   = "/user/tourn/upload_tourn.mhtml"
			method   = "post"
		>

		<input type="hidden" name="tourn_id" value="<% $tourn->id %>">
		<input type="hidden" name="person_id" value="<% $person->id %>">
		<input type="hidden" name="session_id" value="<% $session->id %>">

		<div class="even">

			<span class="twofifth">
				<div class="uploader wider">
					<input
						type     = "file"
						name     = "native_xml"
						style    = "opacity: 0;"
						onchange = "uploaderName('scratch', 'scratch_filename')"
						id       = "scratch"
					>
					<span
						id    = "scratch_filename"
						class = "filename"
						style = "-webkit-user-select: none;"
					>No file selected</span>

					<span
						class = "action"
						style = "-webkit-user-select: none;"
					>Choose File</span>
				</div>
			</span>

			<label for="no_prefs">
				<span class="twofifth hover">
					Skip Prefs: <input
						type    = "checkbox"
						id      = "no_prefs"
						name    = "no_prefs"
						value   = "1"
						checked = "checked"
					>
					(for faster uploads)
				</span>
			</label>

			<span class="fifth rightalign">
				<input type="submit" value="Upload Data">
			</span>

		</div>

		</form>


	</div>



<%args>
	$tourn
	$tourn_settings
	$person
	$person_settings
	$chapter_id     => undef
	$nsda_school_id => undef
</%args>
<%init>

	my $chapter;

	if ($nsda_school_id) { 

		use Tab::NSDA::MemberSchool;

		my $nsda_school = Tab::NSDA::MemberSchool->retrieve($nsda_school_id);

		$chapter = $m->comp(
			"/funclib/chapter_import.mas",
			nsda_school => $nsda_school,
			nome        => 1,
		);  

	} elsif ($chapter_id) { 

		$chapter = Tab::Chapter->retrieve($chapter_id);	

	}

	unless ($chapter) { 
		my $err = "Chapter ID $chapter_id did not find a valid chapter";
		$m->redirect("add_school.mhtml?err=$err");
	}

	my $already = Tab::School->search( 
		chapter => $chapter_id,
		tourn   => $tourn->id
	)->first;

	if ($already) { 
		my $err = $chapter->name." is already entered in your tournament.  Try again";
		$m->redirect("add_school.mhtml?err=$err");
	}

	my $school = $m->comp("/funclib/school_create.mas",
		person         => $person,
		tourn          => $tourn,
		chapter        => $chapter,
		tourn_settings => $tourn_settings
	);

	my $msg = "School ".$chapter->name." has been added to your tournament entry.";

	$m->redirect("add_school.mhtml?msg=$msg");


</%init>

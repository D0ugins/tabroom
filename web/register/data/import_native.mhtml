<%args>
	$tourn
	$tourn_settings
	$person
	$session
</%args>
<%init>

	my $ok;
	$ok++ if $person->site_admin;

</%init>

	<& "menu.mas",
		tourn          => $tourn,
		tourn_settings => $tourn_settings,
		person         => $person,
		whoami         => 'import_native',
		ok             => $ok
	&>

	<div class="main">

		<div id="output" class="hidden">

			<h5>File upload results:</h5>

		</div>

		<div id="uploader">

		<h3><% $tourn->name %></h3>

%		my $warning = "Depending on which data you upload, this could potentially erase all the data in your tournament.  Please be sure you are uploading the correct file.  If you're not sure, think about taking a full data backup first.";

%		if ($person->site_admin) {

			<h5 class="martopmore">Import TabJSON</h5>

			<p class="semibold redtext">
				This is for Palmer's new relatively untested import/export format.
			</p>

			<div class="even">

				<& "/funclib/uploader.mas",
					url      => "/api/upload_data.mhtml",
					filename => "tabJSON",
					output   => "output",
					hideme   => "uploader",
					submit   => "Upload Data",
					warning  => $warning
				&>

			</div>

			<h5 class="martopmore">Unfuck the Fuckup</h5>

			<p class="semibold redtext">
				Restore the judge noms you stupidly destroyed
			</p>

			<div class="even">

				<& "/funclib/uploader.mas",
					url      => "/api/upload_noms.mhtml",
					filename => "NomJSON",
					output   => "output",
					hideme   => "uploader",
					submit   => "Upload Data",
					warning  => $warning
				&>

			</div>
%		}

		<h5 class="martopmore">Import Full Tournament</h5>

		<p>
			Use this ONLY to import data directly downloaded from Tabroom in
			either the STA (Smart Tournament Administrator) or CAT (Computer
			Assisted Tab) systems.  Imports should use the "Import TRPC XML"
			system at right.
		</p>




		<form
			name     = "native_xml"
			enctype  = "multipart/form-data"
			action   = "/api/upload_tourn.mhtml"
			method   = "post"
		>

		<input
			type  = "hidden"
			name  = "tourn_id"
			value = "<% $tourn->id %>"
		>

		<input
			type  = "hidden"
			name  = "person_id"
			value = "<% $person->id %>"
		>

		<input
			type  = "hidden"
			name  = "session_id"
			value = "<% $session->id %>"
		>

		<div class="even">


			<span class="twofifths">

				<div class="uploader wider">

					<input
						type     = "file"
						name     = "native_xml"
						style    = "opacity: 0;"
						onchange = "uploaderName()"
						id       = "upload"
					>

					<span
						id    = "filename"
						class = "filename"
						style = "-webkit-user-select: none;"
					>No file selected</span>

					<span
						class = "action"
						style = "-webkit-user-select: none;"
					>Choose File</span>

				</div>
			</span>

			<label for="no_prefs_full">
				<span class="twofifth hover">
					Skip Prefs:
						<input
							type    = "checkbox"
							id      = "no_prefs_full"
							name    = "no_prefs"
							value   = "1"
							checked = "checked"
						>
					(for faster uploads)
				</span>
			</label>

			<span class="fifth rightalign">
				<input type="submit" value="Upload Data">
			</span>

		</div>

		</form>

		<h5 class="martopmore">Import One Round (old XML)</h5>

		<div class="even">

			<& "/funclib/uploader.mas",
				url      => "/api/upload_round.mhtml",
				filename => "roundXML",
				output   => "output",
				hideme   => "uploader",
				submit   => "Upload Data",
				warning  => $warning
			&>

		</div>

	</div>



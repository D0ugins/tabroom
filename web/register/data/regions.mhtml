<%args>
	$tourn
	$tourn_settings
	$person
</%args>
<%init>

	my @regions = $tourn->regions;

	@regions = sort {$a->code cmp $b->code} @regions;
	@regions = sort {length($a->code) cmp length($b->code)} @regions;

	my %region_settings = $m->comp(
		"/funclib/region_settings.mas",
		tourn => $tourn,
		tag   => "bullshit_conflict"
	);

</%init>

	<& "menu.mas",
		tourn          => $tourn,
		tourn_settings => $tourn_settings,
		person         => $person,
		whoami         => "regions"
	&>

	<div class="main">

		<span class="twothirds">
			<h2>Edit Tournament Regions</h2>
		</span>
		<span 
			class="third rightalign"
			id="regions_buttonarea"
		>
		</span>

		<form action="regions_save.mhtml">

		<& "/funclib/tablesorter.mas", table => "regions" &>

		<table id = "regions">

			<thead>
		
			<tr class="ltyellow">
			
				<th class="smallish"> 
					Region name
				</th>

				<th class="smallish"> 
					Region code
				</th>

%				if ($tourn_settings->{"nsda_nats"}) { 
					<th class="smaller"> 
						Constrain also, except when you don't, <br />
						except when you do, except sometimes.
					</th>
%				}
				
			</tr>

			</thead>
			<tbody>

%			foreach my $region (@regions) { 

				<tr class="row">

					<td>
						<span class="hidden"><% $region->name %></span>
						<input 
							type  = "text"
							name  = "name_<% $region->id %>"
							size  = "32"
							value = "<% $region->name %>"
						>
					</td>

					<td class='centeralign'>
						<span class="hidden"><% $region->code %></span>
						<input 
							type  = "text"
							name  = "code_<% $region->id %>"
							size  = "8"
							value = "<% $region->code %>"
						>
					</td>

%					if ($tourn_settings->{"nsda_nats"}) { 

						<td class='centeralign'>

							<span class="hidden">
								<% $region_settings{$region->id} %>
							</span>

							<select 
								class = "fixedmed"
								name  = "bullshit_conflict_<% $region->id %>"
							>

							<option value=""></option>
%							foreach my $oregion (@regions) { 
%								next if $oregion->id == $region->id;
								<option 
									<% $region_settings{$region->id} == $oregion->id 
										? "selected"
										: ""
									%>
									value="<% $oregion->id %>"
								><% $oregion->name %></option>
%							}
							</select>
						</td>
%					}
				</tr>
%			}

			</tbody>

			<tr class="row">

				<td>
					<input 
						type        = "text"
						class       = "starthere"
						name        = "name_new"
						size        = "32"
						placeholder = "New region name"
					>
				</td>

				<td class="centeralign">
					<input 
						type        = "text"
						name        = "code_new"
						size        = "8"
						placeholder = "New code"
					>
				</td>

%				if ($tourn_settings->{"nsda_nats"}) { 
					<td class='centeralign'>
						<select 
							class = "fixedmed"
							name  = "bullshit_conflict_new"
						>
						<option value=""></option>
%							foreach my $oregion (@regions) { 
							<option 
								value="<% $oregion->id %>"
								><% $oregion->name %></option>
%							}
							</select>
						</td>
%					}


			</tr>
		</table>

		<div class="rightalign full libl marno">
			<input 
				type  = "submit"
				value = "Save regions"
			>
			</form> 
		</div>

	</div>


<%args>
	$tourn 
	$tourn_settings 
	$person
	$school_id => undef
</%args>
<%init>

	my $school = Tab::School->retrieve($school_id);

	if ($school) { 

		my @judges = $school->judges;

		foreach my $judge (@judges) { 

			foreach my $panel (
				$m->comp(
					"/funclib/judge_panels.mas", 
					judge => $judge
				)
			) { 

				foreach my $entry (
					$m->comp(
						"/funclib/panel_entries.mas", 
						panel => $panel
					)
				) { 

					
					foreach my $other_judge (@judges) { 

						next if $other_judge == $judge;

						unless (	
							Tab::Strike->search(
								judge => $other_judge->id,
								entry => $entry->id
							)->first
						) { 

							Tab::Strike->create({
								type  => "entry",
								tourn => $tourn,
								judge => $other_judge->id,
								entry => $entry->id
							});

						}
					}
				}
			}
		}
	}

</%init>

    <& "menu.mas", 
		tourn          => $tourn,
		tourn_settings => $tourn_settings,
		person         => $person,
		whoami         => 'phantom_judges',
	&>   

	<div class="main">

		<h2>Do the phantom judge strike thing</h2>

		<form 
			action = "phantom_judge_strike.mhtml"
			method = "post"
		>

			<div class="full row">

				<span class="twothirds">

					<select name="school_id" class="fixed">

						<option value=""></option>

%						foreach my $school ($tourn->schools) { 
							<option value="<% $school->id %>"
							><% $school->name %></option>
%						}

					</select>

				</span>

				<span class="third">
					<input type="submit" value="Strike">
					</form>
				</span>

			</div>

		</form>

	</div>


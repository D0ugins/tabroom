<%args>
	$tourn
	$person
	$email_id => undef
</%args>
<%init>

	my $email = Tab::Email->retrieve($email_id) 
		if $email_id;

	use Text::Wrap
    $Text::Wrap::columns = 72;

	my $switch;

</%init>

	<& 
		"email_menu.mas",
		tourn    => $tourn,
		email_id => $email_id
	&>

	<div class="main">

%		if ($email_id) { 

			<div class="full">

				<span class="half nospace">
					<h4>Previously sent message</h4>
				</span>

				<span class="half nospace rightalign">

					<form action="compose.mhtml" method="post">

						<input 
							type  = "hidden"
							name  = "email_id"
							value = "<% $email->id %>"
						>

						<input 
							type  = "submit"
							value = " Edit/Send Again "
						>

					</form>

				</span>

			</div>
				
			<div class="full lightrow">
				<span class="quarter strong">
					Subject:
				</span>

				<span class="threequarters">
					<% $email->subject %>
				</span>
			</div>

			<div class="full lightrow">
				<span class="quarter strong">
					Sender
				</span>

				<span class="threequarters">
					<% $email->sender->first." ".$email->sender->last %>
				</span>
			</div>

			<div class="full lightrow">
				<span class="quarter strong">
					Sent To:
				</span>

				<span class="threequarters">
					<% $email->sent_to %>
				</span>
			</div>

			<div class="full lightrow">
				<span class="quarter strong">
					Sent on:
				</span>

				<span class="threequarters">
					<% Tab::nicedt($email->sent_at->set_time_zone($tourn->tz)) %>
				</span>
			</div>

			<div class="full martopmore">
				<h4>Text of message:</h4>
			</div>

			<div class="full padtopmore">
				<% $email->content %>
			</div>


%		}
	
	</div>


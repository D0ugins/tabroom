<%args>
	$tourn
	$tourn_settings
	$person
	$email_id => undef
</%args>
<%init>

	my $email = Tab::Email->retrieve($email_id) 
		if $email_id;

	use Text::Wrap
    $Text::Wrap::columns = 72;

	my $switch;

</%init>

	<& 
		"email_menu.mas",
		tourn          => $tourn,
		tourn_settings => $tourn_settings,
		email_id       => $email_id,
		whoami         => "index"
	&>

	<div class="main">

%		if ($email_id) { 

			<div class="full">

				<span class="half nospace">
					<h4 class="nospace">Previously sent message</h4>
				</span>

				<span class="half nospace rightalign">

					<form action="compose.mhtml" method="post">

						<input 
							type  = "hidden"
							name  = "email_id"
							value = "<% $email ? $email->id : ""%>"
						>

						<input 
							type  = "submit"
							value = " Edit/Send Again "
						>

					</form>

				</span>

			</div>
				
			<div class="row">
				<span class="fifth semibold bluetext padvert">
					Subject:
				</span>

				<span class="fourfifths">
					<% $email->subject %>
				</span>
			</div>

			<div class="row">
				<span class="fifth semibold bluetext padvert">
					Sender
				</span>

				<span class="fourfifths">
					<% $email->sender->first." ".$email->sender->last %>
				</span>
			</div>

			<div class="row">
				<span class="fifth semibold bluetext padvert">
					Sent To:
				</span>

				<span class="fourfifths">
					<% $email->sent_to %>
				</span>
			</div>

			<div class="row">
				<span class="fifth semibold bluetext padvert">
					Sent on:
				</span>

				<span class="fourfifths">
					<% Tab::nicedt($email->sent_at->set_time_zone($tourn->tz)) %>
				</span>
			</div>

			<div class="full nospace martopmore">
				<h5 class="nospace">Text of message:</h5>
			</div>

			<div class="full padtop ltborder bigger">
				<% $email->content %>
			</div>

			<div class="full padtop nospace">
				<h5 class="nospace">Notes:</h5>
			</div>

			<div class="full padtopmore">
				<pre><% $email->metadata %></pre>
			</div>
%		}
	
	</div>


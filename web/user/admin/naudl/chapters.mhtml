<%args>
	$person
	$person_settings
	$tourn
</%args>
<%init>

	use JSON;
	use Tab::NSDA::EventCategory;

	my $now = DateTime->now();

	Tab::Chapter->columns(TEMP => "regioncode");

	Tab::Chapter->set_sql( naudl => "
		select distinct chapter.*, region.code as regioncode
		from chapter, chapter_circuit, region, circuit_setting
		where chapter.id = chapter_circuit.chapter
		and chapter_circuit.region = region.id
		and chapter_circuit.circuit = circuit_setting.circuit
		and circuit_setting.tag = 'naudl'
	");

	my @chapters = Tab::Chapter->search_naudl();

</%init>

	<& "../menu.mas", 
		person => $person,
		person_settings => $person_settings,
		whoami => "naudl_chapters"
	&>

	<div class="main">

		<span class="threequarters">
			<h2><% scalar @chapters %> NAUDL Schools</h2>
		</span>

		<span 
			class = "quarter rightalign"
			id    = "naudl_schools_buttonarea"
		>

		</span>

	<& "/funclib/tablesorter.mas", table => "naudl_schools" &>

	<table id="naudl_schools">

		<thead>

			<tr class="smallish yellowrow">

				<th>
					ID
				</th>

				<th>
					Name
				</th>

				<th>
					League Code
				</th>

				<th>
					Level
				</th>

				<th>
					Last change	
				</th>

			</tr>

		</thead>

		<tbody>

%			foreach my $chapter (@chapters) { 

				<tr>

					<td>
						TR<% $chapter->id %>
					</td>

					<td>
						<% $chapter->name %>
					</td>

					<td>
						<% $chapter->regioncode %>
					</td>

					<td>
						<% $chapter->level %>
					</td>

					<td>
						<% Tab::csvdt($chapter->timestamp) %>
					</td>

				</tr>
%			}

		</tbody>

	</table>

	</div>



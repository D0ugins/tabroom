<%args>
	$tourn
	$person
	$person_settings
</%args>
<%init>

	$m->abort unless $person->site_admin || $person_settings->{"nsda_admin"};

	foreach my $tag (
		"bias_statement",
		"about_page",
		"day_before",
		"day_after"
	) {

		my $setting = Tab::TournSetting->search(
			tourn => 0,
			tag   => $tag
		)->first;

		if ($setting && $setting->value_text eq $ARGS{$tag}) {

		} elsif ($setting && (not defined $ARGS{"tag"})) {

			$setting->delete();

			Tab::ChangeLog->create({
				person      => $person->id,
				tag         => 'sitewide',
				description => "Deleted sitewide page $tag",
				created_at  => DateTime->now()
			});

		} elsif ($setting) {

			$setting->value_text($ARGS{$tag});

			Tab::ChangeLog->create({
				person      => $person->id,
				tag         => 'sitewide',
				description => "Changed sitewide page $tag",
				created_at  => DateTime->now()
			});

		} elsif ($ARGS{$tag}) {

			my $setting = Tab::TournSetting->create({
				tourn      => 0,
				tag        => $tag,
				value      => "text",
				value_text => $ARGS{$tag}
			});

			Tab::ChangeLog->create({
				person      => $person->id,
				tag         => 'sitewide',
				description => "Changed sitewide page $tag",
				created_at  => DateTime->now()
			});
		}
	}

	my $msg = "Site wide messages saved";

	$m->redirect("messages.mhtml?msg=$msg");

</%init>

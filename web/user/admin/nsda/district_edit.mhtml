<%args>
	$person
	$person_settings
	$district_id
</%args>
<%init>

	my $district = Tab::District->retrieve($district_id);

	my @committee = $district->permissions;

</%init>

    <script>

        function switchme(personid,state){

            $("#"+personid).iphoneSwitch(
                state,
                function() { $.post("trial_switch.mhtml",{ person_id: personid, nsda_beta:  "1" }); },
                function() { $.post("trial_switch.mhtml",{ person_id: personid }); }
            );
        };  

    </script>


	<& 
		"../menu.mas",
		whoami          => "districts",
		person          => $person,
		person_settings => $person_settings
	&>

	<div class="main">

		<div class="full nospace">

			<span class="twothirds nospace">
				<h2><% $district->name %> District</h2>
			</span>

			<span class="third rightalign">
				<span class="twothirds marno">
					<h4>
						<% $district->location %>
					</h4>
				</span>
				<span class="third marno">
					<h4>
						<% $district->code %>
						<% $district->level %>
					</h4>
				</span>
			</span>

		</div>

		<h4>District Committee</h4>

%			my %committee = $m->comp(
%				"/funclib/district_committee.mas", 
%				district => $district
%			);

			<div class="full lightrow ltyellow strong smallish">

				<span class="sixth">
					Role
				</span>

				<span class="third">
					Name
				</span>

				<span class="third">
					Email
				</span>

				<span class="sixth strong">
					Can Create Tournaments
				</span>

			</div>

%			foreach my $role ("chair", "member") { 

%				next unless $committee{$role};

%				foreach my $person (@{$committee{$role}}) { 

					<div class="full lightrow">

						<span class="sixth strong">
							<% $role eq "chair" ? ucfirst($role) : "" %>
						</span>

						<span class="third">
							<% $person->first." ".$person->last %>
						</span>

						<span class="third">
							<a 
								href="mailto:<% $person->email %>" 
								class="plain"
							>
								<% $person->email %>
							</a>
						</span>

%						my $nsda_beta = $person->setting("nsda_beta");

						<span class="sixth strong">

							<span class="hidden">
								<% $nsda_beta ? "2" : "1" %>
							</span>
							
							<script type="text/javascript"> 
								$(function() { 
									switchme(<% $person->id %>,"<% ($nsda_beta) ? "on" : "off" %>"); 
								});
							</script>
							
							<div 
								class = "phoneswitch"
								id    = "<% $person->id %>"
							></div>

						</span>

					</div>

%				}

%			}

		<h4 class="martop">
			District Tournaments
		</h4>

		<div class="full nospace">

			<span class="twothirds">
				<h4 class="martop">
					District Members in Tabroom
				</h4>
			</span>

			<span class="third rightalign">
				<a 
					class="buttonwhite bluetext"
					href="district_update.mhtml?district_id=<% $district->id %>"
				>Update District
				</a>
			</span>
		</div>


		<& "/funclib/tablesorter.mas", table => "sortmebaby" &>

		<table id="sortmebaby">

			<thead>
				<tr class="yellowrow">

					<th>
						School
					</th>

					<th>
						Degrees
					</th>

					<th>
						Paid
					</th>

					<th>
						Type
					</th>

				</tr>

			</thead>

			<tbody>

%			foreach my $chapter ($district->chapters) { 

				<tr>

					<td>
						<% $chapter->name %>
					</td>

					<td>
						<% $chapter->setting("nsda_degrees") %>
					</td>

					<td>
						<% $chapter->setting("nsda_paid") ? "Y" : "N"  %>
					</td>

					<td>
						<% $chapter->setting("nsda_degrees") %>
					</td>

				</tr>

%			}

			</tbody>

		</table>


	</div>


<%args>
	$person
</%args>
<%init>

	$m->abort unless $person->site_admin;

	my @districts = Tab::District->retrieve_all;

	my @district_chairs = Tab::Permission->search( tag => "chair");

	my %district_chair = map {$_->district->id => $_->person} @district_chairs;
	

</%init>

<div class="main">

	<h2>Districts</h2>

	<& "/funclib/tablesorter.mas", table => "sortdistricts" &>

	<table id="sortdistricts">

		<thead>

			<tr class="yellowrow">

				<th>
					District
				</th>

				<th>
					Location
				</th>

				<th>
					Code Number
				</th>

				<th>
					Type
				</th>

				<th>
					Chair
				</th>

				<th class="nosort">
				</th>

			</tr>

		</thead>

		<tbody>

%		foreach my $district (Tab::District->retrieve_all) { 

			<tr>

				<td>
					<% $district->name %>
				</td>

				<td>
					<% $district->location %>
				</td>

				<td>
					<% $district->code %>
				</td>

				<td>
					<% $district->realm %>
				</td>

				<td class="smallish padno">
%					if ($district_chair{$district->id}) { 
						<a 
							class="white full padtop padbottom padleft"
							href="mailto: <% $district_chair{$district->id}->email %>" 
							title="<% $district_chair{$district->id}->email %>"
						>
							<% $district_chair{$district->id}->first %>
							<% $district_chair{$district->id}->last %>
						</a>
%					}
				</td>

				<td class="centeralign padless">
					<a 
						class="bluetext buttonwhite fa fa-edit"
						href="district_edit.mhtml?district_id=<% $district->id %>"
					></a>
				</td>

			</tr>

%		}

		</tbody>

	</table>


</div>

<%args>
	$person
	$chapter_id
</%args>
<%init>

	my $chapter = Tab::Chapter->retrieve($chapter_id);

	$m->comp("/funclib/abort.mas", message => "No valid school found for ID $chapter_id");

	foreach my $student ($chapter->students) { 
		$student->first($ARGS{$student->id."_first"});
		$student->middle($ARGS{$student->id."_middle"});
		$student->last($ARGS{$student->id."_last"});
		$student->grad_year($ARGS{$student->id."_grad_year"});
		$student->ualt_id($ARGS{$student->id."_ualt_id"}) if defined $ARGS{$student->id."_ualt_id"};
		$student->nsda($ARGS{$student->id."_nsda"}) if defined $ARGS{$student->id."_nsda"};
		$student->retired($ARGS{$student->id."_retired"});
		$student->chapter($ARGS{$student->id."_chapter"});
		$student->update;

		if ($ARGS{$student->id."_nsda"}) { 
			$m->comp("/funclib/nsda_person_link.mas", 
				student => $student, 
				nsda => $ARGS{$student->id."_nsda"}
			);
		} elsif ($ARGS{$student->id."_ualt_id"}) { 
			$m->comp("/funclib/nsda_person_link.mas", 
				student => $student, 
				ualt_id => $ARGS{$student->id."_ualt_id"}
			);
		}
	}

	my $msg = "Chapter details saved";

	$m->redirect("chapter_roster.mhtml?chapter_id=".$chapter->id."&msg=$msg");

</%init>

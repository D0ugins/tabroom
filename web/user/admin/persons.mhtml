<%args>
	$person
	$person_settings
	$session
	$last  => undef
	$email => undef
</%args>
<%init>

	my %search_terms;

	my @persons;

	if ($last && $email) { 

		@persons = Tab::Person->search_like( 
			email => $email."%",
			last  => $last."%"
		);

	} elsif ($last) { 

		@persons = Tab::Person->search_like( 
			last => $last."%" 
		);

	} elsif ($email) { 
	
		@persons = Tab::Person->search_like( 
			email => $email."%" 
		);
	}

	@persons = sort {$a->first cmp $b->first} @persons;
	@persons = sort {$a->last cmp $b->last} @persons;

</%init>

	<& menu.mas, 
		person          => $person,
		person_settings => $person_settings,
		whoami          => "persons"
	&>

	<div class="main">

		<h2>User Account Search</h2>

		<table id="sortable">

			<tr class="row">

				<td>
					Last name:
				</td>

				<td>
					<form action="persons.mhtml">

					<input 
						type        = "text"
						id          = "default"
						size        = "32"
						name        = "last"
						placeholder = "Last Name"
						value       = "<% $last %>"
					>
				</td>

			</tr>

			<tr class="row">

				<td>
					Email address
				</td>

				<td>
					<input 
						type        = "text"
						size        = "32"
						name        = "email"
						placeholder = "Email"
						value       = "<% $email %>"
					>
				</td>

			</tr>

			<tr class="liblrow">
				
				<td colspan="2" class="rightalign">
					<input type="submit" value=" Go ">
					</form>
				</td>

			</tr>

		</table>

%		if ($email || $last) { 

			<span class="sixth">
				<h5>Search:</h5>
			</span>

			<span class="seventenths centeralign">
				<h6 class="redtext nospace">
					<% $last %>
				</h6>

				<h6 class="bluetext nospace">
					<% $email %> 
				</h6>
			</span>

			<span 
				id    = "sortmenow_buttonarea"
				class = "eighth rightalign"
			></span>

%			if (@persons) { 

				<& "/funclib/tablesorter.mas", 
					table => "sortmenow"
				&>

				<table id="sortmenow">

					<thead>
						<tr class="yellowrow">

							<th>
								First
							</th>

							<th>
								Last
							</th>

							<th>
								Email
							</th>

							<th>
								Locale
							</th>

							<th 
								colspan = "3"
								class   = "nosort"
							></th>

						</tr>
					</thead>

					<tbody>

%					foreach my $account (@persons) { 
			
						<tr class="row">

							<td>
								<% $account->first %>
							</td>

							<td>
								<% $account->last %>
							</td>

							<td class="nospace padleft">
								<a
									href="mailto:<% $account->email %>"
									class="white full marno"
								>
								<% $account->email %>
								</a>
							</td>

							<td class="centeralign">
								<% $account->state ? $account->state."/" : "" %><% $account->country %>
							</td>

							<td class="centeralign padless">
								<a 
									class = "bluetext button buttonwhite fa fa-lg fa-edit hover" 
									href  = "person_edit.mhtml?edit_id=<% $account->id %>"
									title = "Edit user account"
								>
								</a>
							</td>

						 	<td class="centeralign padless">
								<a 
									class = "greentext button buttonwhite fa fa-lg fa-sign-in hover"
									title = "Sign in as user"
									href  = "su.mhtml?su_id=<% $account->id %>"
								>
								</a>

							</td>

						 	<td class="centeralign padless">
								<a 
									class = "redtext button buttonwhite fa fa-lg fa-compress hover"
									title = "Merge duplicate accounts"
									href  = "person_merge.mhtml?target_id=<% $account->id %>"
								>
								</a>
							</td>

						</tr>

%					}

					</tbody>

				</table>

%			} else { 
			
				<h5>None found</h5>

				<p class="centeralign">
					<object 
						style="height: 195px; width: 320px">

						<param 
							name="movie" 
							value="http://www.youtube.com/v/1ytCEuuW2_A?version=3&feature=player_detailpage&autoplay=1"
						>
						
						<param 
							name="allowFullScreen" 
							value="true"
						>
						
						<param 
							name="allowScriptAccess" 
							value="always"
						>
						
						<embed 
							type              = "application/x-shockwave-flash"
							allowfullscreen   = "true"
							allowScriptAccess = "always"
							width             = "320"
							height            = "195"
							src = "http://www.youtube.com/v/1ytCEuuW2_A?version=3&feature=player_detailpage" 
						>
					</object>
				</p>

%			}
%		}

	</div>


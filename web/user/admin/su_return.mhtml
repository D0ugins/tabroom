<%args>
	$person
	$session
</%args>
<%init>

	my $become = $session->su;
	my $log = $person->email." (".$person->last.") has returned to ".$become->email." (".$become->last.")";

	unless ($become->id > 0 && $become->site_admin) { 
		my $err = "Something has gone horribly wrong and I was not able to restore you.  Log in again";
		$session->delete;
		$m->redirect("/index/index.mhtml?err=$err");
	}

	$session->person($become->id);
	$session->su("");
	$session->update;

    system "$Tab::eventlog $log";

	my $msg = "Presto!  Identity crisis resolved.  You are back to your original self.  Or....are you?";

	$m->redirect("/user/home.mhtml?msg=$msg");

</%init>

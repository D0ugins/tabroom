<%args>
	$login_id
	$person
	$certain => undef
</%args>
<%init>

	my $login = Tab::Login->retrieve($login_id);
	$m->abort unless $login;

	if ( $certain eq "I am certain" ) { 


		my $msg = "Login ".$login->username." from person account ".$login->person->email;
		$msg .= "has been completely and utterly ";
		$msg .= "wiped from the face of the earth.  I hope you meant to do that ";
		$msg .= "because if you did not, it\'s your funeral.";

		my $person_id = $login->person->id;
		$login->delete;

		$m->redirect("/user/admin/person_edit.mhtml?edit_id=$person_id&msg=$msg");

	}

	my @all_logins = $login->person->logins;

	if (scalar @all_logins < 2) { 
		my $warn = "No, can't do that because that person record only has a single login.";
		$m->comp("/funclib/abort.mas", message => $warn);
	}

</%init>

	<div 
		class = "blankfull"
		style = "text-align: center; min-height: 650px;"
	>

		<&  "/funclib/warning.mas", person => $person &>

		<p class="warning"> 
			You are about to permanently delete the login <% $login->username %>.
		</p>

		<p>
			It will not delete the person account for 
			<% $login->person->first." ".$login->person->last %>,
			just this particular login thereof.
		</p>

		<p>
			This cannot be undone.  Don't say I didn't warn you.  
		</p>

%	 	if ($certain) {

			<p style="color: red;">
				You did not type "I am certain", exactly like that.  Try again!
			</p>

%	 	}

		<br>
		<br>
		
		<p>
			To proceed, type "I am certain" in the box below:
		</p>

		<br>
		<br>

		<form 
			action = "login_rm.mhtml"
			method = "post"
		>

			<input 
				type  = "hidden"
				value = "<% $login_id %>"
				name  = "login_id"
			>
			
			<p class="centeralign">
				<input 
					type           = "text"
					name           = "certain"
					size           = "20"
					autocomplete   = "off"
					autocorrect    = "off"
					autocapitalize = "off"
					spellcheck     = "false"
					class          = "martop notfirst">
			</p>
			
			<p class="centeralign">
				<input  
					type  = "submit"
					value = "Delete Login"
				>
			</p>
		</form>


	</div>

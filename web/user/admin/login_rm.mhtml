<%args>
	$person
	$login_id => undef
</%args>
<%init>

	my $msg;
	my $err;
	my $victim;

	if ($login_id) {

		my $login = Tab::Login->retrieve($login_id);
		$victim = $login->person;

		my @all = $victim->logins();

		if (not defined $login) {

			$err = "No such login found";

		} elsif ($login->person != $victim) {

			$err = "No such login found";

		} elsif (lc($login->username) eq lc($victim->email)) {

			$err = "You may not delete a primary login (the login that matches the account email)";

		} elsif (scalar @all == 1) {

			$login->username(lc($victim->email));
			$login->update();

			$err = "You may not delete the person's only login.  Updated to match email.";

		} else {

			$msg = "Spare login ".$login->username." deleted";
			$login->delete();
		}

	}

	$m->redirect("/user/admin/person_edit.mhtml?edit_id=".$victim."&err=$err&msg=$msg");

</%init>

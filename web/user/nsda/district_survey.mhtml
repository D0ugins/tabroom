<%args>
	$person
	$person_settings => undef
	$district_id     => undef
</%args>
<%init>

    my $district = Tab::District->retrieve($district_id) if $district_id;

    $m->abort unless $district;

    my $permission = Tab::Permission->search( 
        district => $district->id,
        person   => $person->id 
    )->first;

    $permission++ if $person->site_admin;
    $permission++ if $person_settings->{"nsda_admin"};

	unless ($permission) { 
		$m->print('<div class="main"><h4 class="warning">');
		$m->print("You do not have access to that district");
		$m->print('</h4></div>');
	}

	my @existing = $m->comp(
		"/funclib/district_tourns.mas", 
		district => $district
	);

	my $tourn = shift @existing if @existing;

	my @events = sort {$a->type cmp $b->type} $tourn->events if $tourn;

</%init>

	<script>

		function allType (eventID, eventType) { 

			$("."+eventType).val(
				$("#"+eventID).val()
			);

		}

	</script>

	<div class="main">

		<h2>Before you go...</h2>

		<p class='marbottommore'>
			To better understand the expenses that schools face when entering
			the district tournament series, we ask that you provide the
			established fees for each event. We understand a number of
			districts do unique things to facilitate their competition, so
			please use the last question to provide greater clarity/context. 
		</p>

		<form 
			action = "district_done.mhtml"
			method = "post"
		>

		<input
			type="hidden"
			name="district_id"
			value="<% $district->id %>"
		>

		<div class="row">

			<span class="threequarters semibold">
				What is your base/school fee?  (For hospitality/general district use)
			</span>

			<span class="quarter centeralign">
				<input 
					type = "number"
					name = "survey_school_fee"
					min  = 0
					max  = 9999
					size = 8
					<% $tourn->setting('survey_school_fee') ? 
						'value = "'.$tourn->setting('survey_school_fee').'"' : 
						'' %>
				>
			</span>

		</div>

		<div class="row">

			<span class="twofifths semibold">
				What are your judging obligations?
			</span>

			<span class="threefifths">

				<div class="full marno padless">

					<span class="third">
						In IE/Speech:
					</span>

					<span class="third">
						<input 
							type="number"
							name = "survey_obligation_ie"
							min  = 0
							max  = 9999
							size = 8
							<% $tourn->setting('survey_obligation_ie') ? 
								'value = "'.$tourn->setting('survey_obligation_ie').'"' : 
								'' %>
						>
					</span>
					<span class="quarter">
						per entry
					</span>

				</div>

				<div class="full marno padless">

					<span class="third">
						In Debate:
					</span>

					<span class="third">
						<input 
							type="number"
							name = "survey_obligation_debate"
							min  = 0
							max  = 9999
							size = 8
							<% $tourn->setting('survey_obligation_debate') ? 
								'value = "'.$tourn->setting('survey_obligation_debate').'"' : 
								'' %>
						>
					</span>
					<span class="quarter">
						per entry
					</span>


				</div>

				<div class="full marno padless">

					<span class="third">
						In Congress:
					</span>

					<span class="third">
						<input 
							type="number"
							name = "survey_obligation_con"
							min  = 0
							max  = 9999
							size = 8
							<% $tourn->setting('survey_obligation_con') ?
								'value = "'.$tourn->setting('survey_obligation_con').'"' : 
								'' %>
						>
					</span>
					<span class="quarter">
						per entry
					</span>


				</div>

			</span>

		</div>

		<div class="row">

			<span class="twofifths semibold">
				What do you charge for a hired judge?
			</span>

			<span class="threefifths">

				<div class="full marno padless">

					<span class="twofifths">
						In IE/Speech:
					</span>

					<span class="fifth">
						<input 
							type="number"
							name = "survey_hire_ie"
							min  = 0
							max  = 9999
							size = 8
							<% $tourn->setting('survey_hire_ie') ?
								'value = "'.$tourn->setting('survey_hire_ie').'"' : 
								'' %>
						>
					</span>

					<label for="survey_no_hire_ie">
						<span class="twofifths hover centeralign">
							<input 
								type  = "checkbox"
								id    = "survey_no_hire_ie"
								name  = "survey_no_hire_ie"
								value = 1
								<% $tourn->setting('survey_no_hire_ie') ?
									'checked = "true"' : 
									'' %>
							>
							None Offered
					
					</label>

				</div>

				<div class="full marno padless">

					<span class="twofifths">
						In Debate:
					</span>

					<span class="fifth">
						<input 
							type="number"
							name = "survey_hire_debate"
							min  = 0
							max  = 9999
							size = 8
							<% $tourn->setting('survey_hire_debate') ?
								'value = "'.$tourn->setting('survey_hire_debate').'"' : 
								'' %>
						>
					</span>

					<label for="survey_no_hire_debate">
						<span class="twofifths hover centeralign">
							<input 
								type  = "checkbox"
								name  = "survey_no_hire_debate"
								id    = "survey_no_hire_debate"
								value = 1
								<% $tourn->setting('survey_no_hire_debate') ?
									'checked = "true"' : 
									'' %>
							>
							None Offered
						</span>
					</label>

				</div>

				<div class="full marno padless">

					<span class="twofifths">
						In Congress:
					</span>

					<span class="fifth">
						<input 
							type="number"
							name = "survey_hire_con"
							min  = 0
							max  = 9999
							size = 8
							<% $tourn->setting('survey_hire_con') ?
								'value = "'.$tourn->setting('survey_hire_con').'"' : 
								'' %>						
						>
					</span>

					<label for="survey_no_hire_con">
						<span class="twofifths hover centeralign">
							<input 
								type  = "checkbox"
								name  = "survey_no_hire_con"
								id    = "survey_no_hire_con"
								value = 1
								<% $tourn->setting('survey_no_hire_con') ?
									'checked = "true"' : 
									'' %>
							>
							None Offered
						</span>
					</label>

				</div>

			</span>

		</div>

		<h5 class="martopmore">
			Entry Fees
		</h5>

%		my %notfirst;
%		my $lasttype;

%		foreach my $event (@events) { 

			<div class="row <% $lasttype ne $event->type ? "bordertop martopmore" : "" %>">

				<span class="threeeighths">
					Entry fee in <% $event->name %>:
				</span>

				<span class="eighth centeralign">
					<input 
						type  = "number"
						name  = "fee_<% $event->id %>"
						class = "<% $event->type %>"
						id    = "<% $event->id %>"
						min   = 0
						max   = 9999
						size  = 8
						<%  $event->setting('survey_fees') ?
							'value = "'. $event->setting('survey_fees') .'"' : 
							'' %>

					>
				</span>

				<span class="half centeralign martop marbottom">
%					unless ($notfirst{$event->type}++) { 
					<a
						class="buttonwhite bluetext smaller padless"
						onClick = "allType(<% $event->id %>, '<% $event->type %>');"
					> Copy to All <% ucfirst($event->type) %> Events</a>
%					}
				</span>

			</div>

%			$lasttype = $event->type;

%		}

		<h6
			class="martopmore marbottom"
		>
			Please provide any additional clarity or explanation for your fees.
		</h6>

		<& "/funclib/editor.mas" &>

		<textarea 
			name = "survey_explanation"
			rows = "5"
			cols = "60"
		>
		<% $tourn->setting('survey_explanation') ?
			$tourn->setting('survey_explanation') : 
			'' %>
		</textarea>

		<div class="row libl rightalign">
			<input 
				type  = "submit"
				value = "Save Survey"
			>

			</form>

		</div>

	</div>


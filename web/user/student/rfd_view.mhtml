<%args>
	$person
	$entry_id
	$panel_id
	$judge_id
</%args>
<%init>

	my $panel = Tab::Panel->retrieve($panel_id);
	my $judge = Tab::Judge->retrieve($judge_id);
	my $entry = Tab::Entry->retrieve($entry_id);

	unless ($entry) { 
		$m->comp("/funclib/abort.mas",
			message => "No entry found with ID $entry_id"
		);
	}
	unless ($judge) { 
		$m->comp("/funclib/abort.mas",
			message => "No judge found with ID $judge_id"
		);
	}

	unless ($panel) { 
		$m->comp("/funclib/abort.mas",
			message => "No section found with ID $panel_id"
		);
	}

	my @scores = $m->comp(
		"/funclib/panel_scores.mas", 
			panel => $panel,
			judge => $judge,
			entry => $entry
		);

	my @comments = $m->comp(
		"/funclib/panel_scores.mas", 
			panel    => $panel,
			judge    => $judge,
			entry    => $entry,
			comments => 1
		);

	my $ok;

	$ok++ if $person->site_admin;

	foreach my $student ($entry->students) { 

		$ok++ if $student->person 
			&& $student->person->id == $person->id;

		foreach my $coach ($student->chapter->permissions) { 

			$ok++ if $coach->tag eq "chapter" 
				&& $coach->person->id == $person->id;
		}
	}

	$m->abort unless $ok;

	$m->abort unless $panel->round->post_results > 0;

	my $round = $panel->round;
	my $event = $round->event;


</%init>

	<& "/user/menu.mas", 
		whoami => "student", 
		person => $person 
	&>

	<div class="main">

		<div class="block">

			<span class="seveneighths nospace">
				<h4 class="nospace"><% $event->tourn->name %></h4>
				<h6><% $entry->code %></h6>
			</span>

			<span class="eighth rightalign">
				<a 
					class="centeralign bluetext strong button buttonwhite fa-lg fa fa-home" 
					href="/user/home.mhtml"
				>
				</a>
			</span>
		</div>

		<hr/> 

		<div class="full row padno">

			<span class="twofifths nospace padleft">

%				if ($judge) { 
					<h6 class="semibold">
						<% $round->realname %>: <% $judge->first." ".$judge->last %>
					</h6>
%				}

			</span>

			<span class="threefifths rightalign">

				<span class="quarter centeralign">

%					foreach my $score (@scores) { 
%						next unless $score->tag eq "ballot";
						<h5 class="redtext"> <% $score->value == 1 ? "WIN" : "LOSS" %></h5>
%					}
				</span>

				<span class="threequarters">

%				foreach my $student ($entry->students) { 

					<div class="full marno padless">

						<span class="third padless marno semibold">
							<% $student->last %>:
						</span>

%						foreach my $score (@scores) { 

%							next unless $score->tag eq "points" 
%										&& $score->student 
%										&& $score->student->id == $student->id;

							<span class="third padless marno">
								<% $round->post_results >= 2 ? $score->value : "" %>
							</span>
%						}

%						foreach my $score (@scores) { 

%							next unless $score->tag eq "rank" 
%								&& $score->student 
%								&& $score->student->id == $student->id;

							<span class="fifth padless marno">
								<% $round->post_results == 2 ? $score->value : "" %>
							</span>
%						}

					</div>

%				}

				</span>

			</span>

		</div>

%		foreach my $comment (@comments) { 

%			if ($comment->tag eq "rfd") { 
				<div class="row full">
					<% $comment->content %>
				</div>
%			} 

%			if ($comment->tag eq "comments") { 

				<h6 class="bluetext semibold martopmore">
					Comments specific to <% $comment->ballot->entry->code %>:
				</h6>

				<div class="row full">
					<% $comment->content %>
				</div>
%			}

%		}	


	</div>


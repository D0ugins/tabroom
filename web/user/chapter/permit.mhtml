<%args>
	$chapter_judge_id => undef
	$student_id       => undef
</%args>
<%init>

	if ($chapter_judge_id) { 

		my $cj = Tab::ChapterJudge->retrieve($chapter_judge_id);

		$cj->person($cj->person_request);
		$cj->person_request("");
		$cj->update;

		my @judges = $cj->judges;

		foreach my $judge (@judges)  {
			$judge->person($cj->person->id);
			$judge->setting("phone", $cj->person->phone);
			$judge->setting("email", $cj->person->email);
			$judge->update;
		}

		my $msg = $cj->person->email." now has access to the judge ".$cj->first." ".$cj->last;
	
		$m->redirect("judges.mhtml?chapter_id=".$cj->chapter->id."&msg=$msg");
	
	}

	if ($student_id) { 

		my $student = Tab::Student->retrieve($student_id);

		$student->person($student->person_request);
		$student->person_request("");
		$student->update;

		my $msg = $student->person->email." now has access to the student ".$student->first." ".$student->last;

		$m->redirect("students.mhtml?chapter_id=".$student->chapter->id."&msg=$msg");

	}

</%init>

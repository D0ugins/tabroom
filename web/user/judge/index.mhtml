<%args>
	$person
	$judge_id => undef
	$past     => undef
</%args>
<%init>

	my $judge = Tab::Judge->retrieve($judge_id);

	if ($judge > 0 && $judge->person && $judge->person->id != $person->id) {
		my $name = $person->last;
		$m->print("That judge is not you.  Stop messing around, $name");
		$m->abort;
	}

	my @judges = $person->judges unless $judge;
	push (@judges, $judge) if $judge;
	my $now = DateTime->now();

</%init>

	<& "/user/menu.mas", person => $person, whoami => "judgeindex" &>

	<div class="main">

		<h2>Judging</h2>

<%perl>
		foreach my $judge (@judges) {

			my $category = $judge->category;
			next unless $category;

			my $tourn = $category->tourn;
			next unless $tourn;

			my $tz = $tourn->tz;
			$tz = "UTC" unless $tz;

			my $start = $tourn->start->set_time_zone($tz);
			my $end = $tourn->end->set_time_zone($tz);
			next unless $past || $end > $now;

</%perl>
			<h5 class="martopmore"><% $tourn->name %> </h5>

			<div class="full nospace odd">

			<span class="pagehalf borderright marno">

				<div class="nospace">
					<span class="third semibold ">
						Dates
					</span>
					<span class="twothirds ">
						<% Tab::niceshortdate($start) %>
						<% $start->day != $end->day ? " - ".Tab::niceshortdate($end) : "" %>/<% $start->year %>
					</span>
				</div>

				<div class="nospace">
					<span class="third semibold ">
						School
					</span>
					<span class="twothirds ">
						<% $judge->school > 0 ? $judge->school->short_name : "Hired" %>
					</span>
				</div>

				<div class="nospace">
					<span class="third semibold ">
						Category
					</span>

					<span class="twothirds ">
						<% $category->name %>
					</span>
				</div>

%				unless ($category->setting("no_codes")) {
					<div class="nospace">
						<span class="half  semibold">
							Judge Code
						</span>
						<span class="half ">
							<% $judge->code %>
						</span>
					</div>
%				}

%				if ($start < $now) {
					<div class="nospace">
						<span class="half  semibold">
							Debates judged
						</span>
						<span class="half ">
							<% scalar $m->comp("/funclib/judge_panels.mas", judge => $judge) %>
						</span>
					</div>
%				}

%				if ($category->setting("rounds_per")) {

					<div class="nospace">
						<span class="third semibold">
							Round Obligation
						</span>
						<span class="half leftalign">
							<% $judge->obligation %> <% $judge->school ? "for ".$judge->school->short_name : "" %>
						</span>
						<span class="sixth">
							<% $judge->hired %> hired
						</span>
					</div>
%				}

			</span><span class="pagehalf borderleft marno" style="margin-left: -1px !important;">

%				if ($end > $now && $category->setting("diversity_selfie")) {
%					if ($category->setting("diversity_notice")) {
						<p class="explain">
							<% $category->setting("diversity_notice") %>
						</p>
%					}

					<div class="nospace ltborderbottom">
						<label for="<% $judge->id %>_diverse">
							<span class="fourfifths semibold centeralign">
								Identify as diversity enhancing?
							</span>

							<span class="sixth centeralign">
								<label class = "switch smaller">
									<input
										class         = "padsettingbox"
										type          = "checkbox"
										value         = "1"
										id            = "<% $judge->id %>_diverse"
										setting_name  = "diverse"
										target_id     = "<% $judge->id %>"
										onChange      = "postSwitch( this, 'judge_switch.mhtml');"
										<%  $judge->setting("diverse") ? 'checked' : "" %>
									>
									<div class="<% $ARGS{"onred"} ? "onred" : "" %> slider"></div>
								</label>
							</span>
						</label>
					</div>
%				}

%				if ($judge->category->setting("conflicts")) {
%					if ($now > $judge->category->setting("strike_start")) {
						<div class="nospace centeralign padvert">
							<a class="half ltbuttonwhite bluetext"
								href="judge_conflicts.mhtml?judge_id=<% $judge->id %>"
							>Tournament Conflicts</a>
						</div>
%					}
%				}

%				if ($category->tourn->setting("nsda_nats")) {
%					my $nationals = $m->comp("/funclib/current_nationals.mas");
					<div class="nospace centeralign padvert">
						<a class="half ltbuttonwhite bluetext"
							href="panels.mhtml">
								NSDA Diversity &amp Paradigm Forms
							</a>
						</span>
					</div>
<%perl>
				}

				if ($m->comp("/funclib/person_panels.mas", person => $person, judge => $judge)
					|| $m->comp("/funclib/person_published.mas", person => $person, judge => $judge)
				) {
</%perl>
					<div class="nospace centeralign padvert">
						<a class="half ltbuttonwhite bluetext"
							href="panels.mhtml"
						>Online Ballots</a>
					</div>
%				}

			</span>
			</div>

%		}

	</div>


<%args>
	$person
	$session
	$default => undef
</%args>
<%init>

	my @judges = $m->comp(
		"/funclib/person_judges.mas",
		person    => $person,
		nationals => 1
	);

	my %categories;
	foreach my $judge (@judges) {
		$categories{$judge->category->id} = $judge->category;
	}

	my @jpools;

	my $nationals = $m->comp("/funclib/current_nationals.mas");

	foreach my $category_id (keys %categories) {
		push @jpools, $m->comp(
			"/funclib/category_jpools.mas",
			category => $categories{$category_id},
			limit    => "registrant"
		);
	}

</%init>

	<&
		"/user/menu.mas",
		person => $person,
	&>

	<div class="main">

		<div class="full padvert borderbottom nospace">

			<span class="fivesixths nospace">
				<h2 class="normalweight padless marno">
					<% $nationals->start->year %>
					<% $nationals->name %>
				</h2>

			</span>

			<span class="sixth rightalign nospace">
				<img
					src   = "<% $Tab::s3_url %>/<% $nationals->id."/".$nationals->setting("logo") %>"
					alt   = ""
					style = "max-width: 128px; max-height: 128px;"
				/>
			</span>

		</div>

%		foreach my $judge (@judges) {

%			my @questionnaires = ("NSDADiversity");
%			my %in_jpools = map {$_->id => $_} $judge->jpools();

			<span class="half nospace">
				<h5 class="bluetext">
				<% $judge->first." ".$judge->last %>
				</h5>
			</span>

			<span class="half nospace rightalign">
				<h5 class="bluetext">
				For: <% $judge->school ? $judge->school->name : "No School/Hired" %>
				</h5>
			</span>

			<div class="full odd marno">
				<span class="fifth semibold redtext">
					Rounds: <% $judge->obligation %>
				</span>

				<span class="fourfifths semibold bluetext rightalign">

					<span class="fifth semibold bluetext rightalign">
						Pools:
					</span>
<%perl>
					my $notfirst;
					foreach my $jpool (@jpools) {
						next unless $in_jpools{$jpool->id};

						push @questionnaires, $jpool->setting("paradigm_form")
							if $jpool->setting("paradigm_form");

						$m->print(", ") if $notfirst++;
						$m->print($jpool->name);
					}
</%perl>
				</span>
			</div>

			<div class="full row nospace">

				<span class="twothirds semibold bluetext">
					Identify as a diversity-enhancing judge:
				</span>

				<label for="<% $judge->id %>_diverse">
					<span class="third centeralign">
						<span class="half rightalign">
							<label class = "switch smaller">
								<input
									class         = "padsettingbox"
									type          = "checkbox"
									value         = "1"
									id            = "<% $judge->id %>_diverse"
									setting_name  = "diverse"
									target_id     = "<% $judge->id %>"
									onChange      = "postSwitch( this, 'judge_switch.mhtml');"
									<%  $judge->setting("diverse") ? 'checked' : "" %>
								>
								<div class="<% $ARGS{"onred"} ? "onred" : "" %> slider"></div>
							</label>
						</span>
					</span>
				</label>
			</div>

			<form
				action="nats_nomination.mhtml"
				method="post"
			>

			<input
				type  = "hidden"
				name  = "judge_id"
				value = "<% $judge->id %>"
			>

			<h5>Contact Information:</h5>

			<div class="row">
				<span class="sixth semibold bluetext">
					Phone:
				</span>

				<span class="third">
					<input
						type  = "tel"
						name  = "phone"
						size  = "32"
						value = "<% $judge->person ? $judge->person->phone : $judge->setting("phone") %>"
					>
				</span>

				<span class="sixth semibold bluetext">
					Email:
				</span>

				<span class="third semibold redtext">
					<% $judge->person ? $judge->person->email : "??" %>
				</span>
			</div>

			<& "/user/enter/nats/nomination.mas",
				judge => $judge,
				me    => 1
			&>

			</form>

%			foreach my $tag (@questionnaires) {

				<div class="full oddrow bordertop martopmore">

					<form
						action = "nats_save.mhtml"
						method = "post"
					>
						<input
							type  = "hidden"
							name  = "judge_id"
							value = "<% $judge->id %>"
						>

						<input
							type  = "hidden"
							name  = "tag"
							value = "<% $tag %>"
						>

						<input
							type  = "hidden"
							name  = "saveme"
							value = "1"
						>

						<&
							"/funclib/questionnaire.mas",
							judge => $judge,
							tag   => $tag
						&>

						<span class="libl full marno rightalign">
							<input
								type  = "submit"
								value = "Save Answers"
							>
						</span>
					</form>
				</div>
%			}
%		}
	</div>

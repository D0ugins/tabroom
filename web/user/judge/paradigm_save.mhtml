<%args>
	$person
</%args>
<%init>

	my $tz = $person->tz;
	$tz = "UTC" unless $tz;

	my $now = DateTime->now(time_zone => $tz);

	my $text = $m->comp(
		"/funclib/save_editor.mas", 
		text => $ARGS{"paradigm"}
	);

	if ($text) { 

		Tab::PersonSetting->set_sql( delete => "
			delete from person_setting
			where person = ? 
			and (
				tag = 'paradigm'
				or tag = 'paradigm_timestamp'
			)
		");

		Tab::PersonSetting->sql_delete->execute($person->id);

		eval {
			$person->setting("paradigm", "text", $text);
			$person->setting("paradigm_timestamp", "date", $now);
		};
	};

	my $msg = "Paradigm saved";
	$m->redirect("/user/judge/paradigm.mhtml?msg=$msg");

</%init>

<%args>
	$school_id
	$tourn_id
	$email => undef
	$type  => "school"
</%args>
<%init>

	my $person = Tab::Person->search( 
		email => $email
	)->first if $email;

	my $login = Tab::Login->search( 
		username => $email
	)->first if $email;

	$person = $login->person if $login && (not defined $person);

	my $msg;

	if ($person) { 

		if ($person->no_email) { 

			$msg = $person->email."'s account is set not to recieve email.  Not saved.";

		} else { 

			my $already = Tab::Follower->search( 
				type     => $type,
				school   => $school_id,
				follower => $person->id
			)->first;

			unless ($already) { 
				Tab::Follower->create({
					school   => $school_id,
					follower => $person->id,
					type     => $type,
					tourn    => $tourn_id
				});
			}

			$msg = $person->first." ".$person->last." now gets all pairings and updates for this school";
			$msg = $person->first." ".$person->last." now gets tournament admin emails " 
				if $type eq "contact";
		}

	} else { 

		my $already = Tab::Follower->search( 
			type   => $type,
			school => $school_id,
			email  => $email
		)->first;

		unless ($already) { 
			Tab::Follower->create({
				school => $school_id,
				email  => $email,
				type   => $type,
				tourn  => $tourn_id
			});
		}

		$msg = $email." now gets all pairings and updates for this school";
		$msg = $email." now gets tournament admin emails"
			if $type eq "contact";

	}

	$m->redirect("entry.mhtml?school_id=".$school_id."&msg=$msg");

</%init>

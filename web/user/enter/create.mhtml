<%args>
	$person
	$session
	$tourn_id
	$chapter_id
	$return => undef
</%args>
<%init>

	my $tourn = Tab::Tourn->retrieve($tourn_id);
	my %tourn_settings = $tourn->all_settings;
	my $chapter = Tab::Chapter->retrieve($chapter_id);

	use Tab::NSDA::MemberSchool;

	$m->comp("/user/chapter/auth.mas", 
		chapter => $chapter,
		person  => $person,
		session => $session
	) unless $return;

	my ($existing_school) = $chapter->schools( 
		tourn => $tourn->id
	);

	if ($existing_school) {
		return $existing_school if $return;
		$m->redirect("/user/enter/entry.mhtml?school_id=".$existing_school->id);
	}

	my ($school, $err) = $m->comp(
		"/funclib/school_create.mas",
		tourn          => $tourn,
		person         => $person,
		chapter        => $chapter,
		tourn_settings => \%tourn_settings
	);

	if ($err && $school == 0) { 

		$m->redirect("/user/home.mhtml?err=$err");

	} else { 

		return $school if $return;
		$m->redirect("disclaimer.mhtml?school_id=".$school->id) if $tourn_settings{"disclaimer"};
		$m->redirect("entry.mhtml?school_id=".$school->id);

	}

</%init>

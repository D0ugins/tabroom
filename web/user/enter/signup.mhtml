<%args>
	$person
	$session
	$school
	$tourn
	$disclaimed => undef
</%args>
<%init>

	use POSIX;

	my %tourn_settings = $tourn->all_settings;

	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;

    my $now = DateTime->now(time_zone => $tz);

	my %school_settings = $school->all_settings;

	if ($tourn_settings{"disclaimer"}) { 

		if ($disclaimed) { 

			$school->setting("disclaimed", $person->id);
			$school->setting("disclaimed_at", "date", $now);

		} elsif ($school_settings{"disclaimed"}) { 

		} else { 

			$m->redirect("disclaimer.mhtml?school_id=".$school->id) 
		}

	}

	my $adult++ if ( 
		$school_settings{"contact_number"} 
		&& $school_settings{"contact_name"} 
		&& $school_settings{"contact_email"}
	);

	$adult++ unless $tourn_settings{"require_adult_contact"};

	my @empties = $m->comp(
		"/funclib/school_empty_entries.mas", 
		school => $school
	);

</%init>

	<div class="main">

		<h2>
			<% $tourn->name %>
		</h2>

		<& "tabbar.mas",
			school => $school, 
			whoami => "signups"
		&>

		<form action="signup_save.mhtml" method="post">

		<input 
			type  = "hidden"
			name  = "school_id"
			value = "<% $school->id %>"
		>

		<input 
			type  = "hidden"
			name  = "tourn_id"
			value = "<% $tourn->id %>"
		>

		<div class="row">

			<span class="half">
				Memo/Info Packet
			</span>
			
			<span class="half">
			</span>

		</div>

		<div class="row">

			<span class="half">
				Signup deadline:
			</span>
			
			<span class="half">
			</span>

		</div>

		<& "/funclib/editor.mas" &>

		<h5>Notice/message above competitor signup page:</h5>

		<div class="row">
			<textarea 
				rows  = 5
				cols  = 55
				name  = "signup_notice"
				value = "<% $school_settings{"signup_notice"} %>"
			></textarea>
		</div>
			
	</div>

	<div class="menu">

		<div class="sidenote">

			<h4>Wait, what is this?!</h4>

			<p class="bigger">
				Enable the online signup sheet and your students can sign up
				for tournaments online directly in Tabroom.  Then come back
				here to approve or deny their requests for tournaments slots.
			</p>

			<p class="bigger">
				When a student signs up for a tournament, they will be emailed
				any message you put in the box at left, as well as any
				file/memo you upload.  In team/paired events their teammates
				will also be notified.  Lastly, if you or they input parent
				contact information into their student profiles, they too will
				be notified and recieve copies of this information. 
			</p>


		</div>

	</div>

<%args>
	$person
	$school_id      => undef
	$refund_address => undef
	$refund_payable => undef
</%args>
<%init>

	my $school = Tab::School->retrieve($school_id) if $school_id;
	my $tourn = $school->tourn;

	$m->abort unless $school;

	if ($refund_payable && $refund_address) {

		$school->setting('refund_payable', "text", $refund_payable);
		$school->setting('refund_address', "text", $refund_address);

		if ($tourn->setting('disclaimer')) { 

			my $now = DateTime->now;

			my $tz = $tourn->tz;
			$tz = "UTC" unless $tz;
			$now->set_time_zone($tz);

			$school->setting('disclaimed', $person->id);
			$school->setting('disclaimed_at', "date", $now);

		}

		my $msg = "Refund information saved";
		$m->redirect("entry.mhtml?school_id=$school_id&msg=$msg");

	} else  {

		my $err = "Refund information is required to continue to registration.";
		$m->redirect("disclaimer.mhtml?school_id=".$school->id."&err=$err");

	}


</%init>

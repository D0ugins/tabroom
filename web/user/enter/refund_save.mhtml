<%args>
	$person
	$school_id      => undef
	$refund_address => undef
	$refund_payable => undef
</%args>
<%init>

	my $school = Tab::School->retrieve($school_id) if $school_id;
	my $tourn = $school->tourn;

	$m->abort unless $school;

	$school->setting('refund_method', "text", $ARGS{"refund_method"});

	if ($refund_payable && $refund_address) {

		$school->setting('refund_payable', "text", $refund_payable);
		$school->setting('refund_address', "text", $refund_address);


	} elsif ($ARGS{"refund_method"} ne "credit")  {

		my $err = "Refund information is required to continue to registration.";
		$m->redirect("disclaimer.mhtml?school_id=".$school->id."&err=$err");

	}

	if ($tourn->setting('disclaimer')) { 

		my $now = DateTime->now;

		my $tz = $tourn->tz;
		$tz = "UTC" unless $tz;
		$now->set_time_zone($tz);

		$school->setting('disclaimed', $person->id);
		$school->setting('disclaimed_at', "date", $now);

	}

	my $msg = "Refund information saved";

	if ($tourn->setting('instructions_url')) { 
		$m->redirect("instructions.mhtml?school_id=$school_id&msg=$msg");
	}

	$m->redirect("entry.mhtml?school_id=$school_id&msg=$msg");

</%init>

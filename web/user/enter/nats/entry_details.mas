<%args>
	$tourn
	$entry   => undef
	$student => undef
	$coaches => undef
	$past    => undef
</%args>
<%init>

	return unless $entry;

	my $event = $entry->event;
	my $school = $entry->school;

	my %entry_settings = $entry->all_settings();

	unless ($coaches) {
		@{$coaches} = $m->comp(
			"/funclib/nsda_school_coaches.mas",
			school => $school
		);
	}

	my $now = DateTime->now();

	my $drop_deadline = $tourn->setting("drop_deadline");
	my $supp_deadline = $tourn->setting("supp_deadline");

	my $type;
	$type = "supp" if $event->setting("supp");
	$type = "conn" if $event->setting("conn");
	$type = "main" unless $type;

</%init>

%	if ($event->setting("usa_wsdc")) {

		<div class="padvertmore bordertop">

			<span class="third bigger semibold rightalign">
				<% $event->name %>
			</span>

			<span class="threefifths bigger bluetext semibold centeralign">
				<% $entry->code %>
			</span>

		</div>

%		my $counter;
%		foreach my $roster ($entry->students) {
%			$counter++;

			<div class="full padless bordertop">

				<span class="tenth centeralign semibold">
					<% $counter %>.
				</span>
				<span class="half <% $student == $roster ? "redtext semibold" : "" %>">
					<% $roster->first." ".$roster->last %>
				</span>
				<span class="fourtenths">
					<% $roster->chapter->name %>
				</span>

			</div>

%		}

		<div class="full padleftmore padrrightmore padvertmore semibold bordertop">

			World Schools team registrations are managed by your district's
			chair.  Please contact your chair if you have to drop your student
			or to make other changes.

		</div>

%	} else {

		<div class="padvertmore bordertop">

			<span class="third bigger semibold rightalign">
				<% $event->name %>
			</span>

			<span class="third bigger bluetext semibold padleftmore">
				<% $entry->name %>
			</span>

			<span class="third semibold">
%				if ($entry_settings{"status"} eq "complete") {
					<span class="greentext">
					<span class="fa fa-check inline"></span> Complete
					</span>
%				} else {
%					$entry_settings{"incomplete_reasons"} =~ s/-/<br \/>/g;
					<span class="redtext">
					<span class="fa fa-times inline"></span> Incomplete:<br />
						<% $entry_settings{"incomplete_reasons"} %>
					</span>
%				}
			</span>

		</div>

		<div class="full nospace bordertop">

			<span class="third rightalign semibold">
				Coach for Points Records
			</span>

			<span class="twothirds">
%				if ($past) {
%					my $coach = Tab::NSDA::Person->search(user_id => $entry_settings{'coach_points'})->first;
					<div class="padsetting bluetext semibold">
						<% $coach ? $coach->ufname." ".$coach->ulname." (ID ".$coach->user_id.")" : "NONE" %>
					</div>
%				} else {
					<select
						name="<% $entry->id %>_coach_points"
						class="fixedbig"
					>
						<option value=""></option>

%						foreach my $coach (@{$coaches}) {
							<option
								value="<% $coach->user_id %>"
								<% $coach->user_id == $entry_settings{'coach_points'}
									? 'selected="selected"'
									: ""
							%>><% $coach->ufname." ".$coach->ulname." (ID ".$coach->user_id.")" %></option>
%						}
					</select>
%				}
			</span>

		</div>

		<div class="full nospace bordertop">

			<span class="third rightalign semibold">
				Coach Names for Awards
			</span>

			<span class="twothirds">
				<input
					type  = "text"
					<% $past ? "disabled" : "" %>
					name  = "<% $entry->id %>_coach_script"
					size  = "64"
					value = "<% $entry_settings{"coach_script"} %>"
				>
			</span>

		</div>


<%perl>
		if (
			$event->setting('ask_for_titles')
			|| $event->setting('ask_for_bibliography')
		) {

			my $script = $entry_settings{"script_file"};
</%perl>

			<div class="full nospace bordertop">

				<span class="third rightalign semibold">
					Script/Manuscript:
				</span>

				<span class="twothirds padvert">

					<div class="full nospace">
						<div class="uploader wider">
							<input
								type	 = "file"
								name	 = "<% $entry->id %>_script"
								style   = "opacity: 0;"
								onchange = "uploaderName(
									'<% $entry->id %>_script',
									'<% $entry->id %>_script_file'
								)"
								id	 = "<% $entry->id %>_script"
								<% $past ? "disabled" : "" %>
							>

							<span
								id  = "<% $entry->id %>_script_file"
								class = "filename"
								style = "-webkit-user-select: none;"
							>Upload File</span>

							<span
								class = "action"
								style = "-webkit-user-select: none;"
							>Choose File</span>
						</div>

%				   if ($script) {
						</div>
						<div class="full nospace martop">
							<span class="fa fa-check greentext"></span>
							<a class = "greentext semibold"
							   href  = "<% $Tab::s3_url %>/<% $tourn->id."/".$school->id."/scripts/".$entry->id."/".$script %>"
							> <% $script %> </a>
%						} else {

							<span class="third rightalign">
								<span
									class="fa fa-lg fa-times redtext marless"
								></span>

								<span class="semibold redtext align padrightmuchmore marrightmore">
									Not Uploaded
								</span>
							</span>
%			   			}
					</div>

				</span>

			</div>
%		}

%		if ($event->setting('ask_for_titles')) {

			<div class="full nospace bordertop">

				<span class="third rightalign semibold">
					Piece Title
				</span>

				<span class="twothirds">
					<input
						type  = "text"
						name  = "<% $entry->id %>_title"
						size  = "64"
						<% $past ? "disabled" : "" %>
						value = "<% $entry_settings{"title"} %>"
					>
				</span>
			</div>

%		}

%		if ($event->setting('ask_for_topic')) {

			<div class="full nospace bordertop">

				<span class="third rightalign semibold">
					Speech Topic(s)
				</span>

				<span class="twothirds">
					<input
						type  = "text"
						name  = "<% $entry->id %>_topic"
						size  = "64"
						<% $past ? "disabled" : "" %>
						value = "<% $entry_settings{"topic"} %>"
					>
				</span>
			</div>

%		}

%		if ($event->setting('ask_for_authors')) {

			<div class="full nospace bordertop">

				<span class="third rightalign semibold">
					Piece Author
				</span>

				<span class="half">
					<input
						type  = "text"
						name  = "<% $entry->id %>_author"
						value = "<% $entry_settings{"author"} %>"
						<% $past ? "disabled" : "" %>
						size  = "64"
					>
				</span>

			</div>

			<div class="semibold bluetext centeralign padvertmore biggish bordertop">
				You must fill out either the Print or Digital
				publication information:
			</div>

			<span class="pagehalf nospace">

				<div class="semibold bluetext centeralign padvertmore biggish">
					Print Publications
				</div>

				<div class="full nospace padtopless bordertop">

					<span class="nospace twofifths rightalign">
						Publisher
					</span>

					<span class="threefifths nospace">
						<input
							type  = "text"
							name  = "<% $entry->id %>_publisher"
							value = "<% $entry_settings{"publisher"} %>"
							<% $past ? "disabled" : "" %>
							size  = "24"
						>
					</span>

				</div>

				<div class="full nospace ">

					<span class="twofifths nospace rightalign">
						Publication Year
					</span>

					<span class="threefifths nospace">
						<input
							type  = "text"
							name  = "<% $entry->id %>_publish_date"
							value = "<% $entry_settings{"publish_date"} %>"
							<% $past ? "disabled" : "" %>
							size  = "24"
						>
					</span>

				</div>

				<div class="full nospace ">

					<span class="twofifths nospace rightalign">
						ISBN Number
					</span>

					<span class="threefifths nospace">
						<input
							type  = "text"
							name  = "<% $entry->id %>_publish_isbn"
							value = "<% $entry_settings{"publish_isbn"} %>"
							<% $past ? "disabled" : "" %>
							size  = "24"
						>
					</span>

				</div>

			</span>

			<span class="pagehalf nospace marleft padleft">

				<div class="semibold bluetext centeralign padvertmore biggish">
					Digital (Online) Publication:
				</div>

				<div class="full nospace bordertop padtopless">

					<span class="twothirds nospace">
						Date the web page was printed:
					</span>

					<& "/funclib/datepicker.mas",
						id => $entry->id."_publish_print_date"
					&>

%					my $publish_print_date = $entry_settings{"publish_print_date"};

					<span class="third centeralign nospace">
						 <input
							type        = "text"
							name        = "<% $entry->id %>_publish_print_date"
							id          = "<% $entry->id %>_publish_print_date"
							size        = "12"
							placeholder = "MM/DD/YYYY"
							<% $past ? "disabled" : "" %>
							value       = "<% Tab::pickerdate($publish_print_date) %>"
						>
					</span>

				</div>

				<div class="full nospace">

					<span class="quarter nospace">
						URL/Address:
					</span>

					<span class="threequarters rightalign nospace">
						<input
							type        = "url"
							name        = "<% $entry->id %>_publish_url"
							value       = "<% $entry_settings{"publish_url"} %>"
							size        = "32"
							<% $past ? "disabled" : "" %>
							placeholder = "Script first page if multi-page"
						>
					</span>

				</div>

			</span>

%		}

%		if ($event->setting('ask_for_bibliography')) {

			<& "/funclib/editor.mas" &>

			<p class="martopmore padleftmore bigger semibold">
				Pieces, titles, &amp; publication bibliography:
			</p>

			<div class="full padmore centeralign">
				<textarea
					rows  = "7"
					cols  = "56"
					<% $past ? "disabled" : "" %>
					class = "full"
					name  = "<% $entry->id %>_bibliography"
				><% $entry_settings{"bibliography"} %></textarea>
			</div>

%		}

<%perl>

		if (
			( ($type eq "supp" || $type eq "conn")
		 	 && ($now < $supp_deadline))
			|| ($now < $drop_deadline)
		) {
</%perl>

			<div class="full bordertop">
				<span class="true third centeralign">
					<a
						class="redtext buttonwhite invert"
						href="reject.mhtml?entry_id=<% $entry->id %>&school_id=<% $school->id %>"
					>
						Drop Entry from <% $event->abbr %>
					</a>
				</span>
				<span class="true third centeralign">
				</span>
				<span class="true third centeralign">
					<input
						type="submit"
						value="Save Entry Details"
					>
				</span>
			</div>
%		}
%	}





<%args>
	$category_id => undef
	$school_id   => undef
	$hires       => undef
</%args>
<%init>

	$m->clear_buffer();
	$r->content_type('application/json');

	my $message;
	
	if ($category_id && $school_id) { 
		
		my $category = Tab::Category->retrieve($category_id);

		return unless $category;
	
		my $max_rounds = $category->setting('max_rounds');

		$hires = $max_rounds 
			if $max_rounds
			&& $max_rounds < $hires;

		my $judge_hire = Tab::JudgeHire->search(
			category => $category_id,
			school   => $school_id
		)->first;

		unless ($judge_hire) { 

			$judge_hire = Tab::JudgeHire->create({
				category => $category_id,
				school   => $school_id
			});

		}

		$judge_hire->rounds_accepted($hires);
		$judge_hire->rounds_requested($hires);
		$judge_hire->update();

		$message = "Hired rounds updated to ".$hires." rounds";

	}

	$m->print('{ 
		"error"   : false,
		"message" : "'.$message.'",
		"reply"    : '.$hires.'
	}');

	$m->abort();

</%init>


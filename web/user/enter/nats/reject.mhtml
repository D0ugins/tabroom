<%args>
	$school 
	$person
	$entry_id => undef
	$certain => undef
</%args>
<%init>

	my $entry = Tab::Entry->retrieve($entry_id) if $entry_id;

	unless ($entry) { 
		my $err = "No entry found with the ID number $entry_id.";
		$m->redirect("entries.mhtml?school_id=".$school->id."&err=$err") if $err;
	}

	if ($certain eq "Yes") { 

		my $now = DateTime->now();

		$entry->unconfirmed(1);
		$entry->update();

		$entry->setting('rejected_by', $person->id);
		$entry->setting('rejected_at', "date", $now);

		my $msg = $m->comp(
			"/funclib/promote_slot.mas",
			entry  => $entry,
			person => $person
		);

		$msg .= "<br />";
		$msg .= "Entry slot ".$entry->name." has been rejected";

        $m->comp("/funclib/log.mas",
            tourn       => $entry->event->tourn->id,
            event       => $entry->event->id,
            type        => "rejections",
            person      => $person->id,
            description => $msg
        );

		$m->redirect("entries.mhtml?school_id=".$school->id."&msg=$msg") if $msg;

	} else { 

</%init>

		<div class="main centeralign">

			<h2 class="nospace padvertmore martopmuchmore redtext marbottommore">
				Confirmation, please!
			</h2>

			<h5 class="nospace padvert semibold">
				Refusing slot for <% $entry->name %> in <% $entry->event->abbr %>
			</h5>

			<span class="threequarters">

				<p class="bigger">
					This action will refuse the entry listed above.  The district
					chair, and the coach of the next alternate entry will be
					automatically notifed of their eligibility to register for
					nationals.
				</p>

				<p class="bigger semibold bluetext">
					So please be absolutely certain this is the correct entry and
					you wish to refuse it.  Only the National office can undo this
					action.
				</p>

			</span>

			<h6 class="marbottom">Confirm by typing Yes in the box:</h6>

%			if ($certain) { 

				<p class="orangetext semibold bigger marvertmore">
					Confirmation failed: you typed "<% $certain %>" not Yes.  
				</p>

				<p class="semibold bigger">
					I know it's nitpicky but we really want to be sure
					nobody's slot gets rejected or dropped by mistake.
				</p>
%			}

			<form action="reject.mhtml" method="post">

			<input
				type  = "hidden"
				name  = "entry_id"
				value = "<% $entry->id %>"
			>

			<input
				type  = "hidden"
				name  = "school_id"
				value = "<% $school->id %>"
			>

            <input
                type           = "text"
                name           = "certain"
                size           = "32"
                class          = "martop notfirst"
                autocomplete   = "off"
                autocorrect    = "off"
                autocapitalize = "off"
                spellcheck     = "false"
				placeholder    = "Please confirm"
            >

			<br />

			<input
				type  = "submit"
				class = "martopmore"
				value = "  Reject Entry "
			>
		</div>

%	}

	


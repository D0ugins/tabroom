<%args>
	$judge_id
	$school_id
</%args>
<%init>

	my $judge = Tab::Judge->retrieve($judge_id);
	my $school = Tab::School->retrieve($school_id);

	$m->abort unless $judge;

	my $category = $judge->category;
	my $tourn = $category->tourn;

	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;

	my $switch;

</%init>

	<div class="main"> 

		<h2>Limit <% $judge->first." ".$judge->last %>'s availability</h2>

		<table>

			<tr class="yellowrow smallish">
			
				<th>
					Block
				</th>

				<th>
					Time Not Available
				</th>

				<th>
					Fee if under  obligation
				</th>

				<th>
					Available
				</th>

			</tr>

%			foreach my $strike_timeslot ($category->strike_timeslots) { 

%				my $start = $strike_timeslot->start->set_time_zone($tz);
%				my $end = $strike_timeslot->end->set_time_zone($tz);

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						<% $strike_timeslot->name %>
					</td>

					<td>
						<% $start->day_abbr %> <% Tab::nicetime($start) %> through
						<% $end->day_abbr %> <% Tab::nicetime($end) %>
					</td>
	
					<td class="centeralign">
						$<% $strike_timeslot->fine %>
					</td>

					<td class="centeralign">

%						if ($strike_timeslot->strike($judge)) { 
		
							<a class="dkred block" href="judge_striketime_flip.mhtml?judge_id=<% $judge->id %>&strike_timeslot_id=<% $strike_timeslot->id %>&school_id=<% $school->id %>">
								Unavailable
							</a>

%						} else { 

							<a class="dkblue block" href="judge_striketime_flip.mhtml?judge_id=<% $judge->id %>&strike_timeslot_id=<% $strike_timeslot->id %>&school_id=<% $school->id %>">
								YES
							</a>

%						}

					</td>

				</tr>

%			}

		</table>

		<p class="explain">
			Toggle the "Available" button to mark a judge as not available 
			for a given time block.
		</p>

		<p class="explain">
			You owe your full judge burden for every time block.  A judge
			marked available for only part of the tournament will result in a
			fee unless another judge is made available for the parts the first
			judge is missing.  
		</p>


	</div>


	<div class="menu">
	
		<div class="sidenote">

			<h4>Return to:</h4>

			<a class="blue block" href="judges.mhtml?category_id=<% $category->id %>&school_id=<% $school->id %>">
				Judge: <% $judge->first." ".$judge->last %>
			</a>

			<a class="blue block" href="judges.mhtml?category_id=<% $category->id %>&school_id=<% $school->id %>">
				<% $judge->category->name %>
			</a>

		</div>

	</div>



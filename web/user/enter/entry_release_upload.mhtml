<%args>
	$person
	$entry_id
	$school
</%args>
<%init>

	my $entry = Tab::Entry->retrieve($entry_id);
	my $tourn = $school->tourn;

	my $msg;

	foreach my $student ($entry->students) {

	    if ($ARGS{"entry_release_".$student->id}) {

			my $req = Apache2::Request->new($r);
			my $upload = $req->upload("entry_release_".$student->id);
			my $filename  = $upload->filename;

			$filename =~ s/[^\w.]//g;
			$filename =~ s/\.(?=.*\.)//g;
			$filename =~ s/\s//g;

			my $filetemp = $upload->tempname;

			system $Tab::s3_cmd." put $filetemp ".$Tab::s3_bucket."/tourns/".$tourn->id."/entry_release/".$school->id."/".$student->id."/".$filename;

			$school->setting("entry_release_".$student->id, $filename);

			$msg .= "<br />" if $msg;
			$msg .= $student->first." ".$student->last."'s forms are uploaded";

		}   

	}

	$m->redirect("details.mhtml?entry_id=".$entry->id."&school_id=".$school->id."&msg=$msg");


</%init>


<%args>
	$school_id
</%args>
<%init>

	my $school = Tab::School->retrieve($school_id);

	my %aff_strings;
	my %neg_strings;

	foreach my $event ($m->comp("/funclib/school_events.mas", school => $school)) { 

		$aff_strings{$event->id} = $event->setting('aff_string');
		$neg_strings{$event->id} = $event->setting('neg_string');

		$aff_strings{$event->id} = "Aff" unless $aff_strings{$event->id};
		$neg_strings{$event->id} = "Neg" unless $neg_strings{$event->id};

	}

</%init>

	<& "menu.mas", school => $school, whoami => "ballots" &>

	<div class="main">

		<h2><% $school->chapter->name %>: Results</h2>

		<& /user/chapter/tabbar.mas, chapter => $school->chapter, whoami => "results" &>

		<h4>Individual Ballots</h4>

%		foreach my $entry ($school->entries) {

%			my $event = $entry->event;

			<div class="full marno padless blue">

				<span class="twofifth padleftmore">
					<h5><% $entry->code %></h5>
				</span>
				
				<span class="twofifth right rightalign padrightmore">
					<h5><% $entry->name %></h5>
				</span>

			</div>

%			my $current_round;
%			my $opponent;

%			my @ballots = $m->comp("/funclib/entry_ballots.mas", entry => $entry);

%			foreach my $ballot (@ballots) { 

%				my $panel = $ballot->panel;
%				my $judge = $ballot->judge;
%				my $round = $ballot->panel->round;
%				my @scores = $ballot->scores; 

%				next if $round->post_results < 1;

%				unless ($current_round == $round->id) { 

					<div class="full nospace martop">

						<span class="half rightalign">
							<h6>
								<% $round->realname %>:
							</h6>
						</span>

%						$current_round = $round->id;

%						if ($event->type ne "speech" && $event->type ne "congress") { 

							<span class="half leftalign">

								<h6>
								<% $ballot->side == 1 ? $aff_strings{$event->id} : $neg_strings{$event->id} %>

%								foreach my $other ($m->comp("/funclib/panel_entries.mas", panel => $panel)) { 
%									next if $entry->id == $other->id;
									vs. <% $other->code %> 
%								}
								</h6>
							</span>
%						}

					</div>
%				}

					<div class="full row">

						<div class="full marless padno">

%							if ($panel->bye) { 

								<h6>Bye Round</h6>

%							} elsif ($ballot->bye) { 

								<h6><% $entry->code %> bye</h6>

%							} elsif ($ballot->forfeit) { 

								<h6><% $entry->code %> forfeits</h6>

%							} else { 

								<span class="quarter">
									<% $judge->first %> <% $judge->last %>
								</span>

								<span class="eighth">
%									foreach my $score (@scores) { 
%										if ($score->tag eq "ballot") { 
											<% $score->value ? "WIN" : "LOSS" %> 
%										}
%									}
								</span>

								<span class="quarter">

%									foreach my $score (@scores) { 

%										if ($score->tag eq "rank") { 

%											if ($score->student) { 

												<div class="full marno padless">
													<span class="threequarters marno padless">
														<% $score->student->last %>
													</span>
													<span class="quarter marno padless">
														<% $score->value %> 
													</span>
												</div>

%											} else { 

												<% $score->value %> 

%											}
%										}
%									}

								</span>

								<span class="third">
%									foreach my $score (@scores) { 

%										if ($score->tag eq "points") { 

%											if ($score->student) { 

												<div class="full marno padless">
													<span class="threequarters marno padless">
														<% $score->student->last %>
													</span>
													<span class="quarter marno padless">
														<% $score->value %> 
													</span>
												</div>

%											} else { 
												<% $score->value %> 
%											}
%										}
%									}

%									foreach my $score (@scores) { 

%										if ($score->tag eq "rebuttal_points") { 

%											if ($score->student) { 

												<div class="full marno padless">
													<span class="threequarters marno padless">
														Reply <% $score->student->last %>
													</span>
													<span class="quarter marno padless">
														<% $score->value %> 
													</span>
												</div>

%											} else { 
												<% $score->value %> 
%											}
%										}
%									}
								</span>
%							}
		
						</div>

%					foreach my $score (@scores) { 

%						next if $score->tag eq "points";
%						next if $score->tag eq "ballot";
%						next if $score->tag eq "rebuttal_points";
%						next if $score->tag eq "rank";

						<div class="padless marno bordertop">

							<span class="fifth">
								<% ucfirst($score->tag) %>
								<% $score->student ? "<br /> ".$score->student->last : "" %>
							</span>
							<span class="fourfifths">
								<% $score->content %>
							</span>
						</div>

%					}

				</div>


%			}

%		}

	</div>



<%args>
	$person
	$person_settings
	$first   => undef
</%args>
<%init>

	unless ($person) { 
		$m->redirect("/index/index.mhtml?err=Your account does not appear to exist.  Please log in");
	}

</%init>

	<div class="main">

	<h2>Your Tabroom.com Account</h2>

	<h4>Edit Your Details:</h4>

	<table>

		<form 
			action = "profile_save.mhtml"
			method = "post"
		>


%		if ($person_settings->{'scream_in_pain'}) { 

			<tr class="row">

				<td>
					Please stop screaming
				</td>

				<td class="rightalign nospace">

					<label for="stop_screaming">

						<span class="full hover padrightmore">
							<input 
								type  = "checkbox"
								name  = "please_stop_screaming"
								value = 1
								id    = "stop_screaming"
								<% $person_settings->{"please_stop_screaming"} ? 'checked="true"' : "" %>
							>
						</span>

					</label>

				</td>

			</tr>

%		}

		<tr class="row">

			<td>
				Email
			</td>

			<td class="rightalign" >

				<input 
					type  = "text"
					name  = "email"
					value = "<% $person->email %>"
					size  = "32"
				>
			</td>

		</tr>

		<tr class="row">

			<td>
				Google+ Account Email
			</td>

			<td class="rightalign" >
				<input 
					type      = "text"
					name      = "googleplus"
					value     = "<% $person->googleplus %>"
					size      = "32"
					maxlength = 127
				>
			</td>

		</tr>

		<tr class="row">

			<td>
				First Name:
			</td>

			<td class="rightalign" >
				<input 
					type  = "text"
					name  = "first"
					value = "<% $person->first %>"
					size  = "32"
				>
			</td>
	
		</tr>

		<tr class="row">

			<td>
				Middle Name:
			</td>

			<td class="rightalign" >
				<input 
					type  = "text"
					name  = "middle"
					value = "<% $person->middle %>"
					size  = "32"
				>
			</td>
	
		</tr>

		<tr class="row">

			<td>
				Last Name:
			</td>

			<td class="rightalign" >
				<input 
					type  = "text"
					name  = "last"
					value = "<% $person->last %>"
					size  = "32"
				>
			</td>
	
		</tr>

		<tr class="row">

			<td>
				Street Address:
			</td>

			<td class="rightalign" >
				<input 
					type  = "text"
					name  = "street"
					value = "<% $person->street %>"
					size  = "32"
				>
			</td>

		</tr>

		<tr class="row">

			<td>
				City
			</td>

			<td class="rightalign" >
				<input 
					type  = "text"
					name  = "city"
					value = "<% $person->city %>"
					size  = "32"
				>
			</td>

		</tr>

		<tr class="row">

			<td>
				State
			</td>

			<td class="rightalign">
				<select 
					name="state" 
					class="fixedbig"
				>
					<& 
						"/funclib/state_select.mas", 
						state => $person->state 
					&>
				</select>
			</td>

		</tr>

		<tr class="row">

			<td>
				Country
			</td>

			<td class="rightalign">
				<select name="country" class="fixedbig">
					<& "/funclib/country_select.mas", country => $person->country &>
				</select>
			</td>

		</tr>

		<tr class="row">

			<td>
				ZIP code (US)
			</td>

			<td class="rightalign" >
				<input 
					type  = "number"
					name  = "zip"
					value = "<% sprintf("%05d", $person->zip) %>"
					size  = "8"
				>
			</td>

		</tr>

		<tr class="row">

			<td>
				Postal code (non-US)
			</td>

			<td class="rightalign" >
				<input 
					type  = "text"
					name  = "postal"
					value = "<% $person->postal %>"
					size  = "16"
				>
			</td>

		</tr>

		<tr class="row">

			<td>
				Phone Number
			</td>

			<td class="rightalign">
				<input 
					type  = "tel"
					name  = "phone"
					value = "<% Tab::phone($person->phone) %>"
					size  = "32"
				>
			</td>

		</tr>


		<tr class="row">

			<td class="nowrap">
				Cell phone provider (for texts)
			</td>

			<td class="rightalign">
				<select name="provider" class="fixed chosen">
					<& "/funclib/cell_domains.mas", provider => $person->provider &>
				</select>
			</td>

		</tr>

		<tr class="row">

			<td>
				Home Time Zone
			</td>

			<td class="rightalign">
				<select name="timezone" class="fixed chosen">
					<& /funclib/timezones.mas, tz => $person->tz &>
				</select>
			</td>

		</tr>

		<tr class="row">

			<td>
				Pronouns &dagger;
			</td>

			<td class="rightalign">
				<input 
					type  = "text"
					name  = "pronoun"
					value = "<% $person ? $person->pronoun : "" %>"
					size  = "32"
				>
			</td>

		</tr>

%		my $warn = "Fair warning: this will also prevent you from getting text blasts & tournament notices!";

		<tr 
			title = "<% $warn %>"
			class = "row"
		>

			<td>
				<label for="shaddap">
				No Emails*:
				</label>
			</td>

			<td  class="rightalign">
				<input 
					type  = "checkbox"
					id    = "shaddap"
					value = "1"
					name  = "no_email"
					<% ($person->no_email) ? "checked" : "" %>
					<& "/funclib/confirm.mas", warn => $warn &>
				>
			</td>

		</tr>

		<tr class="liblrow">

			<td colspan="2" class="rightalign">

				<input 
					type  = "submit"
					value = "<%($person) ? 'Save Changes' : 'Create Account' %>"
				>

				</form>
			</td>

		</tr>

		<tr>
			<td 
				colspan="4" 
				class="explain padtopmore"
			>

				* NO EMAILS: This setting will prevent you from getting ANY 
				tournament and circuit announcement emails.  If you're not
				actively coaching anymore, that's fine, but if you're coaching
				you'll almost certainly miss something important by checking
				this box.  
	
				If another coach has taken over your program, you should
				instead go to your home screen, add them to the chapter's
				access, and remove yourself.

			</td>
		</tr>

		<tr>
			<td 
				class="explain padtopmore" 
				colspan="4" 
			>

				&dagger; PRONOUNS: These pronouns will be sent to your judges
				and opponents via text message/emails for each round as part of
				their round pairing, and also will appear on judges' online or
				printed ballots.  They will NOT appear on the public
				Tabroom.com website either to tournament/tab staff or on the
				public schematics/pairings/entry lists.

			</td>
		</tr>

	</table>

</div>

	<div class="menu">

		<div class="sidenote">

			<h4>Change Passwords</h4>

%			foreach my $login ($person->logins) { 

				<form action="passwd.mhtml" method="post">

				<input 
					type  = "hidden"
					name  = "login_id"
					value = "<% $login->id %>"
				>

				<div class="row martop">

					<span class="quarter rightalign">
						Login:
					</span>

					<span class="threequarter">
						<input 
							type  = "text"
							name  = "username"
							size  = "24"
							value = "<% $login->username %>"
						>
					</span>

				</div>

				<div class="row">

					<span class="quarter rightalign">
						Current:
					</span>
					<span class="threequarter">
						<input 
							type        = "password"
							name        = "oldpass"
							size        = "24"
							placeholder = "Current Password"
						>
					</span>

				</div>

				<div class="row">

					<span class="quarter rightalign">
						New Pass
					</span>
					<span class="threequarter">
						<input 
							type        = "password"
							name        = "newpass"
							size        = "24"
							placeholder = "New Password"
						>
					</span>

				</div>

				<div class="row">

					<span class="quarter rightalign">
						Repeat
					</span>
					<span class="threequarter">
						<input 
							type        = "password"
							name        = "repeatpass"
							size        = "24"
							placeholder = "Repeat New"
						>
					</span>

				</div>

				<div class="liblrow rightalign">
					<input 
						type  = "submit"
						class = "thin"
						value = " Save "
					>
					</form>
				</div>
%			}

		</div>


	<div class="sidenote">
		<h4>Don't Share Passwords Plz</h4>

		<p class="padleft bigger">
			Your password controls access to your school, student info, and
			tournaments.  If someone uses your account to try to pull
			shenanigans, you will be on the hook.  Every individual should use
			their OWN tabroom.com account.  Grant them access to your chapter
			or tournament instead of sharing your password.
		</p>

			
		<p class="padleft bigger">

			Tabroom.com is a website run for the benefit of the
			forensics community by the 
			
			<a 	class="inline hover" 
				href="http://www.speechanddebate.org"
			>National Speech and Debate Association.</a>

			Circuit officials and tournament directors will be able to see
			registrant &mdash; but not student &mdash; contact information.
			Tabroom.com itself will never sell or give away your contact
			information to anyone without your consent.  
		</p> 

	</div>
		
</div>

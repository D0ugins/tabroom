<%args>
	$person
	$person_settings
	$first   => undef
</%args>
<%init>

	unless ($person) { 
		$m->redirect("/index/index.mhtml?err=Your account does not appear to exist.  Please log in");
	}

</%init>

	<div class="main">

		<h2>Your Tabroom.com Account</h2>

		<form 
			action = "profile_save.mhtml"
			method = "post"
		>

		<span class="pagehalf">

%		if ($person_settings->{'scream_in_pain'}) { 

			<div class="row">

				<span class="half">
					Please stop screaming
				</span>

				<span class="rightalign nospace">

					<label for="stop_screaming">

						<span class="hover padrightmore">
							<input 
								type  = "checkbox"
								name  = "please_stop_screaming"
								value = 1
								id    = "stop_screaming"
								<% $person_settings->{"please_stop_screaming"} ? 'checked="true"' : "" %>
							>
						</span>

					</label>

				</span>

			</div>

%		}


		<div class="row">

			<span class="half">
				First Name:
			</span>

			<span class="half rightalign" >
				<input 
					type  = "text"
					name  = "first"
					value = "<% $person->first %>"
					size  = "24"
				>
			</span>
	
		</div>

		<div class="row">

			<span class="half">
				Middle Name:
			</span>

			<span class="half rightalign" >
				<input 
					type  = "text"
					name  = "middle"
					value = "<% $person->middle %>"
					size  = "24"
				>
			</span>
	
		</div>

		<div class="row">

			<span class="half">
				Last Name:
			</span>

			<span class="half rightalign" >
				<input 
					type  = "text"
					name  = "last"
					value = "<% $person->last %>"
					size  = "24"
				>
			</span>
	
		</div>

		<div class="row">

			<span class="half">
				Street Address:
			</span>

			<span class="half rightalign" >
				<input 
					type  = "text"
					name  = "street"
					value = "<% $person->street %>"
					size  = "24"
				>
			</span>

		</div>

		<div class="row">

			<span class="half">
				City
			</span>

			<span class="half rightalign" >
				<input 
					type  = "text"
					name  = "city"
					value = "<% $person->city %>"
					size  = "24"
				>
			</span>

		</div>

		<div class="row">

			<span class="half">
				State
			</span>

			<span class="half rightalign">
				<select 
					name="state" 
					class="fixedmed"
				>
					<& 
						"/funclib/state_select.mas", 
						state => $person->state 
					&>
				</select>
			</span>

		</div>

		<div class="row">

			<span class="half">
				Country
			</span>

			<span class="half rightalign">
				<select 
					name  = "country"
					class = "fixedmed"
				>
					<& "/funclib/country_select.mas", country => $person->country &>
				</select>
			</span>

		</div>

		<div class="row">

			<span class="half">
				ZIP code (US)
			</span>

			<span class="half rightalign" >
				<input 
					type  = "number"
					name  = "zip"
					value = "<% sprintf("%05d", $person->zip) %>"
					size  = "8"
				>
			</span>

		</div>

		<div class="row">

			<span class="half">
				Postal code (non-US)
			</span>

			<span class="half rightalign" >
				<input 
					type  = "text"
					name  = "postal"
					value = "<% $person->postal %>"
					size  = "16"
				>
			</span>

		</div>

	</span>

	<span class="pagehalf">

		<div class="row">

			<span class="half">
				Email
			</span>

			<span class="half rightalign" >

				<input 
					type  = "text"
					name  = "email"
					value = "<% $person->email %>"
					size  = "24"
				>
			</span>

		</div>

		<div class="row">

			<span class="half">
				Google+ Account Email
			</span>

			<span class="half rightalign" >
				<input 
					type      = "text"
					name      = "googleplus"
					value     = "<% $person->googleplus %>"
					size      = "24"
					maxlength = 127
				>
			</span>

		</div>

		<div class="row">

			<span class="half">
				Phone Number
			</span>

			<span class="half rightalign">
				<input 
					type  = "tel"
					name  = "phone"
					value = "<% Tab::phone($person->phone) %>"
					size  = "24"
				>
			</span>

		</div>


		<div class="row">

			<span class="half">
				Cell provider (enables texts)
			</span>

			<span class="half rightalign">
				<select name="provider" class="fixedmed">
					<& "/funclib/cell_domains.mas", provider => $person->provider &>
				</select>
			</span>

		</div>

		<div class="row">

			<span class="half">
				Time Zone
			</span>

			<span class="half rightalign">
				<select name="timezone" class="fixedmed">
					<& /funclib/timezones.mas, tz => $person->tz &>
				</select>
			</span>

		</div>

		<div class="row">

			<span class="half">
				Pronouns &dagger;
			</span>

			<span class="half rightalign">
				<input 
					type  = "text"
					name  = "pronoun"
					value = "<% $person ? $person->pronoun : "" %>"
					size  = "24"
				>
			</span>

		</div>

%	my $warn = "Fair warning: Checking this option prevents you from getting ANY emails, text blasts, or tournament notices!";

		<label for="shaddap">

			<div class="row hover">

				<span class="threequarters padsetting">
					No Emails*:
				</span>

				<span class="quarter centeralign marno">
					<input 
						type  = "checkbox"
						id    = "shaddap"
						value = "1"
						name  = "no_email"
						<% ($person->no_email) ? "checked" : "" %>
						<& "/funclib/warn.mas", warn => $warn &>
					>
				</span>

			</div>
		</label>

	</span>

		<div class="libl row rightalign">
			<input 
				type  = "submit"
				value = "<%($person) ? 'Save Changes' : 'Create Account' %>"
			>

			</form>

		</div>

		<div class="explain padtopmore" >

			* NO EMAILS: This setting will prevent you from getting ANY 
			tournament and circuit announcement emails.  If you're not
			actively coaching anymore, that's fine, but if you're coaching
			you'll almost certainly miss something important by checking
			this box.  

			If another coach has taken over your program, you should
			instead go to your home screen, add them to the chapter's
			access, and remove yourself.

		</div>

		<div class="explain padtopmore">

			<p>
				&dagger; PRONOUNS: These pronouns will be sent to judges and
				competitors of a section/debate via text message/emails as part of
				round pairings.  Pronouns also will appear on judges' online or
				printed ballots.
			</p>

			<p>
				They will NOT appear on the public Tabroom.com website either to
				tournament/tab staff or on the public schematics/pairings/entry
				lists.
			</p>

			<p>
				Please leave blank if you do not consent to these pronouns
				being disclosed to the competitors and judges in the rounds you
				are competing or judging in.
			</p>

		</div>

	</div>

	<div class="menu">

		<div class="sidenote">

			<h4>Change Passwords</h4>

%			foreach my $login ($person->logins) { 

				<form action="passwd.mhtml" method="post">

				<input 
					type  = "hidden"
					name  = "login_id"
					value = "<% $login->id %>"
				>

				<div class="row martop">

					<span class="quarter rightalign semibold bluetext">
						Login:
					</span>

					<span class="threequarter bigger">
						<input 
							type  = "text"
							name  = "username"
							size  = "22"
							value = "<% $login->username %>"
						>
					</span>

				</div>

				<div class="row marno">

					<span class="quarter rightalign semibold bluetext">
						Old Pass
					</span>

					<span class="threequarter bigger">
						<input 
							type        = "password"
							name        = "oldpass"
							size        = "22"
							placeholder = "Current Password"
						>
					</span>
				</div>

				<div class="row marno">

					<span class="quarter rightalign semibold bluetext">
						New Pass
					</span>

					<span class="threequarter bigger">
						<input 
							type        = "password"
							name        = "newpass"
							id          = "newpass"
							size        = "22"
							placeholder = "New Password"
							onKeyUp     = "checkStrength();"
						>
					</span>
				</div>

				<div class="row marno">

					<span class="quarter semibold bluetext padsetting">
						Strength: 
					</span>

					<span class="threequarters centeralign">
                        <meter 
                            id      = "passwordStrength"
                            value   = "00"
                            max     = "100"
                            low     = "15"
                            high    = "35"
                            optimum = "60"
                            style   = "width: 90%;"
                        ></meter>
					</span>
				</div>

				<div class="row marno">

					<span class="quarter rightalign semibold bluetext">
						Repeat:
					</span>

					<span class="threequarter bigger">
						<input 
							type        = "password"
							name        = "repeatpass"
							size        = "22"
							placeholder = "Repeat New Password"
						>
					</span>
				</div>


				<div class="liblrow rightalign">
					<input 
						type  = "submit"
						class = "thin"
						value = " Save "
					>
					</form>
				</div>
%			}

		</div>

	<div class="sidenote">

		<h6 class="semibold redtext">Don't Share Passwords</h6>

		<p class="padleft bigger">
			Your password controls access to your school, student info, and
			tournaments.  If someone uses your account to try to pull
			shenanigans, you will be on the hook.  Every individual should use
			their OWN tabroom.com account.  Grant them access to your chapter
			or tournament instead of sharing your password.
		</p>

			
		<p class="padleft bigger">

			Tabroom.com is a website run for the benefit of the
			forensics community by the 
			
			<a 	class="inline hover" 
				href="http://www.speechanddebate.org"
			>National Speech and Debate Association.</a>

			Circuit officials and tournament directors will be able to see
			registrant &mdash; but not student &mdash; contact information.
			Tabroom.com itself will never sell or give away your contact
			information to anyone without your consent.  
		</p> 

		<div class='full martopmore centeralign'>
		
			<a 
				class="buttonwhite redtext invert bigger semibold"
				href="user_remove.mhtml"
			>Delete your Tabroom account</a>

		</div>

	</div>
		

    <script 
        type = "text/javascript"
        src  = "/lib/javascript/sources/jquery.complexify.js"
    ></script>
    <script 
        type = "text/javascript"
        src  = "/lib/javascript/sources/jquery.complexify.banlist.js"
    ></script>

    <script type="text/javascript">

        function checkStrength() { 

            $("#newpass").complexify({}, function (valid, complexity) {
                $("#passwordStrength").val(complexity);
            });

        }
    </script>



</div>

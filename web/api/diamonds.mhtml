<%args>

</%args>
<%init>

	Tab::Person->set_sql( diamonds => "
		select person.* from person where person.nsda > 0
	");

	$m->clear_buffer();
	$m->print("<h4>Giving these people diamonds.</h4>");
	$m->flush_buffer();

	my $counter;

	foreach my $person (Tab::Person->search_diamonds()) {

		my ($degree, $diamonds, $honors) = $m->comp(
			"/funclib/nsda/member_honors.mas",
			nsda_id => $person->nsda
		);

		if ($diamonds) {
			$person->setting("diamonds", $diamonds);
		} else {
			$person->setting("diamonds", 0);
		}

		unless ($counter++ % 100) {

			$m->print("<p>");
			$m->print($person->email." has $diamonds diamonds");
			$m->print("</p>");
			$m->flush_buffer();
		}
	}

</%init>

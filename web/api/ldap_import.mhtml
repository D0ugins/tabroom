<%args>
	$debug => undef
	$no_prefs => undef
</%args>
<%init>

	$m->abort;

	use Net::LDAPS;

	$m->abort unless $Tab::ldap_enable eq "yes";

	my @persons = Tab::Login->retrieve_all;

	$m->print("<h4> Found ".scalar @persons." persons </h4>");

	my $counter;

	foreach my $person (@persons) {

		my $shell = "/bin/false";
		$shell = "/bin/tcsh" if $person->site_admin;

		$counter++;

		unless ($counter % 100) {
			$m->print("$counter persons done<br />");
			$m->flush_buffer;
		}

		my $result = $m->comp("/funclib/ldap_person.mas", person => $person);
		$m->print("<p> Error with person ".$person->id." ".$person->username.":".$result->error."</p>") if $result->error && $result->error ne "Success";

	}

	$m->print("<h4>Imported ".$counter." persons into the LDAP directory</h4>");

</%init>

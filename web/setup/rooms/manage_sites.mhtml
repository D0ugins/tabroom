<%args>
	$tourn
	$tourn_settings
	$person
</%args>

	<& menu.mas,
		tourn  => $tourn,
		whoami => "site_edit"
	&>

	<& "/funclib/editor.mas" &>

	<div class="main">

		<h2>Change Tournament Sites</h2>

%			if ($tourn_settings->{"nsda_district"}) {
				<p class="semibold redtext">
					For NSDA Districts:  Use the weekend links below or go to
					Setup &gt; Tournament &gt; Dates &amp; Deadlines tab to
					change which weekend is held at which site.
				</p>
%			}

			<table>

				<tr class="yellowrow smallish">
					<th>
						Site/location name
					</th>

					<th>
						Room Count
					</th>

					<th>
					</th>

%					if ($tourn_settings->{"nsda_district"}) {
						<th>
							Weekend(s)
						</th>
%					} else {
						<th>
						</th>
%					}
				</tr>
<%perl>

				my %site_used = ();

 				foreach my $site (
					sort {$a->name cmp $b->name}
					$tourn->sites
				) {

					next if $site_used{$site->id}++;
</%perl>

					<tr class="row" >

						<td>
							<% $site->name %>
						</td>

						<td class="centeralign">
							<% scalar ($site->rooms(deleted => 0)) %>
						</td>


						<td class="centeralign">
							<a
								class = "bluetext buttonwhite fa fa-edit fa-lg"
								href  = "site_edit.mhtml?site_id=<% $site->id %>"
								title = "Edit site details"
							>
							</a>
						</td>

%						if ($tourn_settings->{"nsda_district"}) {
							<td>
%								foreach my $weekend ($tourn->weekends(site => $site->id)) {
									<a
										class="plain hover full padvertless marno smallish"
										href="/setup/tourn/district_dates.mhtml?weekend_id=<% $weekend->id %>"
									>
										<% $weekend->name %>
									</div>
%								}
							</td>

%						} else {

							<td class="centeralign">
								<a
									class = "buttonwhite redtext fa fa-trash fa-lg"
									href  = "site_rm.mhtml?site_id=<% $site->id %>"
									title = "Remove site"
								>
								</a>
							</td>
%						}

					</tr>
%				}

			</table>

			<br />

			<p>
				If your tournament is very large and has multiple locations,
				such that rounds/judges/entries would never go from one to
				another, it can be better to schedule them into different
				sites.  That way you can assign rounds and judge pools to two
				different locations, and keep separate room lists.  However, if
				you will have judges going from one "site" to another, put them
				into 1 big site, not multiple sites.
			</p>

			<h4>Add an existing site/location</h4>

%			if ($tourn_settings->{"nsda_district"}) {

				<p class="semibold redtext">
					For NSDA Districts, after you create a new site, you must
					assign the site to a weekend/date series to use it; go to
					Setup &gt; Tournament &gt; Dates &amp; Deadlines tab to
					change which weekend is held at which site.
				</p>

%			}

			<div class="even">

			<form
				action = "site_add.mhtml"
				method = "post"
			>

				<span class="twothirds centeralign">

					<select
						name  = "site_id"
						class = "fixed"
					>

<%perl>

						foreach my $circuit ($tourn->circuits) {

							foreach my $site (
								Tab::Site->search(
									circuit => $circuit->id
								)
							) {

								next if $site_used{$site->id}++;

</%perl>

								<option
									value = "<% $site->id %>"
								> <% $site->name %> (<% scalar $site->rooms(deleted => 0) %> Rooms) </option>
%							}
%						}
					</select>

				</span>

				<span class="third centeralign">
					<input
						type="submit"
						value=" Add Site "
					>
					</form>
				<span>

			</div>


			<h4>Add a site not in Tabroom</h4>

			<div class="even">

				<span class="full">
					<form action="site_new.mhtml" method="post">
					<input
						type        = "text"
						name        = "name"
						size        = "65"
						placeholder = "Name of site"
					>
				</span>
			</div>

			<div class="libl rightalign full">
				<span class="centeralign quarter">
					<input
						type  = "submit"
						value = "Save New Site"
					>
				</span>
			</div>
		</form>

	</div>


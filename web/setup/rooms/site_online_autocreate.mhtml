<%args>
	$site_id
	$person
	$tourn
</%args>
<%init>

	my $site = Tab::Site->retrieve($site_id);

	my %already = map { $_->name => $_ }  $site->rooms();

	my $base;

	if ($ARGS{"start"}) {
		$base = $ARGS{"start"};
	} else {
		$base = 100;
	}

	COUNT:
	foreach my $count (1 ..  $ARGS{"roomcount"}) {

		my $key;

		if ($ARGS{"prefix"}) {
			$key = $ARGS{"prefix"};
		}

		$key .= $base;

		while ($already{$key}) {
			if ($already{$key}->deleted) {
				$already{$key}->deleted(0);
				$already{$key}->update();
				next COUNT;

			} else {
				$base++;
				undef $key;
				if ($ARGS{"prefix"}) {
					$key = $ARGS{"prefix"};
				}
				$key .= $base;
			}
		}

		Tab::Room->create({
			site     => $site->id,
			name     => $key,
			inactive => 0,
			deleted  => 0,
			ada      => 0
		});

		$base++;
	}

	my $msg = $ARGS{"roomcount"}." rooms were auto-created for online use";

	$m->redirect("list.mhtml?site_id=".$site->id."&msg=$msg");

</%init>

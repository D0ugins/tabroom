<%args>
	$tourn
	$event_id => undef
	$username
</%args>
<%init>

	my $event = Tab::Event->retrieve($event_id);
	my $follower_ids = $event->setting("followers");

	my $done;

	my $login = Tab::Login->search( username => $username )->first;
	my $person = $login->person if $login;

	foreach my $id (split(/,/, $follower_ids)) { 
		next unless $id;
		$done++ if $person && $id == $person->id;
	}

	my $msg;

	if ($person && not defined $done) { 
		$event->setting("followers", $follower_ids.",".$person->id);
		$msg = "User ".$person->email." will now recieve status notices about ".$event->abbr;
	}

	$msg = "User not found" unless $person;
	$msg = "User already following event" if $done;

	$m->redirect("follow.mhtml?event_id=".$event->id."&msg=$msg");

</%init>


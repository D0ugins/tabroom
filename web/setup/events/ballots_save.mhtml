<%args>
	$tourn
	$event_id             => undef
	$ballot_rules         => undef
	$ballot_rules_chair   => undef
	$point_scale          => undef
	$speech_times         => undef
	$strike_card_message  => undef
	$student_vote_message => undef
	$aff_label            => "Aff"
	$neg_label            => "Neg"
	$wsdc_no_rfd          => 0
</%args>
<%init>

	my $event = Tab::Event->retrieve($event_id);
	$m->abort() unless $event;

	$ballot_rules =~ s/\r/\n/g;
	$ballot_rules =~ s/\n\n/\n/g;

	$ballot_rules_chair =~ s/\r/\n/g;
	$ballot_rules_chair =~ s/\n\n/\n/g;

	$point_scale =~ s/\r/\n/g;
	$point_scale =~ s/\n\n/\n/g;

	$speech_times =~ s/\r/\n/g;
	$speech_times =~ s/\n\n/\n/g;

	$strike_card_message =~ s/\r/\n/g;
	$strike_card_message =~ s/\n\n/\n/g;

	$student_vote_message =~ s/\r/\n/g;
	$student_vote_message =~ s/\n\n/\n/g;

	$event->setting("wsdc_no_rfd", $wsdc_no_rfd);
	$event->setting("aff_label", $aff_label);
	$event->setting("neg_label", $neg_label);

	if ($ballot_rules) { 
		$event->setting("ballot_rules", "text", $ballot_rules);
	} else { 
		$event->setting("ballot_rules", "");
	}

	if ($ballot_rules_chair) { 
		$event->setting("ballot_rules_chair", "text", $ballot_rules_chair);
	} else { 
		$event->setting("ballot_rules_chair", "");
	}

	$event->setting("point_scale", "text", $point_scale) if $point_scale;
	$event->setting("point_scale", "") unless $point_scale;

	$event->setting("speech_times", "text", $speech_times) if $speech_times;
	$event->setting("speech_times", "") unless $speech_times;

	$event->setting("strike_card_message", "text", $strike_card_message) if $strike_card_message;
	$event->setting("strike_card_message", "") unless $strike_card_message;

	$event->setting("student_vote_message", "text", $student_vote_message) if $student_vote_message;
	$event->setting("student_vote_message", "") unless $student_vote_message;

	my $msg = "Ballot and website rules text saved.";

	$m->redirect("ballots.mhtml?event_id=".$event->id."&msg=$msg");
		
</%init>

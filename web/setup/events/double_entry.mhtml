<%args>
	$tourn
	$person
</%args>

    <div class="menu"> 
		<& menu.mas, tourn => $tourn, whoami => "double" &>
	</div> 
	
	<div class="main">
		
		<h2>Double Entry Patterns</h2>

			<form action="double_settings_save.mhtml">

			<div class="block even">

				<span class="third">
					Tournament-wide setting:
				</span>

				<span class="third">

					<select name="double_entry" class="fixedmed"> 
					
						<option 
							value="none" 
							<% ($tourn->setting("double_entry") eq "none") ? "selected" : "" %>
						>No Double Entry Allowed</option> 
					
						<option 
							value="max_events" 
							<% ($tourn->setting("double_entry") eq "max_events") ? "selected" : ""  %>
						>Allow up to maximum</option> 
	
						<option 
							value="unlimited" 
							<% ($tourn->setting("double_entry") eq "unlimited") ? "selected" : "" %>
						>Unlimited Double Entry</option> 
					
					</select> 
				</span>

				<span class="sixth rightalign">
					Maximum: 
				</span>

				<span class="sixth">
					<input 
						type="number" 
						name="double_max" 
						value="<% $tourn->setting("double_max") %>" 
						size="3" 
						min=0 
						max=100 
						>
				</span>
			</div>

		<h4>Exclusivity Patterns</h4>
			
		<table>

			<tr class="yellow">

				<th>
					Name
				</th>

				<th>
					Cross entry limits
				</th>

				<th class="smallish">
					No cross w/
				</th>

				<th>
				</th>

			</tr>

%				foreach my $pattern (sort {$a->name cmp $b->name} $tourn->patterns) { 

					<tr class="row">		
							
						<td>
							<input 
								type="text" 
								name="name_<% $pattern->id %>" 
								value="<% $pattern->name %>" 
								size="16">
						</td>

						<td class="padno nowrap">

							<label for="<% $pattern->id %>_2">
								<span class="sixth hover">
									<input 
										type="radio" 
										id="<% $pattern->id %>_2" 
										name="<% $pattern->id %>" 
										value="2" <% ($pattern->type == 2) ? "checked" : ""%>>
									None
								</span>
							</label>

							<label for="<% $pattern->id %>_1">
								<span class="third hover">
									<input 
										type="radio" 
										id="<% $pattern->id %>_1" 
										name="<% $pattern->id %>" 
										value="1" <% ($pattern->type == 1) ? "checked" : ""%>>
									None w/in group 
								</span>
							</label>

							<label for="<% $pattern->id %>_3">
								<span class="sixth hover">
									<input 
										type="radio" 
										id="<% $pattern->id %>_3" 
										name="<% $pattern->id %>" 
										value="3" <% ($pattern->type == 3) ? "checked" : ""%>>
									Max of
								</span>

								<span class="sixth">
									<input 
										type="number" 
										name="max_<% $pattern->id %>" 
										value="<% $pattern->max %>" 
										min=0 
										max=9 
										size=2 
										class="thin smaller" >
								</span>
							</label>

							<label for="<% $pattern->id %>_0">
								<span class="sixth hover">
									<input 
										type="radio" 
										id="<% $pattern->id %>_0" 
										name="<% $pattern->id %>" 
										value="0" <% ($pattern->type == 0) ? "checked" : ""%>>
									Any
								</span>
							</label>

						</td>

						<td class="centeralign">

							<select name="<% $pattern->id %>_exclude" class="fixedmicro">

								<option value="">None</option>

%								foreach my $ed (sort {$a->name cmp $b->name} $tourn->patterns) {
%									next if $ed->id == $pattern->id;
									<option 
										value="<% $ed->id %>" 
										<% $pattern->exclude && $pattern->exclude->id == $ed->id ? "selected" : "" %> >
										<% $ed->name %>
									</option>
%								}

							</select>
						</td>

						<td class="smallish centeralign">
							<a 
								class="redtext hover fa fa-trash fa-2x button" 
								href="pattern_rm.mhtml?pattern_id=<% $pattern->id %>">
							</a>
						</td>

					</tr>

%				}

				<tr class="liblrow">

					<td align="center">
						<a class="dkblue button" href="pattern_add.mhtml">
							Add
						</a>
					</td>

					<td colspan="3" align="right">
						<input type="submit" value="Save Double Entry Settings" >
						</form>
					</td>
				</tr>

			</table>

			<h4>Place Events in Cross Entry Groups</h4>

			<form action="event_patterns_save.mhtml">

%			my $counter++;

			<div class="full row">

%			foreach my $event (sort {$a->name cmp $b->name} 
%				$m->comp("/funclib/tourn_events.mas", tourn => $tourn)) { 

%				if ($counter++ % 2) { 

					</div>
					<div class="full row">
%				}

				<span class="half">

					<span class="half">
						<% $event->name %> 
					</span>

					<span class="half">

						<select name="<% $event->id %>" class="fixedmed">

							<option value="">----</option>

%							foreach my $pattern (sort {$a->name cmp $b->name} $tourn->patterns) { 
								<option 
									value="<% $pattern->id %>" 
									<% ($event->pattern && $event->pattern->id == $pattern->id) ? "selected" : "" %>
									><% $pattern->name %></option>
%							}
						</select>
					</span>
				</span>
%			}

			</div>


			<div class="block liblrow rightalign">
				<input type="submit"  value="Save Event Groupings">
				</form>
			</div>

	</div>

	

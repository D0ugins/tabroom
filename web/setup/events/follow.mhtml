<%args>
	$tourn
	$perms
	$tourn_settings
	$person
	$person_settings
	$event_id => undef
</%args>
<%init>

	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;

	my $event = Tab::Event->retrieve($event_id);
	$event = $tourn->events->first unless $event;

	my @schools = $tourn->schools;

	my $follower_ids = $event->setting("followers");

	my @followers;
	
	foreach my $id (split(/,/, $follower_ids)) { 
		next unless $id;
		my $follower = Tab::Person->retrieve($id);
		push @followers, $follower;
	}

	my $districts = $tourn_settings->{"nsda_district"};

</%init>

	<div class="main">

		<span class="half">
			<h2><% $event->name %></h2>
		</span>


		<& 
			"tabbar.mas", 
			person          => $person,
			person_settings => $person_settings,
			event           => $event,
			whoami          => "follow",
			districts       => $districts
		&>

%		my $auto_backups = $event->setting("auto_backups");

		<span class="half">
			<h4>Status Texts for <% $event->abbr %></h4>
		</span>

		<label for="auto_backups">
			<span class="half rightalign hover">
				<span class="twothirds">
					Auto-email round backups:
				</span>

				<span class="sixth centeralign">
					<& "/funclib/bool_switch.mas", 
						tag     => "auto_backups",
						value   => $auto_backups,
						target  => $event,
						smaller => 1
					&>
				</span>
			</span>
		</label>

		<p>
			Follow an event to recieve text messages or emails when an event's
			first and last ballot are entered &amp; confirmed. 
		</p>

%		foreach my $follower (@followers) { 

%			next unless $follower;
	
			<div class="row">

				<span class="third">
					<% $follower->first." ".$follower->last %>
				</span>

				<span class="third">
					<% $follower->email %>
				</span>

				<span class="third centeralign">
					<a 
						class = "redtext buttonwhite fa fa-lg fa-trash" 
						href  = "follower_rm.mhtml?follower_id=<% $follower->id %>&event_id=<% $event->id %>"
					>
					</a>
				</span>

			</div>

%		}

		<form action="follower_add.mhtml" method="post">
		<input 
			type  = "hidden"
			name  = "event_id"
			value = "<% $event->id %>"
		>

		<div class="liblrow">
			<span class="third">
				Add follower:
			</span>
			<span class="third centeralign">
				<input
					type        = "text"
					name        = "username"
					size        = "30"
					placeholder = "Enter username..."
				>
			</span>
			<span class="third centeralign">
				<input 
					type  = "submit"
					value = "Add Follower"
				>
			</span>
		</div>

		</form>

	</div>
			
	<div class="menu">
		<& 
			"menu.mas",
			tourn          => $tourn,
			perms          => $perms,
			tourn_settings => $tourn_settings,
			person         => $person,
			whoami         => "follow",
			districts      => $districts,
			event_id       => ($event) ? $event->id : ""
		&>
	</div>

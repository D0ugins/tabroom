<%args>
	$tourn
	$tourn_settings
	$person
	$person_settings
	$event_id => undef
</%args>
<%init>

	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;

	my $event = Tab::Event->retrieve($event_id);
	$m->abort unless $event;

	my @settings = ( 
		"allow_judge_own",
		"allow_repeat_elims",
		"allow_repeat_judging",
		"allow_repeat_prelim_side",
		"anonymous_public",
		"autopublish_results",
		"avoid_school_hits",
		"best_judges_highest_seed",
		"blind_mode",
		"invert_postings",
		"bracket_by_ballots",
		"bracket_rooms",
		"repeat_rooms",
		"break_point",
		"default_panel_size",
		"disallow_repeat_drop",
		"elim_method",
		"hybrids_can_hit",
		"judge_publish_results",
		"judge_codes_only",
		"live_updates",
		"max_nobreak_pref",
		"max_panel_size",
		"max_pref",
		"min_panel_size",
		"nobreak_noprefs",
		"no_first_years",
		"panel_labels",
		"powermatch",
		"prevent_hitting_pullup_twice",
		"pullup_method",
		"pullup_minimize",
		"pullup_repeat",
		"region_avoid",
		"region_constrain",
		"region_judge_forbid",
		"round_robin",
		"schem_designation",
		"schem_orientation",
		"school_debates_self",
		"school_percent_limit",
		"seed_presets",
		"separate_codes",
		"snake_sides_huge_schools",
		"speaker_priority_first",
		"wsdc_cap_repel",
		"wsdc_multiple_sites");

	if ($tourn_settings->{"nsda_district"}) { 

		push @settings, "nsda_min_prelims";

		if ($person->site_admin || $person_settings->{"nsda_admin"}) { 
			push @settings, "no_side_constraints";
		}
	} else { 
		push @settings, "no_side_constraints";
	}

	foreach my $setting (@settings) {
		my $value = $ARGS{$setting};
		$value = 0 unless $value;
		$event->setting($setting, $value);
	}

	my $msg = "Pairing settings saved";
	
	$m->redirect("sectioning.mhtml?event_id=".$event->id."&msg=$msg");
		
</%init>

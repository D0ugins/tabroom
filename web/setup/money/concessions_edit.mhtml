<%args>
	$tourn
	$tourn_settings
	$person
	$concession_id => undef
</%args>
<%init>

	my $concession = Tab::Concession->retrieve($concession_id) if $concession_id;

	unless ($concession && $concession->tourn->id == $tourn->id) { 
		my $err = "That concession does not exist in your tournament";
		$m->redirect("concessions.mhtml?err=$err");
	}

</%init>

    <& "menu.mas", 
		chosen => "concessions", 
		tourn => $tourn 
	&>

	<& "/funclib/editor.mas" &>

	<div class="main">

		<h4>Edit details for <% $concession->name %></h4>

		<form 
			action = "concession_desc_save.mhtml"
			method = "post"
		>

			<input
				type="hidden"
				name="concession_id"
				value="<% $concession->id %>"
			>

			<div class="seveneighths leftalign">
				<h6>Description of <% $concession->name %>:</h6>
			</div>

			<div class="nospace centeralign full lightodd">

				<span class="seveneighths centeralign">
					<textarea
						name="description"
						rows="5"
						cols="72"
					><% $concession->description %></textarea>
				</span>

				<span class="eighth centeralign">
					<input
						type="submit"
						value="Save"
					>
				</span>

			</div>

		</form>

%		foreach my $type ($concession->concession_types) { 

			<h5 class="marleftmore martop padtop marbottom">
				Option Type <% $type->name %>
			</h5>
				
			<div class="full martopmore">

				<form 
					action="concession_type_save.mhtml" 
					method="post"
				>

				<input 
					type="hidden"
					name="type_id"
					value="<% $type->id %>"
				>

				<input
					type="hidden"
					name="concession_id"
					value="<% $concession->id %>"
				>

				<div class="full nospace ltyellow marbottom">

					<span class="sixth strong">
						Name &amp; Desc: 
					</span>

					<span class="third rightalign">
						Label
						<input
							type  = "text"
							name  = "name"
							size  = "24"
							value = "<% $type->name %>"
						>
					</span>

					<span class="half">
						Description:
						<input
							type  = "text"
							name  = "description"
							size  = "32"
							value = "<% $type->description %>"
						>
					</span>

				</div>

%				my @options = $type->concession_options;

%				if (@options) { 

					<div class="padmore borderbottom">
						<h6>
							Options for <% $type->name %>:
						</h6>
					</div>
%				}

%				my $count = 1;

%				foreach my $option (@options) { 

					<div class="lightrow">

						<span class="fifth centeralign">
							<% $count++ %>.
							<input
								type  = "text"
								name  = "<% $option->id %>_name"
								size  = "8"
								value = <% $option->name %>
							>
						</span>

						<span class="twofifths">
							<input
								type  = "text"
								name  = "<% $option->id %>_description"
								size  = "32"
								value = "<% $option->description %>"
							>
						</span>

						<span class="eighth centeralign">
							<% scalar $option->purchases %> sold
						</span>

						<label for="<% $option->id %>_disabled">
							<span 
								title="When checked, further sales of this option are disabled"
								class="eighth centeralign hover"
							>
								<span class="redtext fa fa-times-circle fa-lg"></span>
								<input
									type  = "checkbox"
									name  = "<% $option->id %>_disabled"
									id  = "<% $option->id %>_disabled"
									value = "1"
									<% $option->disabled ? 'checked="true"' : "" %>
								>
							</span>
						</label>

						<span class="tenth centeralign">

%							my $warn = "This will delete this option and ANY PURCHASES MADE.  You sure?";

							<a 
								class="redtext buttonwhite fa fa-lg fa-trash"
								<& "/funclib/confirm.mas", warn => $warn &>
								href="concessions_option_rm.mhtml?option_id=<% $option->id %>"
							></a>

						</span>


					</div>

%				}

				<div class="rightalign padmore">

					<input 
						type='submit'
						value="Save Changes"
						class="thin marbottom"
					>
					</form>
					
				</div>

				<div class="full nospace lightodd marbottom">

					<form 
						action = "concessions_option_add.mhtml"
						method = "post"
						id     = "add_<% $type->id %>"
					>

					<input
						type="hidden"
						name="concession_id"
						value="<% $concession->id %>"
					>

					<input
						type="hidden"
						name="type_id"
						value="<% $type->id %>"
					>

						<span class="fifth strong">
							New <% $type->name %>
						</span>

						<span class="fifth centeralign">
							Code:
							<input
								type        = "text"
								name        = "name"
								size        = "8"
								placeholder = "Limit 8 Chars"
							>
						</span>

						<span class="fourtenths">
							Name:
							<input
								type        = "text"
								name        = "description"
								size        = "32"
								placeholder = "Limit 30 Chars"
							>
						</span>

						<label for="disabled">
							<span 
								title = "Click this to disable this option"
								class=" centeralign hover"
							>
								<input
									type  = "checkbox"
									name  = "disabled"
									id    = "disabled"
									value = "1"
								>
							</span>
						</label>

						<span class="tenth centeralign">
							<a 
								onClick="document.forms['add_<% $type->id %>'].submit();"
								class="buttonwhite greentext fa fa-lg fa-plus-circle hover"
							></a>
						</span>

						<span class="hidden">
							<input type="submit" value="whatever">
						</span>

					</form>

				</div>

			</div>
%		}

		<div class="martopmuchmore">

			<h5>Add New Option Type (Size, destination, color, etc)</h5>

			<div class="lightodd">
				
				<form 
					action="concession_type_save.mhtml" 
					method="post"
				>

				<input
					type="hidden"
					name="concession_id"
					value="<% $concession->id %>"
				>

				<div class="full nospace">

					<span class="third">

						Label 

						<input
							type        = "text"
							name        = "name"
							size        = "24"
							placeholder = "e.g. Size, color, type"
						>
					</span>

					<span class="half">

						Description:
						<input
							type        = "text"
							name        = "description"
							size        = "32"
							placeholder = "Optional"
						>
					</span>

					<span class="eighth centeralign">
						<input
							type="submit"
							value="Add New"
						>
					</span>

				</div>

				</form>

		</div>



	</div>


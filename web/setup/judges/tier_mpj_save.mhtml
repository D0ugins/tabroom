<%args>
	$category_id
</%args>
<%init>

	my $category = Tab::Category->retrieve($category_id);

	my $start_done;

	foreach my $qual ($category->rating_tiers( type => "mpj" )) { 

		my $start = $ARGS{$qual->id."_start"};
		$start = 0 if $start_done;
		$start_done++ if $start > 0;

		$qual->name($ARGS{$qual->id."_name"});
		$qual->max($ARGS{$qual->id."_max"});
		$qual->min($ARGS{$qual->id."_min"});
		$qual->start($start);

		$qual->strike($ARGS{$qual->id."_strike"});
		$qual->conflict($ARGS{$qual->id."_conflict"});
		$qual->update;

	}

	if ( $ARGS{"new_name"} ) { 

		my $start = 0;
		$start = $ARGS{"new_start"} if $ARGS{"new_start"};

		my $qual = Tab::RatingTier->create({
			name     => $ARGS{"new_name"},
			max      => $ARGS{"new_max"},
			min      => $ARGS{"new_min"},
			strike   => $ARGS{"new_strike"},
			start    => $start,
			conflict => $ARGS{"new_conflict"},
			category => $category_id,
			type     => "mpj"
		});

	}

	my $msg = "MPJ/Community ratings are saved";
	$m->redirect("/setup/judges/tiers.mhtml?category_id=$category_id&msg=$msg");
	
</%init>

<%args>
	$person
	$category_id
	$tourn
	$tourn_settings
</%args>
<%init>

	my $category = Tab::Category->retrieve($category_id);

	my %category_settings = $category->all_settings();

	my $judge_per = $category_settings{"judge_per"};
	my $rounds_per = $category_settings{"rounds_per"};

	my $err;

	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;

	$category_settings{"hired_deadline"}->set_time_zone($tz)
		if $category_settings{"hired_deadline"};

</%init>

	<&
		"menu.mas",
		tourn          => $tourn,
		tourn_settings => $tourn_settings,
		category_id    => $category_id,
		page           => "hires"
	&>

	<div class="main">

		<h2>
			<% $category->name %>
		</h2>

		<&
			"tabbar.mas",
			tourn          => $tourn,
			tourn_settings => $tourn_settings,
			whoami         => "hires",
			category       => $category
		&>


		<form
			action = "hires_save.mhtml"
			method = "post"
		>

		<input
			type  = "hidden"
			value = "<% $category %>"
			name  = "category_id"
		>

		<div class='truefull nospace'>

		<span class="pagehalf">

			<h5>
				Tournament Supplied Hires
			</h5>

			<label for="track_judge_hires">
				<div class="row hover">
					<span class="fourfifths padleft">
						Offer tournament hired judging
					</span>
					<span class="fifth centeralign">
                        <& "/funclib/bool_switch.mas",
                            tag     => "track_judge_hires",
                            value   => $category_settings{"track_judge_hires"},
                            target  => $category,
                            smaller => 1,
                        &>
					</span>
				</div>
			</label>

			<label for="cannot_cancel_hires">
				<div class="row hover">
					<span class="fourfifths padleft">
						Registrant cannot cancel accepted hires
					</span>
					<span class="fifth centeralign">
						<& "/funclib/bool_switch.mas",
							tag     => "cannot_cancel_hires",
							value   => $category_settings{"cannot_cancel_hires"},
							target  => $category,
							smaller => 1,
						&>
					</span>
				</div>
			</label>

%			if ($category_settings{"missing_judge_fee"} > 0) {
				<label for="missing_judge_fee_is_hired">
					<div class="row hover">
						<span class="fourfifths padleft">
							Missing Judge Fee
							(<% $tourn_settings->{"currency"} %><% $category_settings{"missing_judge_fee"} %>)
							counts as a hire
						</span>
						<span class="fifth centeralign">
							<& "/funclib/bool_switch.mas",
								tag     => "missing_judge_fee_is_hired",
								value   => $category_settings{"missing_judge_fee_is_hired"},
								target  => $category,
								smaller => 1,
							&>
						</span>
					</div>
				</label>
%			}

%			if ($judge_per) {

				<div class="row" >

					<span
						class = "threequarters padleft"
						title = "Put 0 to manage all hire requests manually."
					>
						Number of hired judges available.
					</span>

					<span class="quarter centeralign">
						<input
							type  = "number"
							name  = "hired_jpool"
							min   = "0"
							max   = "9999"
							size  = "4"
							value = "<% $category_settings{"hired_jpool"} %>"
						>
					</span>

				</div>

%			} elsif ($rounds_per) {

				<div class="row" >

					<span class="threequarters padleft">
						Number of hired rounds available.
						<br /><span class="nospace padleft explain">Put 0 to manage hires manually</span>
					</span>

					<span class="quarter centeralign">
						<input
							type  = "number"
							name  = "hired_rounds"
							min   = "0"
							max   = "9999"
							value = "<% $category_settings{"hired_rounds"} %>"
						>
					</span>

				</div>
%			}

			<div
				class = "row"
				title = "Judge hire requests cannot be changed or dropped after this date.  Leave blank and the overall judge deadline will apply."
			>

				<span class="third padleft">
					Hire Deadline
				</span>

				<span class="third marno centeralign">

		            <& "/funclib/datepicker.mas",
						id => "hired_date"
					&>

					<input
						type  = "text"
						id    = "hired_date"
						name  = "hired_date"
						value = "<% Tab::pickerdate($category_settings{"hired_deadline"}) %>"
						size  = "12"
					>
				</span>

				<span class="third marno centeralign">
					at
                    <& "/funclib/timepicker.mas",
						name => "hired_time",
						size => 8,
						time => $category_settings{"hired_deadline"}
					&>
				</span>
			</div>

		</span>

		<span class="pagehalf">

			<h5>Judge Exchange*</h5>

			<label for="exchange">

				<div
					class = "row hover"
					title = "The judge hiring exchange enables schools to directly hire tournament approved judges"
				>
					<span class="fourfifths">
						Enable Judge Exchange
					</span>

					<span class="fifth centeralign">
                        <& "/funclib/bool_switch.mas",
                            tag     => "exchange",
                            value   => $category_settings{"exchange"},
                            target  => $category,
                            smaller => 1,
                        &>
					</span>
				</div>
			</label>

			<label for="auto_conflict_hires">

				<div class="row hover">
					<span class="fourfifths">
						Conflict exchange-hired judging
					</span>

					<span class="fifth centeralign">
                        <& "/funclib/bool_switch.mas",
                            tag     => "auto_conflict_hires",
                            value   => $category_settings{"auto_conflict_hires"},
                            target  => $category,
                            smaller => 1,
                        &>
					</span>
				</div>
			</label>

%			if ($tourn_settings->{"nsda_ms_nats"}) {

				<h5>
					Paradigm form
				</h5>

				<div class="row">
					<span class="twofifths">
						Paradigm Form
					</span>

					<span class="threefifths centeralign">
						<select name="paradigm_form" class="fixedmed">
							<option value="">None</option>
							<option
								value="LDParadigm"
								<% $category_settings{"paradigm_form"} eq "LDParadigm"
									? "selected"
									: ""
								%>
							>LD</option>

							<option
								value="PolicyParadigm"
								<% $category_settings{"paradigm_form"} eq "PolicyParadigm"
									? "selected"
									: "" %>
							>Policy</option>
						</select>
					</span>
				</div>
%			}

		</span>
		</div>

		<div class="truefull nospace">
		<span class="pagehalf">

			<div class="full settings fixedheight ">

				<span class="threefifths nospace">
					<h5>Hired Judge Cost</h5>
				</span>

				<span class="twofifths rightalign semibold redtext nospace padtopmore">
					<% $rounds_per || $category_settings{"nats_category"}
						? ""
						: "<p>Choose one</p>"
					%>
				</span>
			</div>


%			if ($rounds_per || $category_settings{"nats_category"}) {

				<div class="row" >
					<span class="threequarters">
						Charge per round:
					</span>
					<span class="quarter centeralign nowrap">
						$ <input
							type  = "number"
							name  = "round_hire_fee"
							min   = "0"
							max   = "9999"
							value = "<% $category_settings{"round_hire_fee"} %>"
						>
					</span>
				</div>

%				if ($category_settings{"nats_category"}) {

					<div class="row">
						<span class="threequarters">
							Minimum supplied rounds
						</span>
						<span class="quarter centeralign nowrap">
							<input
								type  = "number"
								name  = "minimum_supplied"
								min   = "0"
								max   = "99"
								value = "<% $category_settings{"minimum_supplied"} %>"
							>
						</span>
					</div>

					<div class="row">
						<span class="threequarters">
							Fine if under minimum
						</span>
						<span class="quarter centeralign nowrap">
							<input
								type  = "number"
								name  = "minimum_supplied_fine"
								min   = "0"
								max   = "99999"
								value = "<% $category_settings{"minimum_supplied_fine"} %>"
							>
						</span>
					</div>
%				}

%			} else {

%				if ($err eq "You can only use one hiring method for judges, not both.") {
					<div class="redrow">
% 				} else {
					<div class="row" >
%				}

					<span class="threequarters">
						Charge for each whole judge hired:
					</span>

					<span class="quarter centeralign">
						<input
							type  = "number"
							name  = "hired_fee"
							min   = "0"
							max   = "9999"
							value = "<% $category_settings{"hired_fee"} %>"
						>
					</span>

				</div>

%				if ($err eq "You can only use one Hiring Method for judges, not both.") {
					<div class="redrow">
% 				} else {
					<div class="row" >
%				}

					<span class="threequarters">
						Charge for each entry covered by hires:
					</span>

					<span class="quarter centeralign">
						<input
							type  = "number"
							name  = "uncovered_entry_fee"
							min   = "0"
							max   = "9999"
							value = "<% $category_settings{"uncovered_entry_fee"} %>"
						>
					</span>

				</div>

%			}
		</span>

		<span class="pagehalf">
			<div class="full settings fixedheight ">
				<span class="fourfifths nospace">
					<h5>
						Public Judge Signups**
					</h5>
				</span>

				<span class="fifth rightalign semibold redtext nospace">
					&nbsp;
				</span>
			</div>


			<label for="public_signups">

				<div
					class = "row hover"
					title = "Public signups allows judges to sign themselves up for your tournament"
				>

					<span class="fourfifths">
						Enable Public Judge Signups
					</span>

					<span class="fifth centeralign">
                        <& "/funclib/bool_switch.mas",
                            tag     => "public_signups",
                            value   => $category_settings{"public_signups"},
                            target  => $category,
                            smaller => 1,
                        &>
					</span>

				</div>
			</label>

			<div
				class = "row hover settings"
				title = "Public signups allows judges to sign themselves up for your tournament"
			>

				<span class="third">
					Signup Deadline
				</span>

				<span class="third marno centeralign">

		            <& "/funclib/datepicker.mas",
						id => "public_signups_date"
					&>

					<input
						type  = "text"
						id    = "public_signups_date"
						name  = "public_signups_date"
						value = "<% Tab::pickerdate($category_settings{"public_signups_deadline"}) %>"
						size  = "12"
					>
				</span>

				<span class="third marno centeralign">
					at
                    <& "/funclib/timepicker.mas",
						name => "public_signups_time",
						size => 8,
						time => $category_settings{"public_signups_deadline"}
					&>
				</span>

			</div>

		</span>
		</div>

		<div class="libl pagefull rightalign">
			<input
				type  = "submit"
				value = "Save Hired Judge Settings"
			>
			</form>
		</div>

		<p class="martopmore">
			* This option allows judges both already coming from schools or
			neutrals to offer hired judging to other schools on your site.
			You must approve hiring offers first under the Entries &rarr; Judges
			menu; then schools may hire judging directly from approved
			judges.
		</p>

		<p class="martopmore">
			** This option will allow judges to register for your tournament
			on your public Tabroom site.  Use this to have hired or
			volunteer judges sign in with their own information and Tabroom
			accounts.
		</p>

		<p>
			Use the 'shifts' tab to enable them to declare availability for
			only part of your tournament.  You can also enter a message for the
			public signup page under the Messages tab.
		</p>

		<p>
			All publicly signed up judges will be marked INACTIVE to begin;
			you must activate them before they will be available to judge.
		</p>

	</div>




<%args>
	$person
	$category_id
	$tourn
	$tourn_settings
</%args>
<%init>

	my $category = Tab::Category->retrieve($category_id);

	my %category_settings = $category->all_settings();

	my $judge_per = $category_settings{"judge_per"};
	my $rounds_per = $category_settings{"rounds_per"};

	my $err;

	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;

	$category_settings{"hired_rounds"}->set_time_zone($tz) if $category_settings{"hired_rounds"};

</%init>

	<& 
		"menu.mas",
		tourn          => $tourn,
		tourn_settings => $tourn_settings,
		category_id    => $category_id,
		page           => "hires"
	&>

	<div class="main">

		<h2>
			<% $category->name %>
		</h2>

		<& 
			"tabbar.mas", 
			tourn          => $tourn,
			tourn_settings => $tourn_settings,
			whoami         => "hires",
			category       => $category
		&>
			
		<h4>
			Hired Judging
		</h4>

		<form 
			action = "hires_save.mhtml"
			method = "post"
		>

		<input 
			type  = "hidden"
			value = "<% $category_id %>"
			name  = "category_id"
		>

		<span class="pagehalf">
		
			<label for="track_judge_hires">
				<div class="row hover">
				
					<span class="fourfifths padleft">
						Offer tournament hired judging
					</span> 
					
					<span class="fifth centeralign">
						<input 
							type  = "checkbox"
							id    = "track_judge_hires"
							name  = "track_judge_hires"
							value = "1"
							<%  $category_settings{"track_judge_hires"} ? "checked" : "" %>> 
					</span>
					
				</div> 
			</label>

%			if ($judge_per) { 

				<div 
					class="row" 
				>

					<span 
						class="threequarters padleft"
						title="Put 0 to manage all hire requests manually."
					>
						Number of hired judges available.  
					</span> 
				
					<span class="quarter centeralign"> 
						<input 
							type  = "number"
							name  = "hired_jpool"
							min   = "0"
							max   = "9999"
							size  = "4"
							value = "<% $category_settings{"hired_jpool"} %>"
						>
					</span>
				
				</div>

%			} elsif ($rounds_per) { 

				<div class="row" >

					<span class="threequarters padleft">
						Number of hired rounds available.  
						<br /><span class="nospace padleft explain">Put 0 to manage hires manually</span>
					</span> 
				
					<span class="quarter centeralign"> 
						<input 
							type  = "number"
							name  = "hired_rounds"
							min   = "0"
							max   = "9999"
							value = "<% $category_settings{"hired_rounds"} %>"
						>
					</span>

				</div>
%			}

			<div 
				class = "row"
				title = "Judge hire requests cannot be changed or dropped after this date.  Leave blank and the overall judge deadline will apply."
			>

				<span class="third padleft">
					Hire Deadline
				</span> 
						
				<span class="third marno centeralign">

		            <& "/funclib/datepicker.mas",
						id => "hired_date"
					&>

					<input 
						type  = "text"
						id    = "hired_date"
						name  = "hired_date"
						value = "<% Tab::pickerdate($category_settings{"hired_deadline"}) %>"
						size  = "12"
					>
				</span>

				<span class="third marno centeralign">
					at 
                    <& "/funclib/timepicker.mas",
						name => "hired_time",
						size => 8,
						time => $category_settings{"hired_deadline"}
					&>
				</span>

			</div>

		</span>

		<span class="pagehalf">

			<label for="exchange">

				<div 
					class = "row hover"
					title = "The hiring exchange enables schools to directly hire tournament approved judges"
				>

					<span class="fourfifths">
						Enable Hiring Exchange
					</span> 
						
					<span class="fifth centeralign">
						<input 
							type  = "checkbox"
							id    = "exchange"
							name  = "exchange"
							value = "1"
							<% $category_settings{"exchange"} ? "checked" : "" %>> 
					</span>

				</div>
			</label>

			<label for="auto_conflict_hires">
				<div class="row hover">
				
					<span class="fourfifths">
						Conflict exchange-hired judging 
					</span> 
					
					<span class="fifth centeralign">
						<input 
							type  = "checkbox"
							id    = "auto_conflict_hires"
							name  = "auto_conflict_hires"
							value = "1"
							<%  $category_settings{"auto_conflict_hires"} ? "checked" : "" %>> 
					</span>
					
				</div> 
			</label>

%			if ($tourn_settings->{"nsda_ms_nats"}) { 

				<h5>
					Paradigm form
				</h5>

				<div class="row">
				
					<span class="twofifths">
						Paradigm Form
					</span> 
					
					<span class="threefifths centeralign">
						
							<select name="paradigm_form" class="fixedmed">

							<option value="">None</option>

							<option 
								value="LDParadigm"
								<% $category_settings{"paradigm_form"} eq "LDParadigm" 
									? "selected" 
									: ""
								%>
							>LD</option>

							<option 
								value="PolicyParadigm"
								<% $category_settings{"paradigm_form"} eq "PolicyParadigm" 
									? "selected" 
									: "" %>
							>Policy</option>
						</select>
					</span>
					
				</div> 
%			}

		</span>

			<h5>
				Hired judge cost <% $rounds_per || $category_settings{"nats_category"} 
					? "" 
					: "(Use only one)"
				%>
			</h5>

%			if ($rounds_per || $category_settings{"nats_category"}) { 

				<div class="row" >

					<span class="threequarters">
						Charge per round:
					</span> 
					
					<span class="quarter centeralign nowrap">
						$ <input 
							type  = "number"
							name  = "round_hire_fee"
							min   = "0"
							max   = "9999"
							value = "<% $category_settings{"round_hire_fee"} %>"
						>
					</span>

				</div>

%				if ($category_settings{"nats_category"}) { 

					<div class="row">

						<span class="threequarters">
							Minimum supplied rounds
						</span> 
						
						<span class="quarter centeralign nowrap">
							<input 
								type  = "number"
								name  = "minimum_supplied"
								min   = "0"
								max   = "99"
								value = "<% $category_settings{"minimum_supplied"} %>"
							>
						</span>

					</div>

					<div class="row">

						<span class="threequarters">
							Fine if under minimum
						</span> 
						
						<span class="quarter centeralign nowrap">
							<input 
								type  = "number"
								name  = "minimum_supplied_fine"
								min   = "0"
								max   = "99999"
								value = "<% $category_settings{"minimum_supplied_fine"} %>"
							>
						</span>

					</div>
%				}

%			} else { 

%				if ($err eq "You can only use one hiring method for judges, not both.") { 
					<div class="redrow">
% 				} else { 
					<div class="row" >
%				}

					<span class="threequarters">
						Charge for each whole judge hired:
					</span>

					<span class="quarter centeralign">
						<input 
							type  = "number"
							name  = "hired_fee"
							min   = "0"
							max   = "9999"
							value = "<% $category_settings{"hired_fee"} %>"
						>
					</span>

				</div>

%				if ($err eq "You can only use one Hiring Method for judges, not both.") { 
					<div class="redrow">
% 				} else { 
					<div class="row" >
%				}

					<span class="threequarters">
						Charge for each entry covered by hires:
					</span> 
					
					<span class="quarter centeralign">
						<input 
							type  = "number"
							name  = "uncovered_entry_fee"
							min   = "0"
							max   = "9999"
							value = "<% $category_settings{"uncovered_entry_fee"} %>"
						>
					</span>

				</div> 

%			}


			<h5>
				Public Judge Signups
			</h5>

			<div class="row">

			<p class="explain">

				This option will allow judges to register for your tournament
				on your public Tabroom site.  Use this to have hired or
				volunteer judges sign in with their own information and Tabroom
				accounts.  Use the 'shifts' tab to enable them to declare
				availability for only part of your tournament.  You can also
				enter a message for the public signup page under the Messages
				tab.
			</p>
				
			<p class="explain">
				All publicly signed up judges will be marked INACTIVE to begin;
				you must activate them before they will be available to judge.
			</p>

			</div>

			<label for="public_signups">

				<div 
					class = "row hover"
					title = "Public signups allows judges to sign themselves up for your tournament"
				>

					<span class="fourfifths">
						Enable Public Judge Signups
					</span> 
						
					<span class="fifth centeralign">
						<input 
							type  = "checkbox"
							id    = "public_signups"
							name  = "public_signups"
							value = "1"
							<% $category_settings{"public_signups"} ? "checked" : "" %>> 
					</span>

				</div>
			</label>

			<div 
				class = "row hover"
				title = "Public signups allows judges to sign themselves up for your tournament"
			>

				<span class="threefifths">
					Judge Signup Deadline
				</span> 
						
				<span class="fifth marno centeralign">

		            <& "/funclib/datepicker.mas",
						id => "public_signups_date"
					&>

					<input 
						type  = "text"
						id    = "public_signups_date"
						name  = "public_signups_date"
						value = "<% Tab::pickerdate($category_settings{"public_signups_deadline"}) %>"
						size  = "12"
					>
				</span>

				<span class="fifth marno marvert centeralign">
					at 
                    <& "/funclib/timepicker.mas",
						name => "public_signups_time",
						size => 8,
						time => $category_settings{"public_signups_deadline"}
					&>
				</span>

			</div>

		<div class="liblrow rightalign">
			<input 
				type  = "submit"
				value = "Save Hired Judge Settings"
			>
			</form>
		</div>

	</div>




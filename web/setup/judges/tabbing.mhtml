<%args>
	$tourn
	$tourn_settings
	$person
	$category_id
	$new => undef
</%args>
<%perl>

	my $category = Tab::Category->retrieve($category_id);

	my %category_settings = $category->all_settings if $category;

</%perl>

	<& 
		"menu.mas",
		tourn          => $tourn,
		tourn_settings => $tourn_settings,
		page           => "tabbing",
		category_id    => $category_id,
	&>

	<div class="main">

		<h2>
			<% $category->name %>
		</h2> 
	
%		if ($category) { 
			<& 
				"tabbar.mas", 
				tourn          => $tourn,
				tourn_settings => $tourn_settings,
				whoami         => "tabbing",
				category       => $category
			&>
%		}

		
		<form action="tabbing_save.mhtml" method="post">

		<input 
			type  = "hidden"
			value = "<% $category_id %>"
			name  = "category_id"
		>

		<span class="pagehalf">
		
			<h4 class="padno">Pairing settings</h4>

			<label for="no_back_to_back">
				<div class="hover row">
					<span class="fivesixth">
							Prevent back to back rounds
					</span>
					<span class="sixth centeralign">

						<input 
							type  = "checkbox"
							name  = "no_back_to_back"
							id    = "no_back_to_back"
							value = "1"
							<% ($category) ? ($category_settings{"no_back_to_back"}) ? "checked" : "" : "" %>
						>
					</span>
				</div>
			</label>

			<label for="judge_event_twice">
				<div class="hover row">
					<span class="fivesixth">
							Judges can get the same event twice
					</span>
					<span class="sixth centeralign">
						<input 
							type  = "checkbox"
							name  = "judge_event_twice"
							id    = "judge_event_twice"
							value = "1"
							<% ($category) ? ($category_settings{"judge_event_twice"}) ? "checked" : "" : "" %>
						>
					</span>
				</div>
			</label>

			<label for="override_jpools">

				<div class="hover row">

					<span class="fivesixth">
						Do not let judge pools override categories
					</span>

					<span class="sixth centeralign">
						<input 
							type  = "checkbox"
							name  = "override_jpools"
							id    = "override_jpools"
							value = "1"
							<% $category_settings{"override_jpools"} ? "checked" : "" %>
						>
					</span>
				</div>
			</label>

%			if ($tourn_settings->{"ncfl"}) { 

				<label for="allow_school_panels">

					<div class="hover row">

						<span class="fivesixth">
							Allow panels w/same diocese judges
						</span>

						<span class="sixth centeralign">
							<input 
								type  = "checkbox"
								name  = "allow_school_panels"
								id    = "allow_school_panels"
								value = "1"
								<% $category_settings{"allow_school_panels"} ? "checked" : "" %>
							>
						</span>

					</div>
				</label>

				<label for="allow_region_panels">
					<div class="hover row">
						<span class="fivesixth">
							Allow panels w/same diocese region judges
						</span>
						<span class="sixth centeralign">
							<input 
								type  = "checkbox"
								name  = "allow_region_panels"
								id    = "allow_region_panels"
								value = "1" <% $category_settings{"allow_region_panels"} ? "checked" : "" %>
							>
						</span>
					</div>
				</label>

				<label for="conflict_region_judges">

					<div class="hover row">

						<span class="fivesixth">
							Conflict judges from same region
						</span>

						<span class="sixth centeralign">
							<input 
								type  = "checkbox"
								name  = "conflict_region_judges"
								id    = "conflict_region_judges"
								value = "1"
								<% $category_settings{"conflict_region_judges"} ? "checked" : "" %>
							>
						</span>

					</div>
				</label>

%			} else { 

				<label for="allow_school_panels">

					<div class="hover row">

						<span class="fivesixth">
							Allow panels w/same school judges
						</span>

						<span class="sixth centeralign">
							<input 
								type  = "checkbox"
								name  = "allow_school_panels"
								id    = "allow_school_panels"
								value = "1" 
								<% $category_settings{"allow_school_panels"} ? "checked" : "" %>
							>
						</span>
					</div>
				</label>

%				if ($tourn_settings->{"nsda_nats"}) { 

					<label for="allow_region_panels">

						<div class="hover row">

							<span class="fivesixth">
								Allow panels w/same state judges
							</span>

							<span class="sixth centeralign">
								<input 
									type  = "checkbox"
									name  = "allow_region_panels"
									id    = "allow_region_panels"
									value = "1" 
									<% $category_settings{"allow_region_panels"} ? "checked" : "" %>
								>
							</span>

						</div>

					</label>

					<label for="conflict_state_judges">

						<div class="hover row">

							<span class="fivesixth">
								Conflict judges from same state
							</span>

							<span class="sixth centeralign">
								<input 
									type  = "checkbox"
									name  = "conflict_state_judges"
									id    = "conflict_state_judges"
									value = "1"
									<% $category_settings{"conflict_state_judges"} ? "checked" : "" %>
								>
							</span>

						</div>
					</label>
%				} 

%			} 

%			unless ($tourn_settings->{"nsda_district"}) { 

				<label for="judge_randomize">

					<div class="hover row"
						title="By default, in multi-event judge categories, Tabroom will prefer
							judges whose schools have more entries in that category. Check this
							to disable that preference."
					>


						<span class="fivesixth">
							Randomize judge assignments*
						</span>
						<span class="sixth centeralign">
							<input 
								type  = "checkbox"
								name  = "judge_randomize"
								id    = "judge_randomize"
								value = "1"
								<% $category_settings{"judge_randomize"} ? "checked" : "" %>
							>
						</span>
					</div>
				</label>
%			} 

%		unless ($tourn_settings->{"nsda_district"}) { 

			<label for="track_diversity">

				<div class="hover row">

					<span class="fivesixth">
						Use diversity tracking
					</span>

					<span class="sixth centeralign">
						<input 
							type  = "checkbox"
							name  = "track_diversity"
							id    = "track_diversity"
							value = "1" 
							<% $category_settings{"track_diversity"} ? "checked" : "" %>
						>
					</span>

				</div>

			</label>

			<label for="show_diversity">

				<div class="hover row">

					<span class="fivesixth">
						Show diversity opt-ins on prefs
					</span>

					<span class="sixth centeralign">
						<input 
							type  = "checkbox"
							name  = "show_diversity"
							id    = "show_diversity"
							value = "1" 
							<% $category_settings{"show_diversity"} ? "checked" : "" %>
						>
					</span>

				</div>

			</label>

%		} 

		</span>

%		if ($category_settings{"prefs"} && $category_settings{"prefs"} ne "none") { 

			<span class="pagehalf">

				<h4 class="padno">
					MPJ placement weights
				</h4>

				<div class="row">
				  <span class="threequarter">
						Penalize non-mutual judges
					</span>
					<span class="quarter centeralign">

%						my $mutuality = $category_settings{"mutuality"} if $category;
%						$mutuality = 40 unless $mutuality;
%						$mutuality = 0 if $mutuality == -1;

						<input 
							type  = "number"
							class = "smaller"
							min   = 0
							max   = 999
							size  = 4
							name  = "mutuality"
							value = "<% $mutuality %>"
						>
					</span>
				</div>

				<div class="row">
				  <span class="threequarter">
						Penalize non-mutual panels
					</span>
					<span class="quarter centeralign">
%						my $panel_mutuality = $category_settings{"panel_mutuality"} if $category;
%						$panel_mutuality = 40 unless $panel_mutuality;
%						$panel_mutuality = 0 if $panel_mutuality == -1;
						<input 
							type  = "number"
							class = "smaller"
							min   = 0
							max   = 999
							size  = 4
							name  = "panel_mutuality"
							value = "<% $panel_mutuality %>">
					</span>
				</div>

				<div class="row">
				  <span class="threequarter">
						Penalize less preferred judges
					</span>
					<span class="quarter centeralign">
%						my $preference = $category_settings{"preference"} if $category;
%						$preference = 20 unless $preference;
%						$preference = 0 if $preference == -1;
						<input 
							type  = "number"
							class = "smaller"
							min   = 0
							max   = 999
							size  = 4
							name  = "preference"
							value = "<% $preference %>"
						>
					</span>
				</div>

				<div class="row">

				  <span class="threequarter">
						Avoid burning committments early
					</span>

					<span class="quarter centeralign">
%						my $round_burn_avoid = $category_settings{"round_burn_avoid"} if $category;
%						$round_burn_avoid = 5 unless $round_burn_avoid;
%						$round_burn_avoid = 0 if $round_burn_avoid == -1;
						<input 
							type  = "number"
							class = "smaller"
							min   = 0
							max   = 999
							size  = 4
							name  = "round_burn_avoid"
							value = "<% $round_burn_avoid %>"
						>
					</span>
				</div>

				<div class="row">
				  <span class="threequarter">
						Prefer hard-to-place judges
					</span>

					<span class="quarter centeralign">
%						my $sucktastic_judge_weight = $category_settings{"sucktastic_judge_weight"} if $category;
%						$sucktastic_judge_weight = 10 unless $sucktastic_judge_weight;
%						$sucktastic_judge_weight = 0 if $sucktastic_judge_weight == -1;

						<input 
							type  = "number"
							class = "smaller"
							min   = 0
							max   = 999
							size  = 4
							name  = "sucktastic_judge_weight"
							value = "<% $sucktastic_judge_weight %>"
						>
					</span>
				</div>

				<div class="row">
				  <span class="threequarter">
						Promote use of diverse judging
					</span>

					<span class="quarter centeralign">

%						my $diverse_judge_weight = $category_settings{"diverse_judge_weight"} if $category;
%						$diverse_judge_weight = 5 unless $diverse_judge_weight;
%						$diverse_judge_weight = 0 if $diverse_judge_weight == -1;

						<input 
							type  = "number"
							class = "smaller"
							min   = 0
							max   = 999
							size  = 4
							name  = "diverse_judge_weight"
							value = "<% $diverse_judge_weight %>"
						>
					</span>
				</div>

				<div class="row">

					<span class="threequarter">
						Prefer hired judges over obligated
					</span>

					<span class="quarter centeralign">

%						my $mjp_prefer_hireds = $category_settings{"mjp_prefer_hireds"} if $category;
%						$mjp_prefer_hireds = 10 unless $mjp_prefer_hireds;
%						$mjp_prefer_hireds = 0 if $mjp_prefer_hireds == -1;

						<input 
							type  = "number"
							class = "smaller"
							min   = 0
							max   = 999
							size  = 4
							name  = "mjp_prefer_hireds"
							value = "<% $mjp_prefer_hireds %>">
					</span>
				</div>


				<div class="row">
				  <span class="threequarter">
						Stand-in rating for non-preffed judges:
					</span>
					<span class="quarter centeralign">
						<input 
							type  = "number"
							class = "smaller"
							min   = 1
							max   = 99
							size  = 4
							name  = "default_mjp"
							value = "<% $category_settings{"default_mjp"} %>"
						>
					</span>
				</div>


			</span>

%		}

%		my $audit_method = $category_settings{"audit_method"};

		<span class="pagehalf">
		
			<h5>
				Tabulation settings
			</h5>

			<div class="row">

				<span class="twofifth">
					Ballot Entry
				</span>

				<span class="rightalign threefifth">

				  <select name="audit_method" class="fixedmed nochosen">

						<option 
							value="twice" 
							<% ($audit_method eq "twice") ? "selected" : "" %>
						> Enter twice; 2nd must match
						</option>

						<option 
							value="visual" 
							<% ($audit_method eq "visual") ? "selected" : "" %>
						> Visual scan with confirmation
						</option>

						<option 
							value="none" <% ($audit_method eq "none") ? "selected" : "" %>
						> Live dangerously; no required double-check
						</option>

					</select>

				</span>

			</div>

			<label for="ballot_entry_school_codes">

				<div class="hover row">

					<span class="fivesixth">
						Show 
							<% $tourn_settings->{"ncfl"} ? "diocese" : "school"%> 
						codes on ballot entry
					</span>

					<span class="sixth centeralign">
						<input 
							type  = "checkbox"
							name  = "ballot_entry_school_codes"
							id    = "ballot_entry_school_codes"
							value = "1"
							<% $category_settings{"ballot_entry_school_codes"} ? "checked" : "" %>
						>
					</span>

				</div>
			</label>

%		if ($category_settings{"prefs"} && $category_settings{"prefs"} ne "none") { 
			</span>
			<span class="pagehalf">
%		}

			<h5>Ballot Formats</h5>

			<label for="ballot_entry_names">

				<div class="hover row">

					<span class="fivesixth">
						List Entry Names
					</span>

					<span class="sixth centeralign">
						<input 
							type  = "checkbox"
							id    = "ballot_entry_names"
							name  = "ballot_entry_names"
							value = "1"
							<% $category_settings{"ballot_entry_names"} ? 'checked="checked"' : "" %>
						>
					</span>
				</div>
			</label>

			<label for="ballot_entry_first_names">

				<div class="hover row">

					<span class="fivesixth">
						List Entry First Names
					</span>

					<span class="sixth centeralign">

						<input 
							type  = "checkbox"
							id    = "ballot_entry_first_names"
							name  = "ballot_entry_first_names"
							value = "1" 
							<% $category_settings{"ballot_entry_first_names"} 
								? 'checked="checked"' 
							: "" %>
						>
					</span>
				</div>
			</label>

			<label for="ballot_entry_titles">

				<div class="hover row">

					<span class="fivesixth">
						Space for piece titles/question
					</span>

					<span class="sixth centeralign">
						<input 
							type  = "checkbox"
							id    = "ballot_entry_titles"
							name  = "ballot_entry_titles"
							value = "1"
							<% $category_settings{"ballot_entry_titles"} 
								? 'checked="checked"' 
								: ""
							%>
						>
					</span>
				</div>
			</label>

			<label for="ballot_times">
				<div class="hover row">
					<span class="fivesixth">
						Space for times
					</span>

					<span class="sixth centeralign">
						<input 
							type  = "checkbox"
							id    = "ballot_times"
							name  = "ballot_times"
							value = "1"
							<% $category_settings{"ballot_times"} 
								? 'checked="checked"' 
								: ""
							%>
						>
					</span>
				</div>
			</label>

			<label for="ballot_school_codes">
				<div class="hover row">
					<span class="fivesixth">
						School codes
					</span>

					<span class="sixth centeralign">
						<input 
							type  = "checkbox"
							id    = "ballot_school_codes"
							name  = "ballot_school_codes"
							value = "1"
							<% $category_settings{"ballot_school_codes"} 
								? 'checked="checked"' 
								: "" 
							%>
						>
					</span>
				</div>
			</label>

			<label for="ballot_school_names">
				<div class="hover row">
					<span class="fivesixth">
						School names
					</span>

					<span class="sixth centeralign">
						<input 
							type  = "checkbox"
							id    = "ballot_school_names"
							name  = "ballot_school_names"
							value = "1"
							<% $category_settings{"ballot_school_names"} 
								? 'checked="checked"' 
								: "" 
							%>
						>
					</span>
				</div>
			</label>

			<label for="ballot_judge_phones">
				<div class="hover row">
					<span class="fivesixth">
						Ask judges for their cell # on ballots
					</span>

					<span class="sixth centeralign">
						<input 
							type  = "checkbox"
							id    = "ballot_judge_phones"
							name  = "ballot_judge_phones"
							value = "1"
							<% $category_settings{"ballot_judge_phones"} 
								? 'checked="checked"' 
								: "" 
							%>
						>
					</span>
				</div>
			</label>
		</span>

		<div class="libl full rightalign marvertno">
			<input 
				type  = "submit"
				value = "Save Pairing/Tabbing Settings"
			>
			</form>
		</div>

	</div>

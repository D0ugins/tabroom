<%args>	
	$tourn
	$category_id
</%args>
<%init>

	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;

	my $category = Tab::Category->retrieve($category_id);

	my @days = $m->comp(
		"/funclib/tourn_days.mas", 
		tourn => $tourn
	);

	my $rounds_per = $category->setting("rounds_per");
	
</%init>

    <& "menu.mas", 
		category_id => $category_id,
		tourn       => $tourn,
		page        => "partials" 
	&>

	<div class="main">

		<h2>
			<% $category->name %>
		</h2>

		<& 
			"tabbar.mas", 
			whoami   => "partials",
			category => $category 
		&>

		<h4>Part-time judging</h4>

		<p>

			These timeblocks allow registering coaches to mark judges as
			unavailble during the blocks you specify.  The fees will be charged
			if a school is under their burden during that timeblock; so if a
			school owes 2 judges and only 1 judge is free on Friday night, the
			Friday night fine will be charged.  However, if the school brings 3
			judges, of which 2 are always available, the fine will not be
			charged.
		</p>

%		if ($rounds_per) { 
			<p><strong>*</strong>
				You cannot asses fines for part time judges when doing by round
				committments.  It doesn't make sense to charge someone for a part
				time committment when they're also specifying how many rounds they
				can judge. 
			</p>
%		}
		
		<form action="partials_save.mhtml" method="post">


		<input 
			type  = "hidden"
			name  = "category_id"
			value = "<% $category->id %>"
		>

		<table>

			<tr class="yellow">

				<th class="smallish">
					Name
				</th>

%				unless ($rounds_per) { 
					<th class="smallish">
						Fee
					</th>
%				}
					<th class="smallish">
						No Hires <br />
						just warn
					</th>

%				if (scalar @days > 1) { 
					<th class="smallish">
						Day
					</th>
%				}

				<th class="smallish">
					Start Time
				</th>

				<th class="smallish">
					End Time
				</th>

				<th>
				</th>

			</tr>

<%perl>
			foreach my $strike_timeslot (
				sort {$a->start->epoch <=> $b->start->epoch} 
				$category->strike_timeslots
			) {

				my $strike_timeslot_start = $strike_timeslot->start->set_time_zone($tz);
				my $strike_timeslot_end = $strike_timeslot->end->set_time_zone($tz);

</%perl>
	
				 <tr class="row">

					<th>
						<input 
							type  = "text"
							name  = "<% $strike_timeslot->id %>_name"
							value = "<% $strike_timeslot->name %>"
							size  = "16"
						>
					</th>

%					unless ($rounds_per) { 
						<td>
							<input 
								type  = "number"
								class = "smaller"
								min   = "0"
								max   = "99999"
								name  = "<% $strike_timeslot->id %>_fine"
								value = "<% $strike_timeslot->fine %>"
								size  = "4"
							>
						</td>
%					}

					<td>

						<label for="<% $strike_timeslot->id %>_no_hires">
							<div class="full marno hover padless centeralign">
								<input 
									type  = "checkbox"
									class = "smaller"
									value = "1"
									name  = "<% $strike_timeslot->id %>_no_hires"
									id    = "<% $strike_timeslot->id %>_no_hires"
								>
							</div>
						</span>
					</td>


%					if (scalar @days > 1 ) { 
				
						<td class="smaller nospace">

%							foreach my $day (@days) { 

								<label for="<% $strike_timeslot->id."-".$day->epoch %>">
									<span class="hover marno nowrap padless">

										<input 
											type  = "radio"
											id    = "<% $strike_timeslot->id."-".$day->epoch %>"
											name  = "<% $strike_timeslot->id %>_day"
											value = "<% Tab::pickerdate($day) %>"
											<% ($strike_timeslot_start->day == $day->day) ? "checked" : "" %>
										>
											<% $day->day_abbr %> 
											<% Lingua::EN::Numbers::Ordinate::ordinate($day->day) %>
									</span>
								</label>

%							}

						</td>

%					} else { 

						<input 
							type  = "hidden"
							name  = "<% $strike_timeslot->id %>_day"
							value = "<% Tab::pickerdate($tourn->start->set_time_zone($tz)) %>"
						>
%					}

					</td>

					<td class="centeralign">
						<& "/funclib/timepicker.mas", 
							name => $strike_timeslot->id."_start",
							time => $strike_timeslot_start,
							size => "6"
						&>
					</td>

					<td class="centeralign">
						<& 
							"/funclib/timepicker.mas", 
							name => $strike_timeslot->id."_end", 
							time => $strike_timeslot_end, 
							size => "6"
						&> 
					</td> 

					<td class="centeralign padless">
						<a 
							class = "buttonwhite redtext hover marno fa fa-lg fa-trash"
							href  = "partial_rm.mhtml?partial_id=<% $strike_timeslot->id %>"
						>
						</a>
					</td>

				</tr>
% 			}

			<tr class="row">

				<td>
					<input 
						type        = "text"
						name        = "new_name"
						size        = "16"
						placeholder = "Add new..."
					>
				</td>

%				unless ($rounds_per) { 
					<td>
						<input 
							type  = "number"
							class = "smaller"
							min   = "0"
							max   = "99999"
							name  = "new_fine"
							size  = "4"
						>
					</td>
% 				}

				<td>
					<label for="new_no_hires">
						<div class="full marno hover padless centeralign">
							<input 
								type  = "checkbox"
								class = "smaller"
								value = "1"
								name  = "new_no_hires"
								id    = "new_no_hires"
							>
						</div>
					</label>
				</td>

%				if (scalar @days > 1) { 

					<td class="smaller nospace">
%						foreach my $day (@days) { 

							<label for="<% $day->epoch %>">

								<span class="hover marno nowrap padless">

									<input 
										type  = "radio"
										id    = "<% $day->epoch %>"
										name  = "new_day"
										value = "<% Tab::pickerdate($day) %>"
									>
										<% $day->day_abbr %>
										<% Lingua::EN::Numbers::Ordinate::ordinate($day->day) %>
								</span>
							</label>
%						}

					</td>
%				} else { 

					<input 
						type  = "hidden"
						name  = "new_day"
						value = "<% Tab::pickerdate($tourn->start->set_time_zone($tz)) %>"
					>
%				}

				<td class="centeralign">
					<& /funclib/timepicker.mas, name => "new_start", size => "6" &> 
				</td>

				<td class="centeralign">
					<& /funclib/timepicker.mas, name => "new_end", size => "6" &> 
				</td>

				<td>
				</td>

			</tr>


			<tr class="libl">

				<td colspan="8" align="right">
					<input type="submit" value=" Save Timeblocks"> 
					</form>
				</td>

			</tr>

		</table>

		<h5>A piece of advice</h5>

		<p>
			There are a lot of people who will mistake these on registration
			for "times the judge IS available" rather than the times the judge
			is NOT available, despite many warnings to the contrary.
		</p>
		
		<p>
			You'll end up with some schools registering judges who are blocked
			against all time blocks.  It's silly, but it happens.
		</p>

		<p>
			To help prevent that, I've found its best to name the time blocks things
			like "No Sunday Rounds" or "No Saturday Morning".  Putting the "No"
			in there seems to help.
		</p>

		<p>
			People.  Sheesh.
		</p>

	</div>

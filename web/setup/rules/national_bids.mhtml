<%args>
	$tourn
	$tourn_settings
	$person
</%args>
<%init>

	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;

	my @events = $tourn->events;

</%init>

<div class="main">

	<h2>Bids</h2>

	<& tabbar.mas, 
		tourn  => $tourn,
		whoami => "tocbids"
	&>

	<script>

		function showTops() { 
			$(".bidlevels").each(function() { 
				var eventID = $(this).attr("id");

				var selectedType = $(this).find(":selected").attr("round_type");

				if (selectedType === "final") { 
					$("#limit_"+eventID).removeClass('hidden');
				}
			});
		}

		$(document).ready(function() { 
			showTops();
		});

	</script>

	<h4>NDCA Points</h4>

	<p>
		To auto-report points for NDCA qualification and the season-long Baker
		(policy) and Dukes &amp; Bailey (LD) awards, select which of your
		divisions are varsity Policy and varsity LD.  Any US high school
		tournament can award NDCA points.
	</p>

	<form action="national_bids_save.mhtml" method="post">

		<div class="full padless lightrow">

			<span class="twofifth">
				Varsity/Open Policy (Baker Award)
			</span>

			<span class="threefifth smaller rightalign"> 

				<select name="baker" class="fixed">

					<option value="">Not Offered</option>
%					foreach my $event (@events) { 
						<option 
							value="<% $event->id %>" 
							<% $event->setting("baker") ? 'selected="selected"' : "" %>
						><% $event->name %></option>
%					}
				</select>
			</span>

		</div>

		<div class=" full padless lightrow">

			<span class="twofifth">
				Varsity/Open LD (Dukes &amp; Bailey Award)
			</span>

			<span class="threefifth smaller rightalign"> 

				<select 
					name  = "dukesandbailey"
					class = "fixed"
				>

					<option value="">Not Offered</option>

%					foreach my $event (@events) { 
						<option 
							value="<% $event->id %>" 
							<% $event->setting("dukesandbailey") ? 'selected="selected"' : "" %>
						><% $event->name %></option>
%					}
				</select>
			</span>

		</div>

		<div class="full padless lightrow">

			<span class="twofifth">
				Varsity/Open Public Forum
			</span>

			<span class="threefifth smaller rightalign"> 

				<select name="ndca_public_forum" class="fixed">

					<option value="">Not Offered</option>

%					foreach my $event (@events) { 
						<option 
							value="<% $event->id %>" 
							<% $event->setting("ndca_public_forum") ? 'selected="selected"' : "" %>
						><% $event->name %></option>
%					}

				</select>
			</span>

		</div>

	<h4 class="martopmore">Tournament of Champions Bid Reporting</h4>

	<p>
		To auto-report bids to the Tournament of Champions, select the bid
		level of the qualifying divisions:
	</p>

%	foreach my $event (@events) { 

		<div class=" full padless lightrow">

			<span class="tenth">
				<% $event->abbr %>
			</span>
			<span class="sixth">
				<% scalar ($event->entries( waitlist => 0, unconfirmed => 0)) %> entries
			</span>

			<label for="<% $event->id %>_silver">
				<span 
					class="fifth hover"
					title="Report Public Forum Silver bids as well"
				>
					<input 
						type = "checkbox"
						name = "<% $event->id %>_silver"
						id   = "<% $event->id %>_silver"
						<% $event->setting("pf_silver_bids") ? "checked='true'" : "" %>
					>
					PF Silver Bids
				</span> 
			</label>

			<span class="threetenths smaller centeralign"> 
				
				<select 
					name        = "<% $event->id %>"
					id          = "<% $event->id %>"
					class       = "fixedmed bidlevels"
					placeholder = "Select round of bid level"
					onChange    = "showTops();"
				>

					<option value="">
						No bid
					</option>

%					my $bid_round = $event->setting("bid_round");
%					 foreach my $round ($event->rounds) {
%					 	if ($round->type eq "final" || $round->type eq "elim") {
							<option 
								round_type = "<% $round->type %>"
								value      = "<% $round->id %>"
								<% $round->id == $bid_round ? "selected" : "" %>
							>
								<% $round->realname %>
							</option>
%					 	}
%					}
				</select>
			</span>

			<span class="fifth smaller centeralign nospace">
				<span id="limit_<% $event->id %>" class="nospace hidden full">
					Top
					<input 
						type  = "number"
						name  = "<% $event->id %>_limit"
						value = "<% $event->setting("bid_limit") %>"
						min   = 0
						max   = 99
					>
				</span>
			</span>

		</div>
%	}

	<div class="libl full rightalign marvertno">
		<input 
			type  = "submit"
			value = "Save Settings"
			class = "marrightmore"
		>
		</form>
	</div>

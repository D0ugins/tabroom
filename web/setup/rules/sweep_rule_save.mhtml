<%args>
	$person
	$set_id
	$tourn
	$tag 
	$points          => undef
	$place           => 0
	$count           => "all"
	$tiebreak_set_id => undef
</%args>
<%init>

	if ($points 
		|| $tag eq "manual" 
		|| $tag eq "nsda_place" 
		|| $tag eq "nsda_rounds"
	) { 

		Tab::SweepRule->create({
			tag          => $tag,
			value        => $points,
			sweep_set    => $set_id,
			place        => $place,
			count        => $count,
			tiebreak_set => $tiebreak_set_id
		});

		my $msg = "Sweepstakes rule $set_id created for $tag in $count rounds, place $place points $points";

		my $now = DateTime->now();

		Tab::ChangeLog->create({ 
			type        => 'tabbing',
			tourn       => $tourn->id,
			person      => $person->id,
			description => $msg,
			created     => $now
		});

		$m->redirect("sweeps.mhtml?set_id=$set_id&msg=$msg")

	} else {

		my $err = "You cannot create a sweepstakes rule without points";
		$m->redirect("sweeps.mhtml?set_id=$set_id&err=$err")

	}

</%init>

<%args>
	$tourn
	$person
	$rule_id
</%args>
<%init>

	my $rule = Tab::SweepRule->retrieve($rule_id);

	my $msg;

	my $set_id = $rule->sweep_set->id if $rule;

	use Data::Dumper;

	if ($rule) { 

		$msg = "Sweepstakes rule $set_id deleted: ";

		foreach my $field ("tag", "value", "place", "count") { 
			$msg .= $field.": ".$rule->$field." ";
		}

		my $now = DateTime->now();

		Tab::ChangeLog->create({ 
			type        => 'tabbing',
			tourn       => $tourn->id,
			person      => $person->id,
			description => $msg,
			created     => $now
		});

		$rule->delete();
		$msg = "Sweeps rule removed.";
	}

	$m->redirect("sweeps.mhtml?set_id=$set_id&msg=$msg");

</%init>


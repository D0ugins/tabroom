<%args>
	$tourn
	$tourn_settings
	$set_id => undef
</%args>
<%init>

	my (%cume_settings) = $m->comp(
		"/funclib/tourn_cume_sweeps.mas", 
		tourn => $tourn
	);

	my (%place_settings) = $m->comp(
		"/funclib/tourn_place_sweeps.mas", 
		tourn => $tourn
	);

    my $numero = keys %cume_settings;

</%init>

	<div class="main">

		<h2>Team Awards / Sweepstakes</h2>

		<& 
			"tabbar.mas", 
			tourn  => $tourn,
			whoami => "sweeps" 
		&>


<%perl>
		if ($set_id) { 

			my $set = Tab::SweepSet->retrieve($set_id);
			my @all_events = $set->events;
			my @events;

			foreach my $event (@all_events) { 

				if ($event && $event->tourn && $event->tourn->id == $tourn->id ) { 

					push @events, $event;

				} elsif ($event) { 

					foreach (Tab::SweepEvent->search( 
						event => $event, 
						sweep_set => $set_id)
					) { 
						$_->delete;
					}

				}
			}
</%perl>

			<span class="row full nospace">

				<form 
					action="sweep_set_save.mhtml" 
					method="post"
				>

				<span class="third">
					Name of ruleset:
				</span>

				<span class="third">
					<input 
						type  = "text"
						name  = "name"
						value = "<% $set->name %>"
						size  = "25"
					>
				</span>

				<span class="sixth">
					<input 
						type  = "hidden"
						name  = "set_id"
						value = "<% $set->id %>"
					>
					<input 
						type  = "submit"
						class = "thin"
						value = "Save"
					>
				</span>

				<span class="sixth rightalign">
					<a 
						class="redtext fa fa-trash fa-lg buttonwhite hover" 
						<& 
							"/funclib/confirm.mas", 
							warn => "Deleting this set. Are you sure?" 
						&> 
						href="sweep_set_delete.mhtml?set_id=<% $set_id %>"
					></a>
				</span>

				</form>

			</span>

			<span class="third nospace">

				<h5>Limits</h5>

					<form action="sweep_limits.mhtml" method="post">

					<input 
						type  = "hidden"
						name  = "set_id"
						value = "<% $set->id %>"
					>

					<span class="nospace full row">

						<span class="twothird smallish padleft">
							Entries counted across all events
						</span>

						<span class="third">
							<input 
								type  = "number"
								min   = "0"
								max   = "999"
								size  = "4"
								name  = "entries"
								value = "<% $set->rule("entries") %>"
								class = "thin smaller"
							>
						</span>

					</span>

					<span class="nospace full row  ">

						<span class="twothird smallish padleft">
							Entries counted per event
						</span>

						<span class="third">
							<input 
								type  = "number"
								min   = "0"
								max   = "999"
								class = "thin smaller"
								size  = "4"
								name  = "event_entries"
								value = "<% $set->rule("event_entries") %>"
							>
						</span>

					</span>

					<span class="nospace full row  ">

						<span class="twothird smallish padleft">
							Events to count
						</span>

						<span class="third padleft">
							<input 
								type  = "number"
								min   = "0"
								max   = "999"
								size  = "4"
								class = "smaller thin smaller"
								name  = "events"
								value = "<% $set->rule("events") %>"
							>
						</span>

					</span>

					<span class="nospace full row">

						<span class="twothird smallish padleft">
							Wildcards (entries counted beyond limits)
						</span>

						<span class="third">
							<input 
								type  = "number"
								min   = "0"
								max   = "999"
								class = "thin smaller"
								size  = "4"
								name  = "wildcards"
								value = "<% $set->rule("wildcards") %>" 
							>
						</span>

					</span>

					<span class="nospace full row">

						<span class="twothird smallish padleft">
							Number of schools to print on reports
						</span>

						<span class="third">
							<input 
								type  = "number"
								min   = "0"
								max   = "999"
								class = "thin smaller"
								size  = "4"
								name  = "print_limit"
								value = "<% $set->rule("print_limit") %>"
							>
						</span>

					</span>

					<label for="novice_only">
						<span class="nospace full row hover">

							<span class="twothird smallish padleft marno">
								Novices only
							</span>

							<span class="third padless marno centeralign">
								<input 
									type  = "checkbox"
									id    = "novice_only"
									class = "largecheck"
									name  = "novice_only"
									value = "1"
									<% $set->rule("novice_only") ? 'checked="checked"' : "" %>
								>
							</span>

						</span>
					</label>

					<label for="one_per_person">
						<span 
							class="nospace full row hover"
							title="Count only 1 entry per competitor"
						>

							<span class="twothird smallish padleft marno">
								Count 1 per person
							</span>

							<span class="third padless marno centeralign">
								<input 
									type  = "checkbox"
									id    = "one_per_person"
									class = "largecheck"
									name  = "one_per_person"
									value = "1"
									<% $set->rule("one_per_person") ? 'checked="checked"' : "" %>
								>
							</span>

						</span>
					</label>

					<div class="libl rightalign full marno padless smaller">
						<input 
							type  = "submit"
							value = "Save Limits"
						>
						</form>
					</div>

			</span>

			<span class="third top nospace marleftmore">

				<h5>Events in ruleset</h5>

<%perl>
				my %used = ();

				foreach my $event (sort {$a->name cmp $b->name} @events) { 

					next unless $event && $event->id;
					next unless $event->tourn->id == $tourn->id;
					$used{$event->id} = $event;
</%perl>

					<span class="nospace row full smallish padleft">

						<span class="threequarter padleft marno">
							<% $event->name %>
						</span>

						<span class="quarter centeralign marno">
							<a 
								class="redtext fa-sm fa fa-trash fa-lg hover buttonwhite" 
								href="sweep_event_rm.mhtml?event_id=<% $event->id %>&set_id=<% $set->id %>">
							</a>
						</span>
					</span>
%				}

				<span class="libl full nospace smallish">

					<form 
						action = "sweep_event_add.mhtml"
						method = "post"
					>
					<input 
						type  = "hidden"
						name  = "set_id"
						value = "<% $set->id %>"
					>

					<span class="sixth centeralign">
						Add:
					</span>

					<span class="fivesixth">

						<select 
							name     = "event_id"
							onchange = 'this.form.submit()'
							class    = "fixedsmall"
						>

							<option value="">Select to add</option>

							<option value="all">All events</option>
<%perl>							 
								foreach my $event ( 
									$m->comp(
										"/funclib/tourn_events.mas", 
										tourn => $tourn)
								) { 

									next if $used{$event->id};
</%perl>							 

									<option 
										value="<% $event->id %>"
									><% $event->name %></option>
%								}

						</select>

						<noscript>

							<input 
								type    = "hidden"
								name    = "set_id"
								value   = "<% $set->id %>"
							>

							<input 
								type  = "submit"
								class = "thin"
								value = "Save"
							>
						</noscript>

					</span>
					</form>

				</span>
				
			</span>

			<span class="third top nospace marleftmore">

				<h5>Rulesets included</h5>

%				my %already_child;

%				foreach my $child ($set->children) { 

%					$already_child{$child->id}++;

					<span class="nospace row full smallish padleft">

						<span class="threequarter padleft marno">
							<% $child->name %>
						</span>

						<span class="quarter centeralign marno padless">
							<a 
								class="redtext fa fa-sm fa-trash fa-lg hover buttonwhite" 
								href="sweep_child_rm.mhtml?set_id=<% $set->id %>&child_id=<% $child->id %>"
							>
							</a>
						</span>
					</span>
%				}

				<span class="libl full nospace smallish">

					<form action="sweep_child_add.mhtml" method="post">

					<input 
						type  = "hidden"
						name  = "set_id"
						value = "<% $set->id %>"
					>

					<span class="sixth rightalign">
						Add:
					</span>

					<span class="fivesixth">

						<select 
							name     = "child_id"
							onchange = 'this.form.submit()'
							class    = "fixedsmall"
						>
							<option value="">Select to add:</option>

<%perl>
								SET:
								foreach my $other_set ($tourn->sweep_sets) { 

									next if $set->id == $other_set->id;
									next if $already_child{$other_set->id}++;

									my @children = $other_set->children;
									my %done;

									# Recursively check to make sure the child or
									# any of its children aren't me, to avoid
									# infinite loops.  Recursion!  See, I didn't
									# entirely sleep through CS50.

									while (@children) { 
										my $test = shift @children;
										next SET if $test->id == $set->id;
										foreach my $subchild ($test->children) { 
											push @children, $subchild unless $done{$subchild->id};
										}
										$done{$test->id}++;
									}

</%perl>
										<option value="<% $other_set->id %>">
											<% $other_set->name %>
										</option>
%							}
						</select>

						<noscript>
							<input 
								type  = "hidden"
								name  = "set_id"
								value = "<% $set->id %>"
							>
							<input 
								type  = "submit"
								class = "thin"
								value = "Save"
							>
						</noscript>

					</span>
					</form>

				</span>

%				my %round_used = ();

				<h5 class="martop">Rounds excluded</h5>

<%perl>

				foreach my $rule (
					sort {$a->tag cmp $b->tag} 
					$set->rules( tag => "ignore_round" )
				) { 

					my $round = Tab::Round->retrieve($rule->value);
					next unless $round;
					$round_used{$round->id}++;
</%perl>

					<span class="row full smallish nospace">

						<span class="threequarter">
							<% $round->event->abbr %> <% $round->realname %>
						</span>

						<span class="quarter centeralign marno padless">
							<a 
								class = "redtext buttonwhite fa fa-trash fa-sm" 
								href  = "sweep_round_rm.mhtml?round_id=<% $round->id %>&set_id=<% $set->id %>"
							>
							</a>
						</span>
					</span>
%				}

				<span class="libl full nospace smallish">

					<form action="sweep_round_add.mhtml" method="post">

					<input 
						type  = "hidden"
						name  = "set_id"
						value = "<% $set->id %>"
					>

					<span class="sixth centeralign">
						Add:
					</span>

					<span class="fivesixth">

						<select 
							name     = "round_id"
							onchange = 'this.form.submit()'
							class    = "fixedsmall"
						>

							<option value="">Select to add:</option>

%							foreach my $event_id (sort keys %used) { 

%								my $event = $used{$event_id};

								<optgroup label="<% $event->name %>">

%								foreach my $round ($event->rounds) {
%									next if $round_used{$round->id};
									<option value="<% $round->id %>">
										<% $round->realname %>
									</option>
%								}
%							}
						</select>

						<noscript>
							<input 	
								type  = "hidden"
								name  = "set_id"
								value = "<% $set->id %>"
							>

							<input 
								type  = "submit"
								class = "thin"
								value = "Save"
							>
						</noscript>
					</span>
					</form>

				</span>
				

			</span>

%			if ($set->rules) { 
				<h4>Rules in set</h4>
%			}

%			my $counter = 1;

			<table>
<%perl>

				foreach my $rule (sort {$a->id <=> $b->id}  $set->rules) { 

					my $tag = $rule->tag;

					next if $tag eq "novice_only";
					next if $tag eq "one_per_person";
					next if $tag eq "events";
					next if $tag eq "entries";
					next if $tag eq "event_entries";
					next if $tag eq "wildcards";
					next if $tag eq "print_limit";
					next if $tag eq "ignore_round";
					my $index = index($tag, 'rev_');

					my $count = $rule->count;

</%perl>
					<tr class="row">

						<td>
							<% $counter++ %>.
						</td>

						<td class="smallish">
%							if ($rule->value && $index != 0 ) { 
								<% $rule->value %> point<% $rule->value == 1 ? "" : "s" %> for
%							}
						</td>

						<td class="smallish">

							<% $tag eq "points_per" 
								? "Appearance " 
								: ""
							%>

							<% $tag eq "points_per_po_round" 
								? "Elected PO " 
								: ""
							%>

							<% $tag eq "rev_per_rank" 
								? "6 minus each rank in" 
								: "" 
							%>

							<% $tag eq "rev_composite" 
								? "6 minus each composite rank from ".$rule->tiebreak_set->name 
								: "" 
							%>

							<% $tag eq "rev_per_rank_sansworst" 
								? "6 minus each rank, dropping the worst" 
								: ""
							%>

							<% $tag eq "points_per_rank" 
								? Lingua::EN::Numbers::Ordinate::ordinate($rule->place)." rank in prelim" 
								: "" 
							%>

							<% $tag eq "rev_per_place" 
								? "6 minus placement in " 
								: "" 
							%>

							<% $tag eq "rev_per_round_place" 
								? "6 minus round placement in " 
								: "" 
							%>

							<% $tag eq "rev_per_overall_place" 
								? "6 minus placement overall" 
								: ""
							%>

							<% $tag eq "debate_win" 
								? "Ballot won (debate)" 
								: "" 
							%>

							<% $tag eq "debate_loss" 
								? "Ballot lost (debate)" 
								: ""
							%>

							<% $tag eq "debate_round_win" 
								? "Debate round won" 
								: "" 
							%>

							<% $tag eq "debate_round_loss" 
								? "Debate round lost" 
								: "" 
							%>

							<% $tag eq "debate_round_bye" 
								? "Debate round bye" 
								: ""
							%>

							<% $tag eq "place" 
								? Lingua::EN::Numbers::Ordinate::ordinate($rule->place)." place overall" 
								: ""
							%>
							<% $tag eq "place_above" 
								? Lingua::EN::Numbers::Ordinate::ordinate($rule->place)." place or better overall" 
								: ""
							%>

							<% $tag eq "cume" 
								? "Prelim cumulative ranks of ".$rule->place 
								: "" 
							%>

							<% $tag eq "prelim_seed" 
								? "Prelim seed better than ".$rule->place 
								: "" 
							%>

							<% $tag eq "percentage" 
								? "Placement in the top ".$rule->place."% based on ".$rule->tiebreak_set->name
								: "" 
							%>

							<% $tag eq "manual" 
								? "Count manually-entered sweeps points (under Tabulation)" 
								: ""
							%>

							<% $tag eq "nsda_place" 
								? "NSDA District Placement Points" 
								: "" 
							%>

							<% $count ? "in $count rounds" : "" %>

						</td>

						<td class="centeralign padless marno">
							<a 
								class = "redtext fa fa-trash fa-lg hover buttonwhite"
								href  = "sweep_rule_rm.mhtml?rule_id=<% $rule->id %>">
							</a>
						</td>

					</tr>
%				}

			</table>

			<h4>
				Add new rule:
			</h4>

%			if ($tourn_settings->{"nsda_district"}) { 

				<form action="sweep_rule_save.mhtml">

				<input 
					type    = "hidden"
					name    = "set_id"
					value   = "<% $set->id %>"
				>

				<input 
					type  = "hidden"
					name  = "tag"
					value = "nsda_place"
				>

				<div class="lightrow">

					<span class="half">
						NSDA Placement Points
					</span>

					<span class="half rightalign">
						<input 
							type="submit" 
							class="thin" 
						>
					</span>

				</div>
				</form>

%			} 
				
			<table>

				<tr class="row">

					<td class="smallish">
						<form action="sweep_rule_save.mhtml">
						<input 
							type  = "hidden"
							name  = "set_id"
							value = "<% $set->id %>"
						>

						<input 
							type  = "hidden"
							name  = "tag"
							value = "points_per"
						>

						Points Per Round Participated In

					</td>

					<td class="smallish">

						<span class="quarter">
							In:
						</span>

						<span class="twothird">

							<select name="count" 
								class="fixedsmall plain"
							>
								<option value="all">All</option>
								<option value="prelim">Prelims</option>
								<option value="elim">Elims</option>
								<option value="final">Finals</option>
							</select>

						</span>

					</td>

					<td class="smallish">

						Points: 
						
						<input 
							type = "number"
							name = "points"
							size = "5"
							min  = "1"
							max  = "999"
							size = "5"
						>

					</td>

					<td class="centeralign">
						<input 
							type  = "submit"
							class = "thin"
							value = "Add"
						>
						</form>
					</td>

				</tr>

%				unless ($tourn_settings->{"nsda_district"}) { 
	
					<tr class="row">

						<td class="smallish">
							<form action="sweep_rule_save.mhtml">
							<input 
								type="hidden" 
								name="set_id" 
								value="<% $set->id %>"
							>

							<input 
								type="hidden" 
								name="points" 
								value="1"
							>
							Count reverse points (6-rank) for

						</td>

						<td class="centeralign">
							<select name="tag" class="fixedmed">

								<option value="rev_per_rank">Each Rank</option>
								<option value="rev_per_rank_sansworst">Each Rank, drop worst</option>
								<option value="rev_per_round_place">Placement in Rounds</option>
								<option value="rev_per_overall_place">Placement Overall</option>

							</select>
						</td>

						<td class="smallish">

							<span class="third">
								Count
							</span>

							<span class="twothirds">
								<select name="count" class="fixedtiny plain">
									<option value="all">All</option>
									<option value="prelim">Prelim</option>
									<option value="elim">Elim</option>
									<option value="final">Final</option>
								</select>
							</span>

						</td>

						<td class="centeralign">
							<input 
								type  = "submit"
								class = "thin"
								value = "Add"
							>
							</form>
						</td>

					</tr>

					<tr class="row">

						<td class="smallish">

							<form action="sweep_rule_save.mhtml">

							<input 
								type  = "hidden"
								name  = "set_id"
								value = "<% $set->id %>"
							>

							<input 
								type  = "hidden"
								name  = "points"
								value = "1"
							>

							<input 
								type  = "hidden"
								name  = "tag"
								value = "rev_composite"
							>
							Count reverse composite ranks
						</td>

						<td class="centeralign smallish nospace">

							<span class="quarter">
								Basis:
							</span>
							
							<span class="threequarters">
								<select
									name="tiebreak_set_id"
									class="fixedsmall"
								>
%									foreach my $tb_set ($tourn->tiebreak_sets) { 
										<option 
											value="<% $tb_set->id %>"
										><% $tb_set->name %></option>
%									}
								</select>
							</span>

						</td>

						<td class="smallish">

							<span class="third">
								Count
							</span>

							<span class="twothirds">

								<select 
									name  = "count"
									class = "fixedtiny plain"
								>
									<option value = "all">All</option>
									<option value = "prelim">Prelims</option>
									<option value = "elim">Elims</option>
									<option value = "final">Final</option>
								</select>

							</span>

						</td>

						<td class="centeralign">
							<input 
								type  = "submit"
								class = "thin"
								value = "Add"
							>
							</form>
						</td>

					</tr>

					<tr class="row">

						<td class="smallish">

							Give points for individual rank

							<form action="sweep_rule_save.mhtml">

							<input 
								type  = "hidden"
								name  = "set_id"
								value = "<% $set->id %>"
							>

							<input 
								type  = "hidden"
								name  = "tag"
								value = "points_per_rank"
							>

						</td>

						<td class="smallish nospace">
							<span class="half nospace">

								<span class="third rightalign marno">
									Rank:
								</span>

								<span class="twothirds marno">
									<input 
										type = "number"
										name = "place"
										max  = "999"
										min  = "1"
										size = "5"
									>
								</span>
							</span>

							<span class="half nospace">

								<span class="quarter">
									In:
								</span>

								<span class="threequarters centeralign">
									<select name="count" class="fixedtiny plain">
										<option value="all">All</option>
										<option value="prelim">Prelims</option>
										<option value="elim">Elims</option>
										<option value="final">Finals</option>
									</select>
								</span>
							</span>
						</td>

						<td class="smallish">
							Points:
							<input 
								type = "number"
								name = "points"
								max  = "999"
								min  = "0"
								size = "5"
								step = ".1"
							>
						</td>

						<td class="centeralign">
							<input 
								type="submit" 
								class="thin" 
								value="Add">
							</form>
						</td>

					</tr>

					<tr class="row">

						<td class="smallish">

							Give points for composite rank

							<form action="sweep_rule_save.mhtml">

							<input 
								type  = "hidden"
								name  = "set_id"
								value = "<% $set->id %>"
							>

							<input 
								type  = "hidden"
								name  = "tag"
								value = "points_per_composite_rank"
							>
						</td>

						<td class="smallish nospace">

							<span class="half nospace">

								<span class="third rightalign marno">
									Rank:
								</span>

								<span class="twothirds marno">
									<input 
										type  = "number"
										class = "thinner"
										name  = "place"
										min   = "1"
										max   = "99"
										step  = "1"
										size  = "3"
									>
								</span>
							</span>

							<span class="half">

								<span class="third">
									Basis
								</span>

								<span class="twothird">

									<select 
										name  = "tiebreak_set_id"
										class = "fixedtiny plain"
									>
%										foreach my $tb_set ($tourn->tiebreak_sets) { 
											<option 
												value="<% $tb_set->id %>"
											><% $tb_set->name %></option>
%										}
									</select>
								</span>
							</span>
						</td>

						<td class="smallish">
							Points:
							<input 
								type = "number"
								name = "points"
								max  = "999"
								min  = "0"
								size = "5"
								step = ".1"
							>
						</td>

						<td class="centeralign">
							<input 
								type="submit" 
								class="thin" 
								value="Add">
							</form>
						</td>

					</tr>

					<tr class="row">

						<td class="smallish">
							Give points for each debate ballot won
							<form action="sweep_rule_save.mhtml">
							<input type="hidden" name="set_id" value="<% $set->id %>">
							<input type="hidden" name="tag" value="debate_win">
						</td>

						<td class="smallish">
							<span class="quarter">
								In:
							</span>
							<span class="twothird">
								<select name="count" class="fixedsmall">
									<option value="all">All</option>
									<option value="prelim">Prelims</option>
									<option value="elim">Elims</option>
									<option value="final">Finals</option>
								</select>
							</span>
						</td>

						<td class="smallish">
							Points:
							<input 
								type = "number"
								name = "points"
								max  = "999"
								min  = "1"
								size = "5"
							>
						</td>

						<td class="centeralign">
							<input 
								type  = "submit"
								class = "thin"
								value = "Add"
							>
							</form>
						</td>

					</tr>

					<tr class="row">

						<td class="smallish">
							Give points for each debate ballot lost
							<form action="sweep_rule_save.mhtml">

							<input 
								type  = "hidden"
								name  = "set_id"
								value = "<% $set->id %>"
							>
							<input 
								type  = "hidden"
								name  = "tag"
								value = "debate_loss"
							>
						</td>

						<td class="smallish">

							<span class="quarter">
								In:
							</span>

							<span class="twothird">
								<select name="count" class="fixedsmall">
									<option value="all">All</option>
									<option value="prelim">Prelims</option>
									<option value="elim">Elims</option>
									<option value="final">Finals</option>
								</select>
							</span>

						</td>

						<td class="smallish">
							Points:
							<input 
								type = "number"
								name = "points"
								max  = "999"
								min  = "1"
								size = "5"
							>
						</td>

						<td class="centeralign">
							<input 
								type  = "submit"
								class = "thin"
								value = "Add"
							>
							</form>
						</td>

					</tr>

					<tr class="row">

						<td class="smallish">
							Give points for each debate round won

							<form action="sweep_rule_save.mhtml">

							<input 
								type  = "hidden"
								name  = "set_id"
								value = "<% $set->id %>">

							<input 
								type  = "hidden"
								name  = "tag"
								value = "debate_round_win"
							>

						</td>

						<td class="smallish">

							<span class="quarter">
								In:
							</span>

							<span class="twothird">
								<select name="count" class="fixedsmall">
									<option value="all">All</option>
									<option value="prelim">Prelims</option>
									<option value="elim">Elims</option>
									<option value="final">Finals</option>
								</select>
							</span>
						</td>

						<td class="smallish">
							Points:
							<input 
								type = "number"
								name = "points"
								max  = "999"
								min  = "1"
								size = "5"
							>
						</td>

						<td class="centeralign">
							<input type="submit" class="thin" value="Add">
							</form>
						</td>

					</tr>

					<tr class="row">

						<td class="smallish">
							Give points for each debate round loss

							<form action="sweep_rule_save.mhtml">

							<input 
								type  = "hidden"
								name  = "set_id"
								value = "<% $set->id %>"
							>

							<input 
								type  = "hidden"
								name  = "tag"
								value = "debate_round_loss"
							>

						</td>

						<td class="smallish">
							<span class="quarter">
								In:
							</span>
							<span class="twothird">
								<select name="count" class="fixedsmall">
									<option value="all">All</option>
									<option value="prelim">Prelims</option>
									<option value="elim">Elims</option>
									<option value="final">Finals</option>
								</select>
							</span>
						</td>

						<td class="smallish">
							Points:
							<input 
								type = "number"
								name = "points"
								max  = "999"
								min  = "1"
								size = "5"
							>
						</td>

						<td class="centeralign">
							<input 
								type  = "submit"
								class = "thin"
								value = "Add"
							>
							</form>
						</td>

					</tr>

					<tr class="row">

						<td class="smallish">
							Give points for each debate round bye

							<form action="sweep_rule_save.mhtml">

							<input 
								type  = "hidden"
								name  = "set_id"
								value = "<% $set->id %>"
							>

							<input 
								type  = "hidden"
								name  = "tag"
								value = "debate_round_bye"
							>

						</td>

						<td>
							<span class="quarter">
								In:
							</span>
							<span class="twothird">
								<select name="count" class="fixedsmall">
									<option value="all">All</option>
									<option value="prelim">Prelims</option>
									<option value="elim">Elims</option>
									<option value="final">Finals</option>
								</select>
							</span>
						</td>

						<td class="smallish">
							Points:
							<input 
								type = "number"
								name = "points"
								max  = "999"
								min  = "1"
								size = "5"
							>
						</td>

						<td class="centeralign">
							<input 
								type  = "submit"
								class = "thin"
								value = "Add"
							>
							</form>
						</td>

					</tr>

					<tr class="row">

						<td class="smallish">
							Give points for prelim cumulative score
							<form action="sweep_rule_save.mhtml">

							<input 
								type  = "hidden"
								name  = "set_id"
								value = "<% $set->id %>"
							>

							<input 
								type  = "hidden"
								name  = "tag"
								value = "cume"
							>

						</td>

						<td class="smallish">
							<span class="quarter">
								Score:
							</span>
							<span class="twothird">

							<input 
								type = "number"
								name = "place"
								max  = "999"
								min  = "1"
								size = "5"
							>
						</td>

						<td class="smallish">
							<span class="quarter">
								Points:
							</span>
							<span class="twothird">
							<input 
								type = "number"
								name = "points"
								max  = "999"
								min  = "1"
								size = "5"
							>
						</td>

						<td class="centeralign">
							<input 
								type  = "submit"
								class = "thin"
								value = "Add"
							>
							</form>
						</td>

					</tr>

					<tr class="row">

						<td class="smallish">

							Points for prelim seed rank equal or better than:

							<form action="sweep_rule_save.mhtml">

							<input 
								type  = "hidden"
								name  = "set_id"
								value = "<% $set->id %>"
							>

							<input 
								type  = "hidden"
								name  = "tag"
								value = "prelim_seed"
							>

						</td>

						<td class="smallish">

							<span class="quarter">
								Seed:
							</span>

							<span class="twothird">

							<input 
								type = "number"
								name = "place"
								max  = "999"
								min  = "1"
								size = "5"
							>
						</td>

						<td class="smallish">

							<span class="quarter">
								Points:
							</span>

							<span class="twothird">
							<input 
								type = "number"
								name = "points"
								max  = "999"
								min  = "1"
								size = "5"
							>
						</td>

						<td class="centeralign">
							<input 
								type  = "submit"
								class = "thin"
								value = "Add"
							>
							</form>
						</td>

					</tr>

					<tr class="row">

						<td class="smallish">
							Give points for final overall placement
							<form action="sweep_rule_save.mhtml">

							<input 
								type  = "hidden"
								name  = "set_id"
								value = "<% $set->id %>"
							>

							<input 
								type  = "hidden"
								name  = "tag"
								value = "place"
							>

						</td>

						<td class="smallish">
							<span class="quarter">
								Place:
							</span>
							<span class="twothird">
							<input 
								type = "number"
								name = "place"
								max  = "999"
								min  = "1"
								size = "5"
							>
						</td>

						<td class="smallish">
							<span class="quarter">
								Points:
							</span>
							<span class="twothird">
							<input 
								type = "number"
								name = "points"
								max  = "999"
								min  = "1"
								size = "5"
							>
						</td>

						<td class="centeralign">
							<input 
								type  = "submit"
								class = "thin"
								value = "Add"
							>
							</form>
						</td>

					</tr>

					<tr class="row">

						<td class="smallish">
							Give points for final placement on or above
							<form action="sweep_rule_save.mhtml">

							<input 
								type  = "hidden"
								name  = "set_id"
								value = "<% $set->id %>"
							>

							<input 
								type  = "hidden"
								name  = "tag"
								value = "place_above"
							>

						</td>

						<td class="smallish">
							<span class="quarter">
								Place:
							</span>
							<span class="twothird">
							<input 
								type = "number"
								name = "place"
								max  = "999"
								min  = "1"
								size = "5"
							>
						</td>

						<td class="smallish">
							<span class="quarter">
								Points:
							</span>
							<span class="twothird">
							<input 
								type = "number"
								name = "points"
								max  = "999"
								min  = "1"
								size = "5"
							>
						</td>

						<td class="centeralign">
							<input 
								type  = "submit"
								class = "thin"
								value = "Add"
							>
							</form>
						</td>

					</tr>


					<tr class="row">

						<td class="smallish">

							Give points for percentage placement

							<form action="sweep_rule_save.mhtml">

							<input 
								type  = "hidden"
								name  = "set_id"
								value = "<% $set->id %>"
							>

							<input 
								type  = "hidden"
								name  = "tag"
								value = "percentage"
							>

						</td>

						<td class="smallish nospace">

							<span class="half nospace">

								<span class="third rightalign marno">
									Top
								</span>

								<span class="twothirds marno">
									<input 
										type  = "number"
										class = "thinner"
										name  = "place"
										min   = "1"
										max   = "99"
										step  = "1"
										size  = "3"
										placeholder = "1-99%"
									>
								</span>

							</span>

							<span class="half marno">

								<div class="full nospace">

									<span class="third marno">
										Basis
									</span>

									<span class="twothirds marno">

										<select 
											name  = "tiebreak_set_id"
											class = "fixedtiny plain"
										>
%											foreach my $tb_set ($tourn->tiebreak_sets) { 
												<option 
													value="<% $tb_set->id %>"
												><% $tb_set->name %></option>
%											}
										</select>

									</span>

								</div>

								<div class="full nospace">

									<span class="third marno">
										As of
									</span>

									<span class="twothirds marno">
										<select name="count" 
											class="fixedtiny plain"
										>
											<option value="all">All</option>
											<option value="last_prelim">Last Prelim</option>
											<option value="prelim">Each Prelim</option>
											<option value="elim">Each Elim</option>
											<option value="final">Finals</option>
										</select>
									</span>

								</div>

							</span>
						</td>

						<td class="smallish">

							<span class="quarter">
								Points:
							</span>

							<span class="twothird">
								<input 
									type = "number"
									name = "points"
									max  = "999"
									min  = "1"
									size = "5"
								>
							</span>

						</td>

						<td class="centeralign">
							<input 
								type  = "submit"
								class = "thin"
								value = "Add"
							>
							</form>
						</td>

					</tr>

					<tr class="row">

						<td class="smallish">
							<form action="sweep_rule_save.mhtml">
							<input 
								type  = "hidden"
								name  = "set_id"
								value = "<% $set->id %>"
							>

							<input 
								type  = "hidden"
								name  = "tag"
								value = "points_per_po_round"
							>

							Points Per Round Elected Presiding Officer

						</td>

						<td class="smallish">

							<span class="quarter">
								In:
							</span>

							<span class="twothird">

								<select name="count" 
									class="fixedsmall plain"
								>
									<option value="all">All</option>
									<option value="prelim">Prelims</option>
									<option value="elim">Elims</option>
									<option value="final">Finals</option>
								</select>

							</span>

						</td>

						<td class="smallish">

							Points: 
							
							<input 
								type = "number"
								name = "points"
								size = "5"
								min  = "1"
								max  = "999"
								size = "5"
							>

						</td>

						<td class="centeralign">
							<input 
								type  = "submit"
								class = "thin"
								value = "Add"
							>
							</form>
						</td>

					</tr>

%				} 
				<tr class="row">

					<td 
						colspan = "3"
						class   = "smallish"
					>

						Manually entered points (under Tab &rarr; Sweeps)

						<form action="sweep_rule_save.mhtml">

						<input 
							type  = "hidden"
							name  = "set_id"
							value = "<% $set->id %>"
						>

						<input 
							type  = "hidden"
							name  = "tag"
							value = "manual"
						>

					</td>

					<td class="centeralign">
						<input 
							type  = "submit"
							class = "thin"
							value = "Add">
						</form>
					</td>

				</tr>

			</table>


%		} else { 

			<h4>Choose a set at right</h4>

%		}

	</div>

	<div class="menu">

%		my @sets = $tourn->sweep_sets;

		<div class="sidenote">

			<h4>Sweeps Sets </h4>

%			foreach my $set (@sets) { 
				<a 
					class="<% $set_id == $set->id ? "dk" : "" %>blue full" 
					href="sweeps.mhtml?set_id=<% $set->id %>">
					<% $set->name %>
				</a>
%			}


			<h5>Add New Set</h5>

			<form action="sweep_set_save.mhtml" method="post">

			<div class="even">

				<span class="threequarter padleft nospace">
					<input 
						type        = "text"
						size        = "24"
						name        = "name"
						placeholder = "Enter name"
					>
				</span>

				<span class="quarter rightalign">
					<input 
						type="submit" 
						class="thin" 
						value="Add">
				</span>

			</div>

			</form>

		</div>

	</div>


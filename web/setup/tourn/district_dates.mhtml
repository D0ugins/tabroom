<%args>
	$person
	$tourn
	$tourn_settings
</%args>
<%init>

	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;

	my $weekends = $tourn_settings->{"district_weekends"};

</%init>

	<div class="main">

		<h4>District Tournament Dates</h4>

		<form 
			action = "district_weekends_save.mhtml"
			method = "post"
		>

			<div class="row">

				<span class="threefifths semibold">
					Over how many separate dates/weekends will your district tournaments occur?
				</span>

				<span class="fifth centeralign">
					<input 
						type  = "number"
						name  = "district_weekends"
						min   = 1
						max   = 99
						value = "<% $weekends %>"
					>
				</span>

				<span class="fifth centeralign">
					<input
						type  = "submit"
						value = "Save"
						class = "thin"
					>
				</span>

			</div>

		</form>

		<& "/funclib/tabs.mas", tabs => \(1 .. $weekends) &>

%		foreach my $weekend (1 .. $weekends) { 

			<div class="screens" id="<% $weekend %>">

<%perl>
				my $reg_start = $tourn->reg_start->set_time_zone($tz);
				my $reg_end = $tourn->reg_end->set_time_zone($tz);

				my $start = $tourn_settings->{"start_".$weekend};
				$start = $tourn->start unless $start;
				$start->set_time_zone($tz) if $start;

				my $end = $tourn_settings->{"end_".$weekend};
				$end = $tourn->end unless $end;
				$end->set_time_zone($tz) if $end;

				my $reg_start = $tourn_settings->{"reg_start_".$weekend};
				$reg_start = $tourn->reg_start unless $reg_start;
				$reg_start->set_time_zone($tz) if $reg_start;

				my $reg_end = $tourn_settings->{"reg_end_".$weekend};
				$reg_end = $tourn->reg_end unless $reg_end;
				$reg_end->set_time_zone($tz) if $reg_end;

				my $freeze_deadline = $tourn_settings->{"freeze_deadline_".$weekend};
				$freeze_deadline = $reg_end->clone unless $freeze_deadline;
				$freeze_deadline->set_time_zone($tz) if $freeze_deadline;

				my $drop_deadline = $tourn_settings->{"drop_deadline_".$weekend};
				$drop_deadline = $reg_end->clone unless $drop_deadline;
				$drop_deadline->set_time_zone($tz) if $drop_deadline;

				my $judge_deadline = $tourn_settings->{"judge_deadline_".$weekend};
				$judge_deadline = $reg_end->clone unless $judge_deadline;
				$judge_deadline->set_time_zone($tz) if $judge_deadline;

				my $fine_deadline = $tourn_settings->{"fine_deadline_".$weekend};
				$fine_deadline = $reg_end->clone unless $fine_deadline;
				$fine_deadline->set_time_zone($tz) if $fine_deadline;

</%perl>

				<form 
					action = "district_dates_save.mhtml"
					method = "post"
				>

				<input 
					type  = "hidden"
					name  = "weekend"
					value = "<% $weekend %>"
				>

				<div class="full">
					<span class="twothird nospace">
						<h4>Set <% $weekend %> Dates &amp; Deadlines</h4>
					</span>

					<span class="third rightalign nospace">
						<h5>Times are in <% Tab::tzname($tz) %></h5>
					</span>
				</div>

				<span class="pagehalf">

					<& "/funclib/datepicker.mas", id => "start" &>

					<div class="full row">

						<span class="half smallish padno marless">
							Tournament start
						</span>

						<span class="half nospace">
							<input 
								type  = "text"
								name  = "start"
								id    = "start"
								size  = "7"
								value = "<% Tab::pickerdate($start) %>"
							>
								at
							<& "/funclib/timepicker.mas",
								name => "starttime",
								size => 6,
								time => $start
							&>
						</span>

					</div>

					<& "/funclib/datepicker.mas", id => "end" &>

					<div class="full row">

						<span class="half smallish padno marless">
							Tournament end
						</span>

						<span class="half nospace">
							<input 
								type  = "text"
								name  = "end"
								id    = "end"
								size  = "7"
								value = "<% Tab::pickerdate($end) %>"
							>
								at
							<& "/funclib/timepicker.mas", 
								name => "endtime", 
								size => 6, 
								time => $end 
							&>
						</span>

					</div>

					<& 
						"/funclib/datepicker.mas", 
						id  => "reg_start",
						max => $start 
					&>

					<div class="full row">

						<span class="half smallish padno marless">
							Registration opens
						</span>

						<span class="half nospace">
							<input 
								type  = "text"
								name  = "reg_start"
								id    = "reg_start"
								size  = "7"
								value = "<% Tab::pickerdate($reg_start) %>"
							>
								at

							<& "/funclib/timepicker.mas",
								name => "reg_starttime", 
								size => 6, 
								time => $reg_start
							&>
						</span>

					</div>

					<& "/funclib/datepicker.mas",
						id  => "reg_end" ,
						max => $start
					&>

					<div class="full row">

						<span class="half smallish padno marless">
							New entries due
						</span>

						<span class="half nospace">
							<input 
								type  = "text"
								name  = "reg_end"
								id    = "reg_end"
								size  = "7"
								value = "<% Tab::pickerdate($reg_end) %>"
							>
								at
							<& "/funclib/timepicker.mas",
								name => "reg_endtime",
								size => 6,
								time => $reg_end 
							&>
						</span>

					</div>

				</span>

				<span class="pagehalf">

					<& "/funclib/datepicker.mas",
						id  => "freeze_deadline" ,
						max => $start
					&>
					
					<div class="full row">

						<span class="half smallish padno marless">
							Fees &amp; Obligations freeze
						</span>

						<span class="half nospace">
							<input 
								type  = "text"
								name  = "freeze_deadline"
								id    = "freeze_deadline"
								size  = "7"
								value = "<% Tab::pickerdate($freeze_deadline) %>"
							>
								at
							<& "/funclib/timepicker.mas",
								name => "freeze_deadlinetime",
								size => 6,
								time => $freeze_deadline
							&>
						</span>

					</div>

					<& "/funclib/datepicker.mas",
						id  => "judge_deadline" ,
						max => $start
					&> 

					<div class="full row">

						<span class="half smallish padno marless">
							Judge entries due
						</span>

						<span class="half nospace">
							<input 
								type  = "text"
								name  = "judge_deadline"
								id    = "judge_deadline"
								size  = "7"
								value = "<% Tab::pickerdate($judge_deadline) %>"
							>
								at
							<& "/funclib/timepicker.mas", 
								name => "judge_deadlinetime",
								size => 6,
								time => $judge_deadline &>
						</span>

					</div>

					<& "/funclib/datepicker.mas",
						id  => "drop_deadline" ,
						max => $start
					&> 

					<div class="full row">

						<span class="half smallish padno marless">
							Online drops &amp; name changes until
						</span>

						<span class="half nospace">
							<input 
								type  = "text"
								name  = "drop_deadline"
								id    = "drop_deadline"
								size  = "7"
								value = "<% Tab::pickerdate($drop_deadline) %>"
							>
								at
							<& "/funclib/timepicker.mas", 
								name => "drop_deadlinetime", 
								size => 6, 
								time => $drop_deadline &>
						</span>

					</div>

					<& "/funclib/datepicker.mas",
						id  => "fine_deadline",
						max => $start
					&>

					<div class="full row">

						<span class="half smallish padno marless">
							Nuisance fines apply after
						</span>

						<span class="half nospace">
							<input 
								type  = "text"
								name  = "fine_deadline"
								id    = "fine_deadline"
								size  = "7"
								value = "<% Tab::pickerdate($fine_deadline) %>"
							>
								at 

							<& 
								"/funclib/timepicker.mas", 
								name => "fine_deadlinetime",
								size => 6,
								time => $fine_deadline 
							&>
						</span>

					</div>

				</span>

				<div class="libl pagefull rightalign">
					<input type="submit" value=" Save Dates  ">
					</form>
				</div>

			</div>
%		}

	</div>

	<div class="menu">

		<div class="sidenote">
			
			<h4>Deadlines Explained</h4>

			<p>
				"New entries due by" is the deadline by which all new
				competitors must be registered
			</p>

			<p>
				"Fees &amp; Obligations Freeze" is the point after which
				judge burdens and entry fees will still apply 
				for dropped entries.
			</p>

			<p>
				"Judge entries due" is the deadline by which all judges
				must be added. You can set earlier deadlines by
				judge category in the Judge Category menu.
			</p>

			<p>
				"Drops &amp; namechanges" is the deadline past which 
				coaches cannot change names or drop entries online;
				an admin must then do it.
			</p>

			<p>
				"Nuisance fines apply" is the point past which changes will
				also incur additional nuisance fees on top of entry fees;
				you can set nuisance fee amounts in Setup &ndash;&gt; Money.
			</p>

		</div>

	</div>



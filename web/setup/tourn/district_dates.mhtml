<%args>
	$person
	$tourn
	$tourn_settings
</%args>
<%init>

	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;

	my @weekends = $tourn->weekends;

</%init>

	<div class="main">

		<h2><% $tourn->name %></h2>

		<& "tabbar.mas",
			tourn          => $tourn,
			tourn_settings => $tourn_settings,
			whoami         => "dates"
		&>

		<h4>District Tournament Dates</h4>

<%perl> 

		my @tabs;

		foreach my $wk (@weekends) { 
			push @tabs, $wk->name;
		}

		my $default = $tabs[0]->name if @tabs;

</%perl> 

		<& "/funclib/tabs.mas", tabs => \@tabs, default => $default &>

%		foreach my $weekend (@weekends) { 

			<div 
				class = "screens weekend_<% $weekend->id %>"
				id    = "weekend_<% $weekend->id %>"
			>

<%perl>

				my $start = $weekend->start;
				$start = $tourn->start unless $start;
				$start->set_time_zone($tz) if $start;

				my $end = $weekend->end;
				$end = $tourn->end unless $end;
				$end->set_time_zone($tz) if $end;

				my $reg_start = $weekend->reg_start;
				$reg_start = $tourn->reg_start unless $reg_start;
				$reg_start->set_time_zone($tz) if $reg_start;

				my $reg_end = $weekend->reg_end;
				$reg_end = $tourn->reg_end unless $reg_end;
				$reg_end->set_time_zone($tz) if $reg_end;

				my $freeze_deadline = $weekend->freeze_deadline;
				$freeze_deadline = $reg_end->clone unless $freeze_deadline;
				$freeze_deadline->set_time_zone($tz) if $freeze_deadline;

				my $drop_deadline = $weekend->drop_deadline;
				$drop_deadline = $reg_end->clone unless $drop_deadline;
				$drop_deadline->set_time_zone($tz) if $drop_deadline;

				my $judge_deadline = $weekend->judge_deadline;
				$judge_deadline = $reg_end->clone unless $judge_deadline;
				$judge_deadline->set_time_zone($tz) if $judge_deadline;

				my $fine_deadline = $weekend->fine_deadline;
				$fine_deadline = $reg_end->clone unless $fine_deadline;
				$fine_deadline->set_time_zone($tz) if $fine_deadline;

</%perl>

				<form 
					action = "district_dates_save.mhtml"
					method = "post"
				>

				<input 
					type  = "hidden"
					name  = "weekend"
					value = "<% $weekend->id %>"
				>

				<span class="pagehalf">

					<div class="row">
						<span class="half">
							Weekend label/name:
						</span>

						<span class="half">
							<input
								type  = "text"
								name  = "name"
								size  = "32"
								value = "<% $weekend->name %>"
							>
						</span>

					</div>

					<div class="row">

						<span class="half">
							Site/location
						</span>

						<span class="half">
							<select name="site_id">
								<option value=""></option>
%								foreach my $site ($tourn->sites) { 
									<option 
										value="<% $site->id %>"
									><% $site->name %></option>
%								}
							</select>
						</span>
					</div>

				</div>

				<div class="pagehalf">

					<div class="row">

						<span class="half">
							City
						</span>

						<span class="half">
							<input
								type  = "text"
								name  = "city"
								size  = "32"
								value = "<% $weekend->name %>"
							>
						</span>
					</div>

					<div class="row">

						<span class="third">
							Location State (if applicable)
						</span>

						<span class="twothird ">
							<select 
								name  = "state"
								class = "chosen fixed"
							>

								<& 
									"/funclib/state_select.mas", 
									state => $tourn->state 
								&>

							</select>

						</span>

					</div>

				</div>

				<& "/funclib/datepicker.mas", id => "start_$weekend" &>

					<div class="full row">

						<span class="half smallish padno marless">
							Weekend start
						</span>

						<span class="half nospace">
							<input 
								type  = "text"
								name  = "start"
								id    = "start_<% $weekend %>"
								size  = "7"
								value = "<% Tab::pickerdate($start) %>"
							>
								at
							<& "/funclib/timepicker.mas",
								id   => "starttime_".$weekend,
								name => "starttime",
								size => 6,
								time => $start
							&>
						</span>

					</div>

					<& "/funclib/datepicker.mas", id => "end_$weekend" &>

					<div class="full row">

						<span class="half smallish padno marless">
							Weekend end
						</span>

						<span class="half nospace">
							<input 
								type  = "text"
								name  = "end"
								id    = "end_<% $weekend %>"
								size  = "7"
								value = "<% Tab::pickerdate($end) %>"
							>
								at
							<& "/funclib/timepicker.mas", 
								id   => "endtime_".$weekend,
								name => "endtime",
								size => 6,
								time => $end
							&>
						</span>

					</div>

					<& 
						"/funclib/datepicker.mas", 
						id  => "reg_start_$weekend",
						max => $start 
					&>

					<div class="full row">

						<span class="half smallish padno marless">
							Registration opens
						</span>

						<span class="half nospace">
							<input 
								type  = "text"
								name  = "reg_start"
								id    = "reg_start_<% $weekend %>"
								size  = "7"
								value = "<% Tab::pickerdate($reg_start) %>"
							>
								at

							<& "/funclib/timepicker.mas",
								id   => "reg_starttime_".$weekend,
								name => "reg_starttime", 
								size => 6, 
								time => $reg_start
							&>
						</span>

					</div>

					<& "/funclib/datepicker.mas",
						id  => "reg_end_$weekend",
						max => $start
					&>

					<div class="full row">

						<span class="half smallish padno marless">
							New entries due
						</span>

						<span class="half nospace">
							<input 
								type  = "text"
								name  = "reg_end"
								id    = "reg_end_<% $weekend %>"
								size  = "7"
								value = "<% Tab::pickerdate($reg_end) %>"
							>
								at
							<& "/funclib/timepicker.mas",
								id   => "reg_endtime_".$weekend,
								name => "reg_endtime",
								size => 6,
								time => $reg_end 
							&>
						</span>

					</div>

				</span>

				<span class="pagehalf">

					<& "/funclib/datepicker.mas",
						id  => "freeze_deadline_$weekend",
						max => $start
					&>
					
					<div class="full row">

						<span class="half smallish padno marless">
							Fees &amp; Obligations freeze
						</span>

						<span class="half nospace">
							<input 
								type  = "text"
								name  = "freeze_deadline"
								id    = "freeze_deadline_<% $weekend %>"
								size  = "7"
								value = "<% Tab::pickerdate($freeze_deadline) %>"
							>
								at
							<& "/funclib/timepicker.mas",
								id   => "freeze_deadlinetime_".$weekend,
								name => "freeze_deadlinetime",
								size => 6,
								time => $freeze_deadline
							&>
						</span>

					</div>

					<& "/funclib/datepicker.mas",
						id  => "judge_deadline_$weekend",
						max => $start
					&> 

					<div class="full row">

						<span class="half smallish padno marless">
							Judge entries due
						</span>

						<span class="half nospace">
							<input 
								type  = "text"
								name  = "judge_deadline"
								id    = "judge_deadline_<% $weekend %>"
								size  = "7"
								value = "<% Tab::pickerdate($judge_deadline) %>"
							>
								at
							<& "/funclib/timepicker.mas", 
								id   => "judge_deadlinetime_".$weekend,
								name => "judge_deadlinetime",
								size => 6,
								time => $judge_deadline &>
						</span>

					</div>

					<& "/funclib/datepicker.mas",
						id  => "drop_deadline_$weekend",
						max => $start
					&> 

					<div class="full row">

						<span class="half smallish padno marless">
							Online drops &amp; name changes until
						</span>

						<span class="half nospace">
							<input 
								type  = "text"
								name  = "drop_deadline"
								id    = "drop_deadline_<% $weekend %>"
								size  = "7"
								value = "<% Tab::pickerdate($drop_deadline) %>"
							>
								at
							<& "/funclib/timepicker.mas", 
								id   => "drop_deadlinetime_".$weekend,
								name => "drop_deadlinetime", 
								size => 6, 
								time => $drop_deadline &>
						</span>

					</div>

					<& "/funclib/datepicker.mas",
						id  => "fine_deadline_$weekend",
						max => $start
					&>

					<div class="full row">

						<span class="half smallish padno marless">
							Nuisance fines apply after
						</span>

						<span class="half nospace">
							<input 
								type  = "text"
								name  = "fine_deadline"
								id    = "fine_deadline_<% $weekend %>"
								size  = "7"
								value = "<% Tab::pickerdate($fine_deadline) %>"
							>
								at 

							<& 
								"/funclib/timepicker.mas", 
								name => "fine_deadlinetime",
								size => 6,
								time => $fine_deadline 
							&>
						</span>

					</div>

				</span>

				<div class="libl pagefull rightalign">
					<input 
						type  = "submit"
						value = " Save Dates  "
					>
					</form>
				</div>

			</div>
%		}

	</div>

	<div class="menu">

		<div class="sidenote">

		</div>

		<div class="sidenote">
			
			<h4>Deadlines Explained</h4>

			<p>
				"New entries due by" is the deadline by which all new
				competitors must be registered
			</p>

			<p>
				"Fees &amp; Obligations Freeze" is the point after which
				judge burdens and entry fees will still apply 
				for dropped entries.
			</p>

			<p>
				"Judge entries due" is the deadline by which all judges
				must be added. You can set earlier deadlines by
				judge category in the Judge Category menu.
			</p>

			<p>
				"Drops &amp; namechanges" is the deadline past which 
				coaches cannot change names or drop entries online;
				an admin must then do it.
			</p>

			<p>
				"Nuisance fines apply" is the point past which changes will
				also incur additional nuisance fees on top of entry fees;
				you can set nuisance fee amounts in Setup &ndash;&gt; Money.
			</p>

		</div>

	</div>



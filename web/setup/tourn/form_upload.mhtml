<%args>
	$tourn
	$label => undef
	$new_form
</%args>
<%init>

	my $msg;

	if ($new_form) {
	
		my $req = Apache2::Request->new($r);
		my $upload = $req->upload("new_form");
		my $filename  = $upload->filename;

		$filename =~ s/[^\w.]//g;
		$filename =~ s/\.(?=.*\.)//g;

		$label = $filename unless $filename;
		$filename =~ s/\s//g;

		my $filetemp = $upload->tempname;

		my $form;

		if ($filetemp) { 

			$form = Tab::File->create({
				tourn    => $tourn->id,
				type     => "school_form",
				label    => $label,
				filename => $filename,

			});
			
		}

		system $Tab::s3_cmd." put $filetemp ".$Tab::s3_bucket."/tourns/".$tourn->id."/school_form/".$form->id."/".$filename;

		$msg = "Form ".$form->label." created for schools to download &amp; re-upload";

	}

	$tourn->setting("instructions_url", "text", $ARGS{"instructions_url"}); 

	$m->redirect("messages.mhtml?msg=$msg");

</%init>

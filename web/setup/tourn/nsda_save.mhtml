<%args>
	$person
	$tourn
	$tourn_settings
</%args>
<%init>

    my %questions = ( 
        1 => { 
            label => "nsda_extemp_topics",
            text  => "Do you want to order extemp questions from the NSDA?",
        },
        2 => { 
            label => "nsda_principal_trophy",
            text  => "Do you want to order a Principal of the Year award?"
        },
        3 => { 
            label => "nsda_student_trophy",
            text  => "Do you want to order a Student of the Year award?"
        },
        4 => { 
            label => "nsda_alum_trophy",
            text  => "Do you want to order a Alumni of the Year award?"
        },
        5 => { 
            label => "nsda_communicator_trophy",
            text  => "Do you want to order an Communicator of the Year award?"
        },
        6 => { 
            label => "nsda_volunteer_trophy",
            text  => "Do you want to order a Volunteer of the Year award?"
        },
    );  

	my $log_changes; 

	foreach my $key (keys %questions) { 

		my $label = $questions{$key}{"label"};

		$ARGS{$label} = 0 unless $ARGS{$label};

		if ($ARGS{$label} ne $tourn_settings->{$label}) { 

			my $human_label = $label;
			$human_label =~ s/_/ /g;
			$human_label =~ s/nsda//g;

			$log_changes .= $person->email." has changed their order for the ".uc($human_label)." to ";

			if ($ARGS{$label} == 1) { 
				$log_changes .= "YES";
			} else { 
				$log_changes .= "NO";
			}

			Tab::debuglog($label." result is ".$ARGS{$label}." which is different!  $log_changes");

			$tourn->setting($label, $ARGS{$label});

		}

	}

	if ($log_changes) { 

        Tab::ChangeLog->create({
            tourn       => $tourn->id,
            type        => "districts",
            person      => $person->id,
            description => $log_changes
        });

	}

	my $msg = "Orders and changes saved";

	$m->redirect("contacts.mhtml?msg=$msg");

</%init>

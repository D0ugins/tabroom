<%args>
	$person
	$tourn
	$tourn_settings
</%args>
<%init>

	my %questions = $m->comp("/funclib/districts_awards.mas");

	my $log_changes; 

	foreach my $key (keys %questions) { 

		my $label = $questions{$key}{"label"};

		$ARGS{$label} = 0 unless $ARGS{$label};

		if ($ARGS{$label} ne $tourn_settings->{$label}) { 

			my $human_label = $label;
			$human_label =~ s/_/ /g;
			$human_label =~ s/nsda//g;

			$log_changes .= $person->email." has changed their order for the ".uc($human_label)." to ";

			if ($ARGS{$label} == 1) { 
				$log_changes .= "YES";
			} else { 
				$log_changes .= "NO";
			}

			$tourn->setting($label, $ARGS{$label});

		}

	}

	if ($log_changes) { 

        $m->comp("/funclib/log.mas", 
            tourn       => $tourn->id,
            type        => "districts",
            person      => $person->id,
            description => $log_changes
        );

	}

	my $msg = "Orders and changes saved";

	$m->redirect("contacts.mhtml?msg=$msg");

</%init>

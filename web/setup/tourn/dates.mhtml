<%args>
	$person
	$tourn
	$tourn_settings
</%args>
<%init>

	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;

	my $start = $tourn->start->set_time_zone($tz);
	my $end = $tourn->end->set_time_zone($tz);

	my $reg_start = $tourn->reg_start->set_time_zone($tz);
	my $reg_end = $tourn->reg_end->set_time_zone($tz);

	my $freeze_deadline = $tourn->setting("freeze_deadline");
	$freeze_deadline = $reg_end->clone unless $freeze_deadline;
	$freeze_deadline->set_time_zone($tz) if $freeze_deadline;

	my $drop_deadline = $tourn->setting("drop_deadline");
	$drop_deadline = $reg_end->clone unless $drop_deadline;
	$drop_deadline->set_time_zone($tz) if $drop_deadline;

	my $supp_deadline = $tourn->setting("supp_deadline");
	$supp_deadline = $reg_end->clone unless $supp_deadline;
	$supp_deadline->set_time_zone($tz) if $supp_deadline;

	my $bill_deadline = $tourn->setting("bill_deadline");
	$bill_deadline = $reg_end->clone unless $bill_deadline;
	$bill_deadline->set_time_zone($tz) if $bill_deadline;

	my $judge_deadline = $tourn->setting("judge_deadline");
	$judge_deadline = $reg_end->clone unless $judge_deadline;
	$judge_deadline->set_time_zone($tz) if $judge_deadline;

	my $fine_deadline = $tourn->setting("fine_deadline");
	$fine_deadline = $reg_end->clone unless $fine_deadline;
	$fine_deadline->set_time_zone($tz) if $fine_deadline;

</%init>

	<div class="main">

		<form action="dates_save.mhtml" method="post">

		<h2><% $tourn->name %></h2>

		<& tabbar.mas, 
			tourn          => $tourn,
			tourn_settings => $tourn_settings,
			whoami         => "dates"
		&>

		<div class="full">
			<span class="twothird nospace">
				<h4>Dates &amp; Deadlines</h4>
			</span>

			<span class="third rightalign nospace">
				<h5>Times are <% Tab::tzname($tz) %></h5>
			</span>
		</div>

		<span class="pagehalf">

			<& "/funclib/datepicker.mas", 
				id => "start"
			&>

			<div class="row">

				<span class="half smallish ">
					Tournament start
				</span>

				<span class="quarter">
					<input 
						type  = "text"
						name  = "start"
						id    = "start"
						size  = "7"
						value = "<% Tab::pickerdate($start) %>"
					>
				</span>
				<span class="quarter">
					<& "/funclib/timepicker.mas", 
						name => "starttime", 
						size => 6, 
						time => $start &>
				</span>

			</div>

			<& "/funclib/datepicker.mas",
				id => "end"
			&>

			<div class="row">

				<span class="half smallish ">
					Tournament end
				</span>

				<span class="quarter">
					<input 
						type  = "text"
						name  = "end"
						id    = "end"
						size  = "7"
						value = "<% Tab::pickerdate($end) %>"
					>
				</span>
				<span class="quarter">
					<& "/funclib/timepicker.mas", 
						name => "endtime", 
						size => 6, 
						time => $end 
					&>
				</span>

			</div>

			<& 
				"/funclib/datepicker.mas", 
				id  => "reg_start",
				max => $start 
			&>

			<div class="row">

				<span class="half smallish ">
					Registration opens
				</span>

				<span class="quarter">
					<input 
						type  = "text"
						name  = "reg_start"
						id    = "reg_start"
						size  = "7"
						value = "<% Tab::pickerdate($reg_start) %>"
					>
				</span>
				<span class="quarter">
					<& "/funclib/timepicker.mas",
						name => "reg_starttime", 
						size => 6, 
						time => $reg_start
					&>
				</span>

			</div>

			<& /funclib/datepicker.mas, 
				id => "reg_end", 
				max => $start
			&> 

			<div class="row">

				<span class="half smallish ">
					New entries due
				</span>

				<span class="quarter">
					<input 
						type  = "text"
						name  = "reg_end"
						id    = "reg_end"
						size  = "7"
						value = "<% Tab::pickerdate($reg_end) %>"
					>
				</span>
				<span class="quarter">
					<& "/funclib/timepicker.mas", 
						name => "reg_endtime", 
						size => 6, 
						time => $reg_end &>
				</span>

			</div>

%			if ($tourn_settings->{"nsda_nats"}) { 

				<& "/funclib/datepicker.mas", 
					id =>"bill_deadline", 
					max => $start
				&> 

				<div class="row">

					<span class="half smallish ">
						Legislation due
					</span>

					<span class="quarter">
						<input 
							type  = "text"
							name  = "bill_deadline"
							id    = "bill_deadline"
							size  = "7"
							value = "<% Tab::pickerdate($bill_deadline) %>"
						>
					</span>
					<span class="quarter">
						<& /funclib/timepicker.mas, 
							name => "bill_deadlinetime", 
							size => 6, 
							time => $bill_deadline &>
					</span>

				</div>

%			}


		</span>

		<span class="pagehalf">

			<& "/funclib/datepicker.mas", 
				id =>"freeze_deadline", 
				max => $start
			&> 
			
			<div class="row">

				<span class="half smallish ">
					Fees &amp; Obligations freeze
				</span>

				<span class="quarter">
					<input 
						type  = "text"
						name  = "freeze_deadline"
						id    = "freeze_deadline"
						size  = "7"
						value = "<% Tab::pickerdate($freeze_deadline) %>"
					>
				</span>
				<span class="quarter">
					<& "/funclib/timepicker.mas",
						name => "freeze_deadlinetime", 
						size => 6, 
						time => $freeze_deadline &>
				</span>

			</div>

			<& "/funclib/datepicker.mas", 
				id =>"judge_deadline" , 
				max => $start
			&> 

			<div class="row">

				<span class="half smallish ">
					Judge entries due
				</span>

				<span class="quarter">
					<input 
						type  = "text"
						name  = "judge_deadline"
						id    = "judge_deadline"
						size  = "7"
						value = "<% Tab::pickerdate($judge_deadline) %>"
					>
				</span>
				<span class="quarter">
					<& "/funclib/timepicker.mas", 
						name => "judge_deadlinetime",
						size => 6,
						time => $judge_deadline &>
				</span>

			</div>

			<& "/funclib/datepicker.mas", 
				id =>"drop_deadline", 
				max => $start
			&> 

			<div class="row">

				<span class="half smallish ">
					Online drops &amp; name changes until
				</span>

				<span class="quarter">
					<input 
						type  = "text"
						name  = "drop_deadline"
						id    = "drop_deadline"
						size  = "7"
						value = "<% Tab::pickerdate($drop_deadline) %>"
					>
				</span>
				<span class="quarter">
					<& "/funclib/timepicker.mas", 
						name => "drop_deadlinetime", 
						size => 6, 
						time => $drop_deadline &>
				</span>

			</div>

%			if ($tourn_settings->{"nsda_nats"}) { 

				<& "/funclib/datepicker.mas", 
					id =>"supp_deadline", 
					max => $start
				&> 

				<div class="row">

					<span class="half smallish ">
						Supps &amp; consolations due
					</span>

					<span class="quarter">
						<input 
							type  = "text"
							name  = "supp_deadline"
							id    = "supp_deadline"
							size  = "7"
							value = "<% Tab::pickerdate($supp_deadline) %>"
						>
					</span>
					<span class="quarter">
						<& /funclib/timepicker.mas, 
							name => "supp_deadlinetime", 
							size => 6, 
							time => $supp_deadline &>
					</span>

				</div>

%			}

			<& "/funclib/datepicker.mas", 
				id =>"fine_deadline", 
				max => $start
			&> 

			<div class="row">

				<span class="half smallish ">
					Nuisance fines apply after
				</span>

				<span class="quarter">
					<input 
						type  = "text"
						name  = "fine_deadline"
						id    = "fine_deadline"
						size  = "7"
						value = "<% Tab::pickerdate($fine_deadline) %>"
					>
				</span>
				<span class="quarter">
					<& 
						"/funclib/timepicker.mas", 
						name => "fine_deadlinetime",
						size => 6,
						time => $fine_deadline 
					&>
				</span>

			</div>

		</span>

		<div class="libl full martopno rightalign">
			<input type="submit" value="Save Dates">
			</form>
		</div>

	</div>

	<div class="menu">

		<div class="sidenote">

			<& "deadlines.mas" &>

		</div>

	</div>



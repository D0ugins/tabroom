<%args>
	$person
	$tourn
	$event_id      => undef
	$round_id      => undef
	$only_category => undef
	$nsda          => undef
</%args>
<%init>

	use POSIX;

	my $event = Tab::Event->retrieve($event_id) if $event_id;
	my $round = Tab::Round->retrieve($round_id) if $round_id;
	$event = $round->event if $round;

	my @events = $only_category->events if $only_category;
	@events = $tourn->events unless $only_category;
	@events = sort {$a->name cmp $b->name} @events;

	unless ($event) { 
		foreach my $candidate (@events) { 
			$event = $candidate if $candidate->rounds;
		}
	}

	$m->abort unless $event;

	my @rounds = $m->comp("/funclib/event_rounds.mas", 
						event => $event, 
						done => "yes");

	$round = $m->comp("/funclib/event_current_round.mas", 
						event => $event, 
						done => "done") unless $round;

	$round = $rounds[0] unless $round;

</%init>

	<div class="blankfull">

		<& /funclib/tablesorter.mas, table => "sortme" &>

		<div class="full nospace odd">

			<span class="fifth nowrap">
				<h4 class="padno marless"> <% $event->abbr %> </h4>
			</span>

			<span class="third marno centeralign">
				<form action="index.mhtml" method="post">
				<input type="hidden" name="type" value="Speakers">
				<input type="hidden" name="nsda" value="<% $nsda %>">

					<h5 class="inline marright">
						Event:
					</h5>

					<select 
						name="event_id" 
						onchange='this.form.submit()' 
						class="fixedmed chosen">

%						foreach my $oevent (sort {$a->type cmp $b->type} @events) { 
							<option 
								value="<% $oevent->id %>" 
								<% $oevent->id == $event->id ? 'selected="selected"' : "" %>
							> <% $oevent->name %> </option>
%						}
					</select>
				</form>
			</span>

			<span class="third marno centeralign">

%				if (@rounds) { 

					<h5 class="inline marright">
						As of
					</h5>

					<form action="index.mhtml" method="post">	

					<input 
						type  = "hidden"
						name  = "event_id"
						value = "<% $event->id %>"
					>

					<select 
						name     = "round_id"
						onchange = 'this.form.submit();'
						class    = "fixedmed chosen"
					>

%						foreach my $oround (sort {$b->name <=> $a->name} @rounds) {

%							next unless $oround && $oround->id;
%							next unless $round && $round->id;

							<option 
								value="<% $oround->id %>" 
								<% $round && $oround->id == $round->id ? "selected" : "" %>
							> <% $oround->realname %> </option>
%						}

					</select>
					</form>
%				}
			</span>

			<span class="tenth rightalign nospace">
%				if ($round) { 
					<a 
						class="dkblue button" 
						href="csv.mhtml?round_id=<% $round->id %>" >
						Spreadsheet
					</a>
%				}
			</span>

		</div>

		<& "results_table.mas", round => $round &>
	
	</div>



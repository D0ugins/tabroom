<%args>
	$tourn
	$tourn_settings
	$person
	$function => undef
</%args>
<%init>

	my @functions = (
		"Upload Data", 
		"Confirm NSDA Memberships", 
		"Vacate Double Entries",
		"Generate Results Sheets",
		"Post to Nationals"
	);

	my $district = Tab::District->retrieve($tourn_settings->{"nsda_district"});

	my @undone_events;

	foreach my $event (sort {$a->type cmp $b->type} $tourn->events()) { 
		next if $event->setting('weekend') eq "nope";
		next if $event->rounds(type => "final");
		next if $event->rounds() && $event->type eq "congress";
		next if $event->type eq "big_questions";
		push @undone_events, $event;
	}


</%init>

	<div class="main">
		
		<h4><% $function %></h4>

%		if ($function eq "Upload Data") { 

			<form 
				enctype = "multipart/form-data"
				name    = "jotresults"
				action  = "/register/data/import_joy_results.mhtml"
				method  = "post"
			>

				<input 
					type  = "hidden"
					name  = "from"
					value = "districts"
				>

				<p class="semibold martopmuchmore">
					Please upload only the .jot files from your district
					tournament when the weekend is complete. 
				</p>
					
				<p class="semibold marbottommore">
					Be sure that if you merged two district tournaments, you
					have unmerged them and that this tournament ONLY contains
					data and events from the <span class="redtext inline"><% $tourn->name %></span>.
				</p>

				<div class="row full marno">

					<span class="twofifths">
						Tournament .jot results data:
					</span>

					<span class="twofifths">

						<div class="uploader wider">

							<input 
								type     = "file"
								name     = "resultsjot"
								style    = "opacity: 0;"
								onchange = "uploaderName('jotresults', 'jotresults_file');"
								id       = "jotresults"
							>

								<span 
									id    = "jotresults_file"
									class = "filename"
									style = "-webkit-user-select: none;"
								>No file selected</span>

								<span 
									class="action" 
									style="-webkit-user-select: none;"
								>Choose File</span>
						</div>

					</span>

					<span class="fifth rightalign">
						<input 
							type  = "submit"
							value = "Upload"
							class = "thin"
						>
					</span>

				</div>

			</form>

%		} elsif ($function eq "Confirm NSDA Memberships") { 

			<& "/register/reports/school_memberships.mas", 
				tourn    => $tourn,
				district => $district,
				from     => "jot"
			&>

			<& "/register/reports/nsda_students.mas",
				tourn          => $tourn,
				tourn_settings => $tourn_settings,
				from           => "jot"
			&>

%		} elsif ($function eq "Vacate Double Entries") {

			<p class="bigger">
				For each event, click on the event name and confirm that the
				order listed is the correct order for the qualifiers and
				alternates.  Mark "Vacated" at far right if a student has
				abandoned that slot to Nationals (because of single entry
				intents, etc), including where known for alternate slots. 
			</p>

%			foreach my $event ($tourn->events) { 

				<div class="row">

					<span class="third nospace">
						<a 
							class  = "white full semibold bluetext marleftmore"
							target = "_blank"
							href = "/tabbing/results/nsda_qualifiers.mhtml?event_id=<% $event->id %>"
						><% $event->name %></a>
					</span>

					<span class="sixth nospace">
						<% scalar($event->rounds()) %> rounds
					</span>

					<span class="sixth nospace">
						<% scalar($event->entries(active => 1)) %> active entries
					</span>

					<span class="third nospace">
					</span>

				</div>
%			}

%		} elsif ($function eq "Generate Results Sheets") { 

%		} elsif ($function eq "Post to Nationals") { 

%		} 


	</div>

	<div class="menu">

		<div class="sidenote">
			<h4>Steps:</h4>

%			my $counter = 1;
%			foreach my $ofunc (@functions) { 

				<div class="full nospace bordertop borderbottom">
					<span class="fifth semibold centeralign">
						<% $counter++ %>.
					</span>
					<span class="fourfifths nospace">
						<a 
							class="<% $function eq $ofunc ? "dk" : "" %>blue full"
							href="joydistrict.mhtml?function=<% $ofunc %>"
						><% $ofunc %></a>
					</span>
				</div>
%			}
		</div>

		<div class="sidenote">

			<h4>Status</h4>

			<div class="full row">
				
				<span class="threequarters nospace semibold bigger bluetext">
					Events unfinished: 
				</span>

%				if (@undone_events) { 
					<div class="full nospace">
%					foreach my $event (@undone_events) { 
						<span class="quarter biggish"><% $event->abbr %></span>
%					}
					</div>
%				} else { 
					<span class="centeralign quarter greentext">
						NONE <span class="inline fa fa-check"></span>
					</span>
%				}

			</div>

			<div class="full row">
				
				<span class="threequarters nospace semibold bigger bluetext">
					Memberships confirmed
				</span>

%				if ($tourn_settings->{"nsda_membership_check"}) {
					<span class="quarter greentext biggish semibold">
						OK <span class="inline fa fa-check fa-lg"></span>
					</span>
%				} else { 
					<span class="quarter redtext biggish semibold">
						UNDONE <span class="inline fa fa-times fa-lg"></span>
					</span>
%				}

			</div>

		</div>

	</div>

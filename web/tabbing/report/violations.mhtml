<%args>
	$tourn
</%args>
<%init>

	my $dbh = Tab::DBI->db_Main();

	my $sth = $dbh->prepare("

		select
			entry.id entry, entry.code, entry.name,
			round.id round, round.name roundname, round.label roundlabel,
			event.id event, event.abbr, event.name eventname,
			judge.id judge, judge.first, judge.last

		from event, round, panel, ballot, score, judge, entry


		where event.tourn = ?
			and event.id = round.event
			and round.id = panel.round
			and panel.id = ballot.panel
			and ballot.judge = judge.id
			and ballot.entry = entry.id
			and ballot.id = score.ballot
			and score.tag = 'tv'
		order by round.name, event.abbr, entry.code
	");

	$sth->execute($tourn->id);

	my $results = $sth->fetchall_hash();

</%init>

	<span class="half nospace">
		<h5>Marked Violations</h5>
	</span>
	<span class="half nospace" id="violations_buttonarea">
	</span>

	<& "/funclib/tablesorter.mas", table => "violations" &>

	<table id="violations">

		<thead>
			<tr class="yellowrow">
				<th>
					Code
				</th>

				<th>
					Name
				</th>

				<th>
					Event
				</th>

				<th>
					Round
				</th>

				<th>
					Judge
				</th>
			</tr>
		</thead>

		<tbody>
%			foreach my $result (@{$results}) {

				<tr>
					<td>
						<% $result->{"code"} %>
					</td>

					<td>
						<% $result->{"name"} %>
					</td>

					<td>
						<% $result->{"eventname"} %>
					</td>

					<td>
						<% $result->{"roundlabel"} ? $result->{"roundlabel"} : "Rnd ".$result->{"roundname"} %>
					</td>

					<td>
						<% $result->{"first"} %>
						<% $result->{"last"} %>
					</td>
				</tr>
%			}
		</tbody>
	</table>

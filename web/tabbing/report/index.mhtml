<%args>
	$tourn
	$tourn_settings
	$person
	$perms         => undef
	$only_category => undef
</%args>
<%init>

	my $entry_only++ 
		if ${$perms}{"entry_only"};

	$entry_only++ if ${$perms}{"limited"} 
		&! ${$perms}{"registration"};

	my @all_timeslots;

	my ($eventref, $catref) = $m->comp(
		"/funclib/allowed_events.mas", 
		tourn => $tourn,
		perms => $perms,
		type  => "admin"
	);

	my @events = @{$eventref};
	my $event = $events[0] if scalar @events == 1;
	my @categories = @{$catref};

	my @round_robins;

	foreach my $event (@events) {
		push @round_robins, $event if $event->setting('round_robin');
	}

	my @debate;
	my @speech;
	my @congress;

	@events = sort {$a->name cmp $b->name} @events;

	foreach my $event (@events) {
		push @debate, $event if $event->type ne"speech" && $event->type ne"congress";
		push @speech, $event if $event->type eq "speech";
		push @congress, $event if $event->type eq "congress";
	}


</%init>

	<& menu.mas, 
		perms          => $perms,
		tourn          => $tourn,
		tourn_settings => $tourn_settings,
		only_category  => $only_category
	&> 

	<div class="main">

		<h2>
			Results Reports
		</h2>

		<h4>
			By Event
		</h4>

		<script>

			function showRounds() { 

				$(".event_rounds").addClass("hidden");
				$(".select_rounds").prop("disabled", true);

				var eventID = $("#prelims_order_event").val();

				if (eventID) { 
					$("."+eventID).removeClass("hidden");
					$(".select_"+eventID).prop("disabled", false);
				} else { 
					$(".timeslots").removeClass("hidden");
					$(".select_timeslots").prop("disabled", false);

				}
			}

			$(document).ready(function() { 
				showRounds();
			});

		</script>

		<div class="row full marverno padmore">
			<form action="prelims_order.mhtml" method="post">
			
			<span class="sixth semibold bluetext">
				Seeding:
			</span>

			<span class="third">

				<select 
					name     = "event_id"
					id       = "prelims_order_event"
					class    = "fixedmed"
					onChange = "showRounds();"
				>

					<option value="">All</option>

%					foreach my $oevent (sort {$a->name cmp $b->name} @events) {
						<option 
							value="<% $oevent->id %>"
							<% $oevent == $event ? "selected" : "" %>
							> <% $oevent->name %> </option>
%					}

				</select>
			</span>

			<span class="third">

				<div class="full timeslots event_rounds">

					<select 
						name     = "timeslot_id"
						class    = "fixedmed select_rounds select_timeslots"
					>

%					foreach my $timeslot (@all_timeslots) { 
						<option
							value="<% $timeslot->id %>"
						><% $timeslot->name %></option>
%					}

					</select>

				</div>

%				foreach my $oevent (sort {$a->name cmp $b->name} @events) {

					<div class="full <% $oevent->id %> event_rounds">

						<select 
							name     = "round_id"
							class    = "fixedmed select_rounds select_<% $oevent->id %>"
						>

%						foreach my $round (sort {$a->name <=> $b->name} $oevent->rounds) {
							<option
								value="<% $round->id %>"
							><% $round->realname %></option>
%						}

						</select>

					</div>
%				}

			</span>

			<span class="sixth rightalign nospace">
				<input 
					type  = "submit"
					class = "thin"
					value = "Print"
				>
				</form>
			</span>

		</div>

		<div class="row full marverno padmore">

			<form 
				action = "prelims_order.mhtml"
				method = "post"
			>

			<input 
				type  = "hidden"
				name  = "ballots"
				value = "1"
			>
			
			<span class="sixth semibold bluetext">
				Seeding /w Scores
			</span>

			<span class="third">

				<select 
					name     = "event_id"
					id       = "prelims_order_event"
					class    = "fixedmed"
					onChange = "showRounds();"
				>

					<option value="">All</option>

%					foreach my $oevent (sort {$a->name cmp $b->name} @events) {
						<option 
							value="<% $oevent->id %>"
							<% $oevent == $event ? "selected" : "" %>
							> <% $oevent->name %> </option>
%					}

				</select>
			</span>

			<span class="third">

				<div class="full timeslots event_rounds">

					<select 
						name     = "timeslot_id"
						class    = "fixedmed select_rounds select_timeslots"
					>

%					foreach my $timeslot (@all_timeslots) { 
						<option
							value="<% $timeslot->id %>"
						><% $timeslot->name %></option>
%					}

					</select>

				</div>

%				foreach my $oevent (sort {$a->name cmp $b->name} @events) {

					<div class="full  <% $oevent->id %> event_rounds">

						<select 
							name     = "round_id"
							class    = "fixedmed select_rounds select_<% $oevent->id %>"
						>

%						foreach my $round (sort {$a->name <=> $b->name} $oevent->rounds) {
							<option
								value="<% $round->id %>"
							><% $round->realname %></option>
%						}

						</select>

					</div>
%				}

			</span>

			<span class="sixth rightalign nospace">

				<input 
					type  = "submit"
					class = "thin"
					value = "Print"
				>
				</form>
			</span>

		</div>
		<div class="row full marverno padmore">

			<form action="score_report.mhtml" method="post">

			<span class="sixth semibold bluetext">
				Scores Report
			</span>

			<span class="third">

				<select name="event_id" class="fixedmed">
					<option value="all">All Events</option>
%					foreach my $oevent (sort {$a->name cmp $b->name} @events) {
						<option
							<% $oevent == $event ? "selected" : "" %>
							value="<% $oevent->id %>"
						> <% $oevent->name %> </option>
%					}

				</select>
			</span>

			<span class="fourtenths nospace">
				Up To Round 
				<input 
					type = "number"
					name = "round_name"
					min  = "0"
					max  = "99"
				>
				</span>
			</span>

			<span class="tenth rightalign">
				<input 
					type  = "submit"
					class = "thin"
					value = "Print">
				</form>
			</span>

		</div>

		<div class="row full marverno padmore">

			<form 
				action = "awards_ceremony.mhtml"
				method = "post"
			>

			<span class="sixth semibold bluetext">
				Awards
			</span>

			<span class="third">

				<select 
					name="event_id" 
					class="fixedmed"
				>

					<option value="all">All Events</option>

%					foreach my $oevent (sort {$a->name cmp $b->name} @events) {
						<option 
							value="<% $oevent->id %>"
							<% $oevent == $event ? "selected" : "" %>
						> <% $oevent->name %> </option>
%					}

				</select>
			</span>

			<span class="fourtenths nospace">

				<span class="half nospace">
	
					<label for="reverse">

						<div class="full hover nospace">

							<span class="threequarters nospace padvert smallish">
								Reverse order
							</span>

							<span class="fifth nospace centeralign">
								<input
									class = "marno"
									type  = "checkbox"
									id    = "reverse"
									name  = "reverse"
									value = 1
									<% $tourn_settings->{'reverse_awards'} ? 'checked="checked"' : "" %>
								>
							</span>

						</div>

					</label>

					<label for="names">

						<div class="full hover nospace">

							<span class="threequarters nospace padvert smallish">
								By Names
							</span>

							<span class="fifth nospace centeralign">
								<input
									class = "marno"
									type  = "checkbox"
									id    = "names"
									name  = "names"
									value = 1
								>
							</span>

						</div>

					</label>

				</span>

				<span class="half nospace">

					<span class="half smallish marno padless">
						# Rounds
					</span>

					<span class="half smallish marno padno">
						<input
							type  = "number"
							name  = "cutoff"
							min   = 1
							max   = 10
							class = "smaller"
							size  = 3
						>
					</span>

					<span class="half smallish marno padless">
						# Entries
					</span>

					<span class="half smallish marno padno">
						<input
							type  = "number"
							name  = "entry_cutoff"
							min   = 1
							max   = 999
							class = "smaller"
							size  = 3
						>
					</span>
				</span>
			</span>

			<span class="tenth rightalign">
				<input 
					type  = "submit"
					class = "thin"
					value = "Print"
				>
				</form>
			</span>

		</div>

		<div class="row full marverno padmore">

			<form 
				action = "awards_script.mhtml"
				method = "post"
			>

			<span class="sixth semibold bluetext padvert">
				Awards Script 
			</span>

			<span class="third">

				<select 
					name  = "event_id"
					class = "fixedmed"
				>
					<option value="all">All Events</option>

%					foreach my $oevent (@events) { 
						<option 
							<% $oevent == $event ? "selected" : "" %>
							value="<% $oevent->id %>"
						> <% $oevent->name %> </option>
%					}

				</select>
			</span>

			<span class="quarter">
				Limit <input 
					type  = "number"
					class = "smaller"
					name  = "cutoff"
					size  = "3"
					min   = "0"
					max   = "999"
				>
			</span>

			<span class="quarter rightalign nospace">
				<input 
					type  = "submit"
					name  = "type"
					class = "thin"
					value = "Print"
				>
				</form>
			</span>

		</div>

%		if (@round_robins) { 
			<div class="row full marverno padmore">

				<form 
					action = "round_robin_script.mhtml"
					method = "post"
				>

				<span class="sixth semibold bluetext padvert smallish">
					Round Robin Script 
				</span>

				<span class="third">

					<select 
						name  = "event_id"
						class = "fixedmed"
					>

%						foreach my $oevent (@round_robins) { 
							<option 
								<% $oevent == $event ? "selected" : "" %>
								value="<% $oevent->id %>"
							> <% $oevent->name %> </option>
%						}

					</select>
				</span>

				<span class="quarter rightalign nospace">
				</span>

				<span class="quarter rightalign nospace">
					<input 
						type  = "submit"
						name  = "type"
						class = "thin"
						value = "Print"
					>
				</span>

				</form>

			</div>

%		}

%		if (@congress) { 

			<div class="row full marverno padmore">

				<form 
					action = "congress_scores.mhtml"
					method = "post"
				>

				<span class="sixth semibold bluetext padvert smallish">
					Congress Speech Scores
				</span>

				<span class="third">

					<select name="event_id" class="fixedmed">

						<option value="all">All Congress Events</option>
%						foreach my $oevent (@congress) { 
							<option value="<% $oevent->id %>"> <% $oevent->name %> </option>
%						}
					</select>
				</span>

				<span class="third">
				</span>

				<span class="sixth rightalign nospace">
					<input 
						type  = "submit"
						name  = "type"
						class = "thin"
						value = "Print"
					>
					</form>
				</span>

			</div>
%		}

%		if (@debate) { 

			<div class="row full marverno padmore">

				<form 
					action = "event_speakers.mhtml"
					method = "post"
				>

				<span class="sixth semibold bluetext padvert smallish">
					Debate Speakers
				</span>

				<span class="third">

					<select name="event_id" class="fixedmed">

						<option value="all">All Debate Events</option>
%						foreach my $oevent (@debate) { 
							<option value="<% $oevent->id %>"> <% $oevent->name %> </option>
%						}
					</select>
				</span>

				<span class="quarter">
					Limit <input 
						type  = "number"
						class = "smaller"
						name  = "limit"
						size  = "3"
						min   = "0"
						max   = "999"
					>
				</span>

				<span class="quarter rightalign nospace">
					<input 
						type  = "submit"
						name  = "type"
						class = "thin marrightmore"
						value = "CSV"
					>

					<input 
						type  = "submit"
						name  = "type"
						class = "thin"
						value = "Print"
					>
					</form>
				</span>

			</div>


			<div class="whitenohover row full marverno padmore">

				<form 
					action = "packet.mhtml"
					method = "post"
				>

				<span class="sixth semibold bluetext padvert smallish">
					Debate Packets
				</span>

				<span class="third">

					<select name="event_id" class="fixedmed">
						<option value="all">All Debate Events</option>
%						foreach my $oevent (@debate) { 
							<option value="<% $oevent->id %>"> <% $oevent->name %> </option>
%						}
					</select>
				</span>

				<span class="fourtenths nospace">
				</span>

				<span class="tenth rightalign">
					<input 
						type  = "submit"
						class = "thin"
						value = "Print"
					>
					</form>
				</span>

			</div>

			<div class="row full marverno padmore">

				<form 
					action = "reading.mhtml"
					method = "post"
				>

				<span class="sixth semibold bluetext padvert">
					Elim Reading
				</span>

				<span class="third">
					<select name="event_id" class="fixedmed">
						<option value="">All Events</option>
%						foreach my $oevent (@debate) { 
							<option value="<% $oevent->id %>"> <% $oevent->name %> </option>
%						}
					</select>
				</span>

				<span class="fourtenths nospace">
					<select name="timeslot_id" class="fixedmed">
						<option value="">All Timeslots</option>
%						foreach my $timeslot (sort {$a->start->epoch <=> $b->start->epoch} @all_timeslots) {
							<option value="<% $timeslot->id %>"> <% $timeslot->name %> </option>
%						}
					</select>
				</span>

				<span class="tenth rightalign">
					<input 
						type  = "submit"
						class = "thin"
						value = "Print"
					>
					</form>
				</span>

			</div>


			<div class="row full marverno padmore">

				<form action="readingjudges.mhtml" method="post">

				<span class="sixth semibold bluetext padvert">
					Elim Printout
				</span>

				<span class="third">
					<select name="event_id" class="fixedmed">
						<option value="">All Events</option>
%						foreach my $oevent (@debate) { 
							<option value="<% $oevent->id %>"> <% $oevent->name %> </option>
%						}
					</select>
				</span>

				<span class="fourtenths nospace">
				</span>

				<span class="tenth rightalign">
					<input 
						type  = "submit"
						class = "thin"
						value = "Print">
					</form>
				</span>

			</div>

			<div class="whitenohover row full marverno padmore">

				<form action="stats.mhtml" method="post">

				<span class="sixth semibold bluetext padvert">
					Side Stats
				</span>

				<span class="third">
					<select name="event_id" class="fixedmed">
						<option value="all">All Events</option>
%						foreach my $oevent (@debate) {
							<option value="<% $oevent->id %>"> <% $oevent->name %> </option>
%						}
					</select>
				</span>

				<span class="quarter">
				</span>

				<span class="quarter rightalign nospace">
					<input 
						type  = "submit"
						name  = "print"
						class = "thin marrightmore"
						value = "View"
					>
					<input 
						type  = "submit"
						name  = "print"
						class = "thin"
						value = "Print">
					</form>
				</span>

			</div>

%		}

%		unless ($perms->{'details'}) { 

		<h4 class="martopmore">
			By School
		</h4>

		<div class="row full marverno padmore">

			<form action="school.mhtml" method="post">

			<span class="sixth semibold bluetext padvert">
				School Report
			</span>

			<span class="third">
				<select name="school_id" class="fixedmed">
					<option value="all">All Schools</option>
%					foreach my $school (sort {$a->name cmp $b->name} $tourn->schools) {
						<option value="<% $school->id %>"> <% $school->name %> </option>
%					}
				</select>
			</span>

			<span class="third">
			</span>

			<span class="eighth rightalign">
				<input 
					type  = "submit"
					class = "thin"
					value = "Print"
				>
			</span>

			</form>

		</div>

%		unless ($tourn_settings->{"ncfl"} &! (${$perms}{"full_admin"} || ${$perms}{"owner"}) ) { 

			<div class="row full marverno padmore">

				<form 
					action="sweep_schools.mhtml" 
					method="post"
				>

				<span class="sixth semibold bluetext padvert">
					Sweepstakes
				</span>

				<span class="third">
					<select name="sweep_set_id" class="fixedmed">
%						foreach my $set (sort {$a->name cmp $b->name} $tourn->sweep_sets) {
							<option value="<% $set->id %>"> <% $set->name %> </option>
%						}
					</select>
				</span>

				<span class="third rightalign">
					<input 
						type  = "submit"
						class = "thin"
						name  = "what"
						value = "View"
					>
				</span>

				<span class="eighth rightalign">
					<input 
						type  = "submit"
						class = "thin"
						name  = "what"
						value = "Print"
					>
				</span>

				</form>

			</div>

			<br style="clear: both;">

			<h4>
				By Entry
			</h4>

			<div class="row full marverno padmore">

				<form action="sweep_entries.mhtml" method="post">

				<span class="sixth semibold bluetext padvert">
					Sweepstakes by Entry
				</span>

				<span class="third">
					<select 
						name  = "sweep_set_id"
						class = "fixedmed"
					>

%						foreach my $set (sort {$a->name cmp $b->name} $tourn->sweep_sets) {
							<option 
								value="<% $set->id %>"
							> <% $set->name %> </option>
%						}
					</select>
				</span>

				<span class="third rightalign">
				</span>

				<span class="eighth rightalign">
					<input 
						type  = "submit"
						class = "thin"
						name  = "what"
						value = "View"
					>
				</span>

				</form>

			</div>
			<div class="row full marverno padmore">

				<form action="sweep_students.mhtml" method="post">

				<span class="sixth semibold bluetext padvert">
					Sweepstakes by Person
				</span>

				<span class="third">
					<select 
						name  = "sweep_set_id"
						class = "fixedmed"
					>

%						foreach my $set (sort {$a->name cmp $b->name} $tourn->sweep_sets) {
							<option 
								value="<% $set->id %>"
							> <% $set->name %> </option>
%						}
					</select>
				</span>

				<span class="third rightalign">
					<input 
						type  = "submit"
						class = "thin"
						name  = "what"
						value = "View"
					>
				</span>

				<span class="eighth rightalign">
					<input 
						type  = "submit"
						class = "thin"
						name  = "what"
						value = "Print"
					>
				</span>

				</form>

			</div>

%		}
%	}

<%perl>

	my @ndca;

	foreach my $oevent (sort {$a->name cmp $b->name} @events) {

		next if $oevent->type eq "speech";
		next if $oevent->type eq "congress";
		next if $oevent->type eq "wudc";
		next if $oevent->type eq "roundrobin";

		next unless ($oevent->setting("dukesandbailey") 
			|| $oevent->setting("baker") 
			|| $oevent->setting("ndca_public_forum")
		);

		push @ndca, $oevent;
	}

	if (@ndca) { 

</%perl>

		<div class="row full marverno padmore">

			<form action="ndca/points.mhtml" method="post">

			<span class="sixth semibold bluetext padvert">
				NDCA Points
			</span>

			<span class="third">
				<select name="event_id" class="fixedmed">
%					foreach my $oevent (@ndca) { 
						<option 
							<% $oevent == $event ? "selected" : "" %>
							value="<% $oevent->id %>"
						> <% $oevent->name %> </option>
%					}
				</select>
			</span>

			<span class="third rightalign">
				<input 
					type  = "submit"
					class = "thin"
					name  = "what"
					value = "CSV"
				>
			</span>

			<span class="eighth rightalign">
				<input 
					type  = "submit"
					class = "thin"
					value = "View"
				>
			</span>

			</form>

		</div>

<%perl>
		}

		my @toc;

		foreach my $oevent (sort {$a->name cmp $b->name} @events) {
			next unless ($oevent->setting("bid_round"));
			push @toc, $oevent;
		}

		if (@toc) { 

</%perl>
		<div class="row full marverno padmore">

			<form action="/tabbing/report/toc/post_bids.mhtml" method="post">

				<span class="sixth semibold bluetext padvert">
					TOC Bid Report
				</span>

				<span class="third">
					<select name="event_id" class="fixedmed">

						<option value="">All Events</option>

%						my %done;

%						foreach my $oevent (@toc) { 
							<option 
								<% $oevent == $event ? "selected" : "" %>
								value="<% $oevent->type %>"
							> All <% uc($oevent->type) %> events </option>
%						}
					</select>
				</span>

				<span class="third rightalign">
					<input 
						type  = "submit"
						name  = "view"
						class = "thin"
						value = "Mail to UKY"
					>
				</span>

				<span class="eighth rightalign">
					<input 
						type  = "submit"
						name  = "view"
						class = "thin"
						value = "Print"
					>
				</form>
			</span>

		</div>

%		}

		<br style="clear: both;">

%		if ($tourn_settings->{"ncfl"} && (${$perms}{"owner"} || ${$perms}{"full_admin"}) ) { 

			<h4>
				By Diocese
			</h4>

			<div class="row full marverno padmore">

				<span class="third">
					Diocesan Sweepstakes
				</span>

				<span class="third rightalign">
					<form 
						action = "/tabbing/report/ncfl/show_diocesan_sweeps.mhtml"
						method = "post"
					>
					<input 
						type  = "submit"
						class = "thin"
						name  = "what"
						value = "View"
					>
					</form>
				</span>

				<span class="third rightalign">
					<form 
						action = "/tabbing/report/ncfl/print_diocesan_sweeps.mhtml"
						method = "post"
					>
					<input 
						type  = "submit"
						class = "thin"
						name  = "what"
						value = "Print"
					>
					</form>
				</span>

			</div>

%		}

	</div>

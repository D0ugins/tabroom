<%args>
	$tourn
	$tourn_settings
	$person
	$perms      => undef
	$only_category => undef
</%args>
<%init>

	my $entry_only++ 
		if ${$perms}{"entry_only"};

	$entry_only++ if ${$perms}{"limited"} 
		&! ${$perms}{"registration"};

	my @all_events;
	my @all_timeslots;

	if ($only_category) { 

		@all_events = $only_category->events;

		@all_timeslots = $m->comp(
			"/funclib/category_timeslots.mas", 
			category => $only_category
		);
	} else { 
		@all_events = $tourn->events;
		@all_timeslots = $tourn->timeslots;
	}

	my @debate;
	my @speech;
	my @congress;

	foreach my $event (@all_events) {
		push @debate, $event if $event->type ne"speech" && $event->type ne"congress";
		push @speech, $event if $event->type eq "speech";
		push @congress, $event if $event->type eq "congress";
	}


</%init>

	<& menu.mas, 
		perms          => $perms,
		tourn          => $tourn,
		tourn_settings => $tourn_settings,
		only_category  => $only_category
	&> 

	<div class="main">

		<h2>
			Results Reports
		</h2>

		<h4>
			By Event
		</h4>

		<script>

			function showRounds() { 

				$(".event_rounds").addClass("hidden");
				$(".select_rounds").prop("disabled", true);

				var eventID = $("#prelims_order_event").val();

				if (eventID) { 
					$("."+eventID).removeClass("hidden");
					$(".select_"+eventID).prop("disabled", false);
				} else { 
					$(".timeslots").removeClass("hidden");
					$(".select_timeslots").prop("disabled", false);

				}
			}

			$(document).ready(function() { 
				showRounds();
			});

		</script>

		<div class="row full marverno padmore">
			<form action="prelims_order.mhtml" method="post">
			
			<span class="tenth">
				Seeding:
			</span>

			<span class="threetenths">

				<select 
					name     = "event_id"
					id       = "prelims_order_event"
					class    = "fixedmed"
					onChange = "showRounds();"
				>

					<option value="">All</option>

%					foreach my $event (sort {$a->name cmp $b->name} @all_events) {
						<option 
							value="<% $event->id %>"
							> <% $event->name %> </option>
%					}

				</select>
			</span>

			<span class="threetenths nospace">

				<div class="full timeslots event_rounds">

					<select 
						name     = "timeslot_id"
						class    = "fixedmed select_rounds select_timeslots"
					>

%					foreach my $timeslot (@all_timeslots) { 
						<option
							value="<% $timeslot->id %>"
						><% $timeslot->name %></option>
%					}

					</select>

				</div>

%				foreach my $event (sort {$a->name cmp $b->name} @all_events) {

					<div class="full  <% $event->id %> event_rounds">

						<select 
							name     = "round_id"
							class    = "fixedmed select_rounds select_<% $event->id %>"
						>

%						foreach my $round (sort {$a->name <=> $b->name} $event->rounds) {
							<option
								value="<% $round->id %>"
							><% $round->realname %></option>
%						}

						</select>

					</div>
%				}

			</span>

			<span class="sixth centeralign nospace">

				<label for="ballots">

					<div class="full smallish hover marno">
						w/scores?

						<input 
							type  = "checkbox"
							name  = "ballots"
							id    = "ballots"
							value = "1"
						>
					</div>

				</label>
			</span>

			<span class="sixth rightalign">
				<input 
					type  = "submit"
					class = "thin"
					value = "Print"
				>
				</form>
			</span>

		</div>

		<div class="row full marverno padmore">

			<form action="event_results.mhtml" method="post">

			<span class="sixth">
				Entry Order
			</span>

			<span class="third">

				<select name="event_id" class="fixedmed">

					<option value="all">All Events</option>
%					foreach my $event (sort {$a->name cmp $b->name} @all_events) {
						<option value="<% $event->id %>"> <% $event->name %> </option>
%					}

				</select>
			</span>

			<span class="fourtenths nospace">

				<span class="threefifths">

					<select name="report" class="fixedsmaller">
						<option value="all">All Rounds</option>
						<option value="final">Final Round</option>
						<option value="elims">All Elim Rounds</option>
						<option value="prelims">Prelims</option>
						<option value="prelim_ballots">Prelim Ballots</option>
					</select>

				</span>

				<span class="twofifths smallish">
					Limit <input 
						type  = "number"
						class = "smaller"
						name  = "limit"
						size  = "3"
						min   = "0"
						max   = "999"
					>
				</span>

			</span>

			<span class="tenth rightalign">
				<input 
					type  = "submit"
					class = "thin"
					value = "Print">
				</form>
			</span>

		</div>

		<div class="row full marverno padmore">

			<form 
				action = "awards_ceremony.mhtml"
				method = "post"
			>

			<span class="sixth">
				Awards
			</span>

			<span class="third">

				<select 
					name="event_id" 
					class="fixedmed"
				>

					<option value="all">All Events</option>

%					foreach my $event (sort {$a->name cmp $b->name} @all_events) {
						<option 
							value="<% $event->id %>"
						> <% $event->name %> </option>
%					}

				</select>
			</span>

			<span class="fourtenths nospace">

				<span class="half nospace">
	
					<label for="reverse">

						<div class="full hover padless marno">

							<span class="threequarters nospace smallish">
								Reverse order
							</span>

							<span class="fifth nospace">
								<input
									class = "marless"
									type  = "checkbox"
									id    = "reverse"
									name  = "reverse"
									value = 1
								>
							</span>

						</div>

					</label>

					<label for="names">

						<div class="full hover padless marno">

							<span class="threequarters nospace smallish">
								By Names
							</span>

							<span class="fifth nospace">
								<input
									class = "marless"
									type  = "checkbox"
									id    = "names"
									name  = "names"
									value = 1
								>
							</span>

						</div>

					</label>

				</span>

				<span class="half nospace">

					<span class="half smallish marno padless">
						# Rounds
					</span>

					<span class="half smallish marno padno">
						<input
							type  = "number"
							name  = "cutoff"
							min   = 1
							max   = 10
							class = "smaller"
							size  = 3
						>
					</span>

					<span class="half smallish marno padless">
						# Entries
					</span>

					<span class="half smallish marno padno">
						<input
							type  = "number"
							name  = "entry_cutoff"
							min   = 1
							max   = 999
							class = "smaller"
							size  = 3
						>
					</span>
				</span>
			</span>

			<span class="tenth rightalign">
				<input 
					type  = "submit"
					class = "thin"
					value = "Print"
				>
				</form>
			</span>

		</div>

%		if (@debate) { 

			<div class="row full marverno padmore">

				<form 
					action = "event_speakers.mhtml"
					method = "post"
				>

				<span class="sixth smallish">
					Debate Speakers
				</span>

				<span class="third">

					<select name="event_id" class="fixedmed">

						<option value="all">All Debate Events</option>
%						foreach my $event (@debate) { 
							<option value="<% $event->id %>"> <% $event->name %> </option>
%						}
					</select>
				</span>

				<span class="quarter">
					Limit <input 
						type  = "number"
						class = "smaller"
						name  = "limit"
						size  = "3"
						min   = "0"
						max   = "999"
					>
				</span>

				<span class="eighth rightalign">
					<input 
						type  = "submit"
						name  = "type"
						class = "thin"
						value = "CSV"
					>
				</span>

				<span class="eighth rightalign">
					<input 
						type  = "submit"
						name  = "type"
						class = "thin"
						value = "Print"
					>
					</form>
				</span>

			</div>


			<div class="whitenohover row full marverno padmore">

				<form 
					action = "packet.mhtml"
					method = "post"
				>

				<span class="sixth smallish">
					Debate Packets
				</span>

				<span class="third">

					<select name="event_id" class="fixedmed">
						<option value="all">All Debate Events</option>
%						foreach my $event (sort {$a->name cmp $b->name} @debate) {
							<option value="<% $event->id %>"> <% $event->name %> </option>
%						}
					</select>
				</span>

				<span class="fourtenths nospace">
				</span>

				<span class="tenth rightalign">
					<input 
						type  = "submit"
						class = "thin"
						value = "Print"
					>
					</form>
				</span>

			</div>

			<div class="row full marverno padmore">

				<form 
					action = "reading.mhtml"
					method = "post"
				>

				<span class="sixth">
					Elim Reading
				</span>

				<span class="third">
					<select name="event_id" class="fixedmed">
						<option value="">All Events</option>
%						foreach my $event (sort {$a->name cmp $b->name} @debate) {
							<option value="<% $event->id %>"> <% $event->name %> </option>
%						}
					</select>
				</span>

				<span class="fourtenths nospace">
					<select name="timeslot_id" class="fixedmed">
						<option value="">All Timeslots</option>
%						foreach my $timeslot (sort {$a->start->epoch <=> $b->start->epoch} @all_timeslots) {
							<option value="<% $timeslot->id %>"> <% $timeslot->name %> </option>
%						}
					</select>
				</span>

				<span class="tenth rightalign">
					<input 
						type  = "submit"
						class = "thin"
						value = "Print"
					>
					</form>
				</span>

			</div>


			<div class="row full marverno padmore">

				<form action="readingjudges.mhtml" method="post">

				<span class="sixth">
					Elim Printout
				</span>

				<span class="third">
					<select name="event_id" class="fixedmed">
						<option value="">All Events</option>
%						foreach my $event (sort {$a->name cmp $b->name} @debate) {
							<option value="<% $event->id %>"> <% $event->name %> </option>
%						}
					</select>
				</span>

				<span class="fourtenths nospace">
				</span>

				<span class="tenth rightalign">
					<input 
						type  = "submit"
						class = "thin"
						value = "Print">
					</form>
				</span>

			</div>

			<div class="whitenohover row full marverno padmore">

				<form action="stats.mhtml" method="post">

				<span class="sixth">
					Side Stats
				</span>

				<span class="third">
					<select name="event_id" class="fixedmed">
						<option value="all">All Events</option>
%						foreach my $event (@debate) {
							<option value="<% $event->id %>"> <% $event->name %> </option>
%						}
					</select>
				</span>

				<span class="fourtenths nospace">
					<input 
						type  = "submit"
						name  = "print"
						class = "thin"
						value = "View"
					>
				</span>

				<span class="tenth rightalign">
					<input 
						type  = "submit"
						name  = "print"
						class = "thin"
						value = "Print">
					</form>
				</span>

			</div>

%		}

		<br style="clear: both;">

		<h4>
			By School
		</h4>

		<div class="row full marverno padmore">

			<form action="school.mhtml" method="post">

			<span class="sixth">
				School Report
			</span>

			<span class="third">
				<select name="school_id" class="fixedmed">
					<option value="all">All Schools</option>
%					foreach my $school (sort {$a->name cmp $b->name} $tourn->schools) {
						<option value="<% $school->id %>"> <% $school->name %> </option>
%					}
				</select>
			</span>

			<span class="third">
			</span>

			<span class="eighth rightalign">
				<input 
					type  = "submit"
					class = "thin"
					value = "Print"
				>
			</span>

			</form>

		</div>

%		unless ($tourn_settings->{"ncfl"} &! (${$perms}{"full_admin"} || ${$perms}{"owner"}) ) { 

			<div class="row full marverno padmore">

				<form 
					action="sweep_schools.mhtml" 
					method="post"
				>

				<span class="sixth">
					Sweepstakes
				</span>

				<span class="third">
					<select name="sweep_set_id" class="fixedmed">
%						foreach my $set (sort {$a->name cmp $b->name} $tourn->sweep_sets) {
							<option value="<% $set->id %>"> <% $set->name %> </option>
%						}
					</select>
				</span>

				<span class="third rightalign">
					<input 
						type  = "submit"
						class = "thin"
						name  = "what"
						value = "View"
					>
				</span>

				<span class="eighth rightalign">
					<input 
						type  = "submit"
						class = "thin"
						name  = "what"
						value = "Print"
					>
				</span>

				</form>

			</div>

			<br style="clear: both;">

			<h4>
				By Entry
			</h4>

			<div class="row full marverno padmore">

				<form action="sweep_students.mhtml" method="post">

				<span class="sixth">
					Sweepstakes
				</span>

				<span class="third">
					<select 
						name  = "sweep_set_id"
						class = "fixedmed"
					>

%						foreach my $set (sort {$a->name cmp $b->name} $tourn->sweep_sets) {
							<option 
								value="<% $set->id %>"
							> <% $set->name %> </option>
%						}
					</select>
				</span>

				<span class="third rightalign">
					<input 
						type  = "submit"
						class = "thin"
						name  = "what"
						value = "View"
					>
				</span>

				<span class="eighth rightalign">
					<input 
						type  = "submit"
						class = "thin"
						name  = "what"
						value = "Print"
					>
				</span>

				</form>

			</div>

			<div class="row full marverno padmore">

				<form action="ndca/points.mhtml" method="post">

				<span class="sixth">
					NDCA Points
				</span>

				<span class="third">
					<select name="event_id" class="fixedmed">

<%perl>

						foreach my $event (sort {$a->name cmp $b->name} @all_events) {

							next unless ($event->setting("dukesandbailey") 
								|| $event->setting("baker") 
								|| $event->setting("ndca_public_forum")
							);

							next if $event->type eq "speech";
							next if $event->type eq "congress";
							next if $event->type eq "wudc";
							next if $event->type eq "roundrobin";
</%perl>
							<option value="<% $event->id %>"> <% $event->name %> </option>
%						}
					</select>
				</span>

				<span class="third rightalign">
					<input 
						type  = "submit"
						class = "thin"
						name  = "what"
						value = "CSV"
					>
				</span>

				<span class="eighth rightalign">
					<input 
						type  = "submit"
						class = "thin"
						value = "View"
					>
				</span>

				</form>

			</div>

			<div class="row full marverno padmore">

				<form action="/tabbing/report/toc/post_bids.mhtml" method="post">

					<span class="sixth">
						TOC Bid Report
					</span>

					<span class="third">
						<select name="event_id" class="fixedmed">

							<option value="">All Events</option>

%							my %done;

%							foreach my $event (sort {$a->name cmp $b->name} @all_events) {
%								next unless ($event->setting("bid_round"));
%								next if $done{$event->type}++;
								<option 
									value="<% $event->type %>"
								> All <% uc($event->type) %> events </option>

%							}

%							foreach my $event (sort {$a->name cmp $b->name} @all_events) {
%								next unless ($event->setting("bid_round"));
								<option 
									value="<% $event->id %>"
								> <% $event->name %> </option>
%							}
						</select>
					</span>

					<span class="third rightalign">
						<input 
							type  = "submit"
							name  = "view"
							class = "thin"
							value = "Mail to UKY"
						>
					</span>

					<span class="eighth rightalign">
						<input 
							type  = "submit"
							name  = "view"
							class = "thin"
							value = "Print"
						>
					</form>
				</span>

			</div>


			<br style="clear: both;">
%		}

%		if ($tourn_settings->{"ncfl"} && (${$perms}{"owner"} || ${$perms}{"full_admin"}) ) { 

			<h4>
				By Diocese
			</h4>

			<div class="row full marverno padmore">

				<span class="third">
					Diocesan Sweepstakes
				</span>

				<span class="third rightalign">
					<form 
						action = "/tabbing/report/ncfl/show_diocesan_sweeps.mhtml"
						method = "post"
					>
					<input 
						type  = "submit"
						class = "thin"
						name  = "what"
						value = "View"
					>
					</form>
				</span>

				<span class="third rightalign">
					<form 
						action = "/tabbing/report/ncfl/print_diocesan_sweeps.mhtml"
						method = "post"
					>
					<input 
						type  = "submit"
						class = "thin"
						name  = "what"
						value = "Print"
					>
					</form>
				</span>

			</div>

%		}

	</div>

<%flags>
#	inherit => undef
</%flags>

<html>

<head>
	<title>Error</title>
</head>

<body>

<div class="main">

	<h2>Well, that's just unfortunate</h2>

	<p>
		Looks like you just tripped over a bug in tabroom.com.
	</p>
		
	<p>
		Please, <span class="inline semibold redtext">do not send this bug
		report to us.</span>.  The bug has automatically been logged!  Emailing
		it in doesn't help, and just adds to my already daunting email intake.
	</p>

	<p>
		If you have further questions though, please do 
		contact us at <a href="mailto:help@tabroom.com">help@tabroom.com</a>.
	</p>

	<p>	
		Otherwise, your browser's back button will get you where you want to be.
	</p>

	<h4>Error text:</h4>

	<pre>
		<% $error_text %>
	</pre>

</div>

</body>
</html>

<%init>

	use Apache2::URI;
	use APR::URI;
	use MIME::Lite;
	use UNIVERSAL::can;

	my $error = $r->pnotes('error');

	my $error_text = "Page is " . $r->parsed_uri->unparse . "\n\n";

	$error_text .= UNIVERSAL::can( $error, 'as_text' ) ? $error->as_text : $error;

	$r->log_error($error_text);

	my $mail = MIME::Lite->new
	        ( From    => 'error-handler@tabroom.com',
	          To      => 'errors@tabroom.com',
	          Subject => 'Bug tripped on '.$Tab::url_prefix,
	          Data    => $error_text,
	        );

	$mail->send;
</%init>


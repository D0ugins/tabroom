<%args>
	$tourn_id
	$category_id => undef
	$person        => undef
</%args>
<%init>

	my $key = $tourn_id."-".$category_id;
	return if $m->cache_self( 
		key        => $key,
		expires_in => '15m'
	);

	my $tourn =  Tab::Tourn->retrieve(int($tourn_id));
	my $category =  Tab::Category->retrieve(int($category_id));

	$m->abort unless ($category);
	$tourn = $category->tourn unless $tourn;

	Tab::Category->set_sql( field_reports => "
		select category.* from category, category_setting
		where category.tourn = ?
		and category.id = category_setting.category
		and category_setting.tag = 'field_report'
		and category_setting.value = 1
		order by category.name
	");

	my @categories = Tab::Category->search_field_reports($tourn->id);

	$category = $categories[0] unless $category;

    my $webpage = Tab::Webpage->search( 
		tourn   => $tourn_id,
		special => "fields"
	)->first;

	my $switch;

</%init>

	<div class="main">

		<& title.mas, tourn => $tourn &>

        <& tabbar.mas, 
			tourn  => $tourn,
			person => $person,
			whoami => "judges"
		&>

%		if ($category) { 

%			my @judges = sort {$a->last cmp $b->last} $category->judges(active => 1);

%			foreach my $judge (@judges) { 

<%perl>

				next unless $judge->person;
				my $paradigm = $judge->person->setting("paradigm");
				$paradigm =~ s/font-size: x-small;//g;
				$paradigm =~ s/font-size: xx-small;//g;
				$paradigm =~ s/font-size: small;//g;
				$paradigm =~ s/font-size: medium;//g;
				$paradigm =~ s/font-size://g;

</%perl>

			<div class="bordertop">
				<span class="threequarter">
					<h4><% $judge->first." ".$judge->last %> Paradigm </h4>
				</span>

				<span class="quarter" style="vertical-align: top;">
					<h4 style="text-align: right;">
%						if ( ($judge->obligation + $judge->hired) > 0) { 
							<% $judge->obligation + $judge->hired %> rounds
%						}
					</h4>
				</span>
			</div>

				<div class="paradigm">
					<% $paradigm ? $paradigm : "Not Submitted" %>
				</div>

%			}

%		}

	</div>

	<div class="menu">
	
		<div class="sidenote">

			<h4>Judges</h4>

%			foreach my $other_category (sort {$a->name cmp $b->name} @categories) { 

				<a 
					class="blue block" 
					href="/index/tourn/judges.mhtml?tourn_id=<% $tourn_id %>&category_id=<% $other_category->id %>">
					<% $other_category->name %> list
				</a>

				<a class="<% ($other_category->id == $category_id ) ? "dk" : "" %>blue half " 
					href="/index/tourn/paradigms.mhtml?tourn_id=<% $tourn_id %>&category_id=<% $other_category->id %>">
					<% $other_category->abbr %> paradigms
				</a>
				
				<a class="blue half right " 
					href="/index/tourn/paradigms_print.mhtml?tourn_id=<% $tourn_id %>&category_id=<% $other_category->id %>">
					PDF
				</a>

%			}
	
		</div>

	</div>


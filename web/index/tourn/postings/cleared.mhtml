<%args>
	$round_id => undef
	$person => undef
</%args>
<%init>

	my $key = $round_id;
	return if $m->cache_self( key => $key, expires_in => '4m' );

	$m->abort unless $round_id;
	
	my $round = Tab::Round->retrieve($round_id);

	unless ($round) { 
		$m->print("No round entered, try again");
		$m->abort;
	}

	my $tourn = $round->event->tourn if $round;

	unless ($round->setting("publish_entry_list") || ($person && $person->site_admin) ) { 

		$m->print("<div class='main'>");
		$m->print("<p class='err'>This round's clearing list  has not been published.</p>");
		$m->print("</div>");
		$m->abort;
	}

	my $start = $round->start_time;
	$start = $round->timeslot->start unless $start;

</%init>

	<& menu.mas, 
		tourn_id => $tourn->id, 
		event_id => $round->event->id, 
		round_id => $round_id &>

	<div class="main">

		<& /index/tourn/title.mas, 
			tourn => $tourn 
		&>

        <& /index/tourn/tabbar.mas, 
			tourn  => $tourn,
			person => $person
		&>

		<div class="full">

			<span class="half">
				<h4>
					Advancing to <% $round->event->name %> 
					<% ($round->label) ? $round->label : "Round ".$round->name %>
				</h4>
			</span>

			<span class="half">
				<h5 class="rightalign">
					Round at <% &Tab::niceshortdayt($start->set_time_zone($tourn->tz)) %>
				</h5>
			</span>

		</div>

%		if ($round->setting("notes")) { 

			<div class="lightrow centeralign padtop padbottom strong redtext marbottommore">
				<% $round->setting("notes") %>
			</div>

			<br />

<%perl>

		}

		my @entries = $m->comp("/funclib/round_entries.mas", round => $round);

		my %panel_count;

		foreach my $entry (@entries) { 
			$panel_count{$entry->panelid}++;
		}

 		foreach my $entry (sort {$a->code cmp $b->code} @entries) { 

			next if $panel_count{$entry->panelid} == 1;
</%perl>
	    
			<span class="half padtop padbottom">
				<% $entry->code %>
			</span>
%		}

	</div>

<%args>
	$district_id => undef
</%args>
<%init>

	my $district = Tab::District->retrieve($district_ref->{id});
	my %schools_by_nsda_id = map {$_->nsda => $_} $district->chapters;

	my $dbh = Tab::DBI->db_Main();
	my $sth = $dbh->prepare("update chapter set district = ? where nsda = ?");
	my $search_sth = $dbh->prepare("select chapter.id from chapter where nsda = ?");

	my ($schools_ref, $school_raw) = $m->comp("api_client.mas",
		path => "/districts/".$district->{id}."/schools"
	);

	#Updates the linked schools
	my @empty_schools;

	if ($schools_ref) {

		foreach my $school (@{$schools_ref}) {
			$sth->execute($district->id, $school->{school_id});
			$search_sth->execute($school->{school_id});

			unless ($search_sth->fetch()) {
				push @empty_schools, $school;
			}
		}
	}

	return @empty_schools;

</%init>

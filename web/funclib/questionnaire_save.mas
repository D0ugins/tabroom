<%args>
	$tag     => undef
	$judge   => undef
	$response => undef
</%args>
<%init>

	use Switch;
	use Data::Dumper;

	return unless $tag;

	$tag =~ s/[\W_]//g;

	my %form = $m->comp(
		"/funclib/questions.mas", 
		tag => $tag
	);

	return unless %form;
	my %answers;

	Tab::debuglog("Save is $tag");

	foreach my $key (keys %{$form{"questions"}}) { 

		my $answer;
		
		switch ($form{"questions"}{$key}{"type"}) {

			case "string" { 
				$answers{$key} = $response->{$key};
			}

			case "textbox" { 
				$answers{$key} = $response->{$key};
			}
			case "number" { 
				$answers{$key} = $response->{$key};
			}

			case "radio" { 
				$answers{$key} = $response->{$key};
			}

			case "boolean" { 
				$answers{$key} = $response->{$key};
			}

			case "checkbox" { 
				foreach my $answer (@{$form{"questions"}{$key}{"answers"}}) {
					$answers{$key."_".$answer} = $response->{$key."_".$answer};
				}
			}
		}
	}

	my $json = eval { 
		return JSON::encode_json(\%answers);
	};

	if ($json) { 
		$judge->setting(
			"form_".$tag,
			"text", 
			$json
		);
	}

	my $msg = "Answers saved!";

	return $msg; 

</%init>

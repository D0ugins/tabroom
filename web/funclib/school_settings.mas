<%args>
	$tourn
	$value => undef
</%args>
<%init>

	return unless $tourn > 0;

	Tab::SchoolSetting->set_sql( all_by_tourn => "
		select distinct school_setting.*
		from school_setting, school
		where school.tourn = ? 
		and school.id = school_setting.school
	");

	my %settings;

	foreach my $setting (
		Tab::SchoolSetting->search_all_by_tourn($tourn->id)
	) { 

		if ($value && $setting) { 

			$settings{$setting->school->id}{$setting->tag} = $setting->value;

			$settings{$setting->school->id}{$setting->tag} = $setting->value_date 
				if $setting->value eq "date";

			$settings{$setting->school->id}{$setting->tag} = $setting->value_text
				if $setting->value eq "text";

		} else { 
			$settings{$setting->school->id}{$setting->tag} = $setting;
		}
	}

	return %settings;


</%init>

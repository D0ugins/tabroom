<%args>
	$round 
</%args>
<%init>

	my $dbh = Tab::DBI->db_Main();

	my $double_entry_sth = $dbh->prepare("
		select entry.id, count(other.id)

		from entry, entry_student es, ballot, panel, round, timeslot,
			entry other, entry_student os, ballot ob, panel op, round oround, timeslot ot

		where entry.id     = ballot.entry
		and ballot.panel   = panel.id
		and panel.round    = round.id
		and round.id       = ?
		and round.timeslot = timeslot.id

		and timeslot.tourn = ot.tourn

		and timeslot.start < ot.end
		and timeslot.end > ot.start

		and ot.id      = oround.timeslot
		and oround.id  = op.round
		and op.id      = ob.panel
		and ob.entry   = other.id
		and os.student = es.student

	");

	my %doubled_entries; 

	$double_entry_sth->execute($round->id);

    while ( my ($entry_id, $count) = $double_entry_sth->fetchrow_array() ) { 

		$doubled_entries{$entry_id} = $count;
	}

	return %doubled_entries;

</%init>

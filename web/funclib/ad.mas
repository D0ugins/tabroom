<%init>

    Tab::Ad->set_sql( current => "
        select ad.*
        from ad
        where ad.start <  NOW()
        and ad.end > NOW()
        and ad.approved = 1
		order by ad.sort_order
    ");

    my @ads = List::Util::shuffle(Tab::Ad->search_current());

	return unless @ads;

</%init>

	<script>
		$(document).ready(function(){
			$('.slick_ads').slick({
				vertical       : true,
				slidesToShow   : 1,
				slidesToScroll : 1,
				arrows         : false,
				autoplay       : true,
				autoplaySpeed  : 8400,
				draggable      : false
			});
		});
	</script>

<%doc>

	This script has moved to its own module, external_ad.mas, because it was chaotic evil. -CLP 12/1/18

	<script type="text/javascript">
		// Ad injection script from Nicole - ATH 10/15/18
		(function() {
			var s   = document.createElement('script');
			s.type  = 'text/javascript';
			s.async = true;
			var x   = document.getElementsByTagName('script')[0];
			s.src   = '//nextmillennium.liqwid.net/?key=D85D-A6F1-B041-B88A';
			x.parentNode.insertBefore(s,x);i
		})();
	</script>
</%doc>

	<div class="tabad_carousel">
		<div class="slick_ads">
%			foreach my $ad (@ads) {
				<div class="centeralign carousel row">
%					if ($ad->url) {
						<a
							target = "_blank"
							href   = "<% $ad->url %>"
						><img src="<% $Tab::s3_base %>/ads/<% $ad->id %>/<% $ad->filename %>"></a>
%					} else {
						 <img src="<% $Tab::s3_base %>/ads/<% $ad->id %>/<% $ad->filename %>">
%					}
				</div>
%			}
		</div>
	</div>


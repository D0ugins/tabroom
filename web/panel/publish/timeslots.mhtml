<%args>
	$tourn
	$category_id => undef
</%args>
<%init>

	my $category = Tab::Category->retrieve($category_id) if $category_id;
	my @categories = sort {$a->name cmp $b->name} $tourn->categories;
	$category = $categories[0] if @categories &! $category;
	$category_id = $category->id if $category;

	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;

	my $switch;

</%init>

	<div class="main">

%		if ($category) { 

			<h2>Publish <% $category->name %> timeslots</h2>

			<table cellpadding="4" cellspacing="1">

				<tr class="yellowrow">
					
					<th class="smaller centeralign padno">
						Timeslot
					</th>

					<th class="smaller centeralign padno">
						Starts
					</th>

					<th class="smaller">
						Rounds Private
					</th>

					<th class="smaller">
						Rounds Public
					</th>

					<th class="smaller">
						Results Public
					</th>

					<th class="smaller">
					</th>

					<th class="smaller">
					</th>

				</tr>

%				foreach my $timeslot ($m->comp("/funclib/category_timeslots.mas", category => $category)) { 

%					my @rounds = $timeslot->rounds;
%					my @no;
%					my @publish;
%					my @results;

%					foreach my $round (@rounds) { 
%						push @no, $round if $round->published < 1 && $round->post_results < 1;
%						push @publish, $round if $round->published > 0 && $round->post_results < 1;
%						push @results, $round if $round->post_results > 0;
%					}

					<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">

						<td class="smaller centeralign padno">
							<% $timeslot->name %>
						</td>

						<td class="smaller centeralign padno">
							<% Tab::nicetime($timeslot->start->set_time_zone($tz)) %>
						</td>

						<td class="smaller">
%							foreach my $no (@no) { 
								<div>
									<% $no->event->abbr." ".$no->realname %>
								</div>
%							}
						</td>

						<td class="smaller">
%							foreach my $publish (@publish) { 
								<div>
								<% $publish->event->abbr." ".$publish->realname %>
								</div>
%							}
						</td>

						<td class="smaller">
%							foreach my $results (@results) { 
								<div>
									<% $results->event->abbr." ".$results->realname %>
								</div>
%							}
						</td>

						<td class="smallish centeralign top">

							<a class="bluetext buttonwhite hover thin martop"
							href="timeslot_save.mhtml?timeslot_id=<% $timeslot->id %>&category_id=<% $category_id %>">
								Publish All
							</a>

							<br />

							<a class="bluetext buttonwhite hover thin martop"
							href="blast.mhtml?timeslot_id=<% $timeslot->id %>&category_id=<% $category_id %>&result=1">
								Blast All 
							</a>

							<br />
							<a class="bluetext buttonwhite hover thin martop"
							href="timeslot_save.mhtml?timeslot_id=<% $timeslot->id %>&category_id=<% $category_id %>&result=1">
								All Results
							</a>
						</td>

						<td class="smallish centeralign top">

							<a class="redtext buttonwhite hover thin martop"
							href="timeslot_save.mhtml?timeslot_id=<% $timeslot->id %>&category_id=<% $category_id %>&undo=1">
								Unpublish All
							</a>

							<br />
							<a class="redtext buttonwhite hover thin martop"
							href="timeslot_save.mhtml?timeslot_id=<% $timeslot->id %>&category_id=<% $category_id %>&result=1&undo=1">
								Undo Results
							</a>

						</td>

					</tr>

%				}

			</table>

%		}

	</div>

	<div class="menu">
	
		<div class="sidenote">

			<h4>Judge Category</h4>

%			foreach my $category ($tourn->categories) { 

				<a class="<% $category->id == $category_id? "dk" : ""%>blue nowrap block" href="timeslots.mhtml?category_id=<% $category->id %>">
					<% $category->name %>
				</a>
%			}

			<a href="index.mhtml" class="martop yellow block">
				By Division
			</a>

		</div>

	</div>
		

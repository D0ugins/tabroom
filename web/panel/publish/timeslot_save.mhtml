<%args>
	$timeslot_id
	$result      => undef
	$category_id => undef
	$undo        => undef
	$entryonly   => undef
</%args>
<%init>

	my $timeslot = Tab::Timeslot->retrieve($timeslot_id);


	foreach my $round ($timeslot->rounds) {

		if ($undo) {
			$round->published(0);
			$round->post_results(0) if $result;
		} elsif ($entryonly) {
			$round->published(2);
		} else {
			$round->published(1);
			$round->post_results(2) if $result;
		}

		$round->update();
		$m->comp('/funclib/cache_invalidate.mas', round => $round);
	}

	my $msg = "Rounds published in timeslot ".$timeslot->name;
	$msg = "Rounds undo $undo published in timeslot ".$timeslot->name if $undo;

	$m->redirect("timeslots.mhtml?category_id=$category_id&msg=$msg");

</%init>

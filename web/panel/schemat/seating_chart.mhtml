<%args>
	$person
	$person_settings
	$tourn
	$tourn_settings
	$round_id => undef
	$perms    => undef
	$default  => "seating"
</%args>
<%init>

	my $round = Tab::Round->retrieve($round_id) if $round_id;

	unless ($round) { 
		my $msg = "No valid round ID recieved.  Please hit back and try again";
		$m->comp("/funclib/abort.mas", message => $msg);
	}

	my %round_settings = $round->all_settings;

	my $event = $round->event;
	my %event_settings = $event->all_settings;

	my $category = $event->category if $event;
	my %category_settings = $category->all_settings;

	my @panels = sort {$a->letter <=> $b->letter} $round->panels;

	my @tabs = ("rooms", "seating");

</%init>

	<div class="main">

		<div class="nospace">
		
			<span class="twofifth nowrap">
				<h2><% $round->realname %> Seating Charts</h2>
			</span>

			<span class="threefifth nowrap">
			
				<span class="threefifths leftalign">
				</span>

			</span>

		</div>

		<& "/funclib/tabs.mas", 
			tabs => \@tabs,
			default => "seating"
		&>

		<div 
			id="rooms" 
			class="screens hidden rooms"
		>

			<form 
				action = "seating_rooms_save.mhtml"
				method = "post"
			>

			<input 
				type  = "hidden"
				name  = "round_id"
				value = "<% $round->id %>"
			>

			<div class="nospace full">

				<span class="third nospace">
					<h4>Room Configurations</h4>
				</span>

				<span class="twothirds rightalign nospace">

					<span class="sixth nospace rightalign">
						All rooms
					</span>

					<span class="third centeralign">
						Rows
						<input 
							type  = "number"
							class = "thin"
							min   = "0"
							max   = "99"
							name  = "all_rows"
							value = ""
						>
					</span>

					<span class="third centeralign">
						Seats per:
						<input 
							type  = "number"
							class = "thin"
							min   = "0"
							max   = "99"
							name  = "all_seats"
							value = ""
						>
					</span>

					<span class="sixth">
						<input 
							type  = "submit"
							class = "thin"
							value = "Save"
						>
					</span>
				</span>
			</div>

			<& "/funclib/tablesorter.mas", table => "room_configs" &>

			<table id="room_configs">

				<thead>

					<tr class="yellowrow">
						
						<th>
							Chamber
						</th>

						<th>
							Room
						</th>

						<th>
							# Entries
						</th>

						<th>
							# Rows
						</th>

						<th>
							# Seats
						</th>

					</tr>

				</thead>

				<tbody>
<%perl>

			foreach my $panel (@panels) { 

				my $room = $panel->room;

				my @entries = $m->comp(
					"/funclib/panel_entries.mas", 
					panel => $panel
				);

				if ($room && $room->id) {  

</%perl>
					<tr>

						<td>
							<% $panel->letter %>
						</td>

						<td>
							<% $room->name %>
						</td>

						<td>
							<% scalar @entries %>
						</td>

						<td class="padless centeralign">
							<input 
								type  = "number"
								class = "thin"
								min   = "0"
								max   = "99"
								name  = "<% $room->id %>_rows"
								value = "<% $room->rows %>"
							>
						</td>

						<td class="padless centeralign">
							<input 
								type  = "number"
								class = "thin"
								min   = "0"
								max   = "99"
								name  = "<% $room->id %>_seats"
								value = "<% $room->seats %>"
							>
						</td>

					</tr>

%				} else { 


					<tr>
						<td colspan="5" class="centeralign">
							No room assigned to chamber
						</td>
					</tr>
%				} 

%			}

			</tbody>

			<tr class="liblrow">

				<td
					colspan = "5"
					class   = "rightalign"
				>
					<input 
						type  = "submit"
						value = "Save Room Configs"
					>
					</form>
				</td>

			</tr>

			</table>

		</div>


	</div>


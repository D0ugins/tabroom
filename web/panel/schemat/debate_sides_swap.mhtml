<%args>
	$tourn
	$panel_id
</%args>
<%init>

	my $switch;

	my $panel = Tab::Panel->retrieve($panel_id);

	unless ($panel) { 
		$m->print("You did not select an existing panel.  Hit back and try again");
		$m->abort;
	}

	$m->comp("/panel/manipulate/zero_sides.mas", panel => $panel, source => "switch_sides");

	my @affs = Tab::Ballot->search( panel => $panel_id, side => 1);
	my @negs = Tab::Ballot->search( panel => $panel_id, side => 2);

	my %done;

	if (scalar @affs > 1 && (scalar @negs < 1)) { 
		my $oops = pop @affs;
		push @negs, $oops;
	}
	if (scalar @negs > 1 && (scalar @affs < 1)) { 
		my $oops = pop @negs;
		push @affs, $oops;
	}

	foreach my $aff (@affs) { 
		$aff->side(2);
		$aff->update;
		$done{$aff}++;
	}

	foreach my $neg (@negs) { 
		$neg->side(1);
		$neg->update;
		$done{$neg}++;
	}

	my $msg = "Sides have been swapped. <br /><br /> If results were entered, the entry ";
	$msg .= " judge has voted for has not changed; the side they voted for has.";
	$m->redirect("panel_view.mhtml?panel_id=$panel_id&msg=$msg");

</%init>


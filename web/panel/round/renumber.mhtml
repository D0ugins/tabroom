<%args>
	$round_id => undef
	$tourn
	$person
</%args>
<%init>

	my $round = Tab::Round->retrieve($round_id);

	unless ($round) {
		$m->comp("/funclib/abort.mas", message => "No round found for ID $round_id");
	}

	Tab::Panel->columns(TEMP => "judgename");

	my @panels = $round->panels;

	foreach my $panel (@panels) {
		my $judge = $panel->ballots->first->judge;
		$panel->judgename($judge->last);
	}

	my $letter;

	foreach my $panel (
		sort {
			$a->bye <=> $b->bye
			|| $a->flight <=> $b->flight
			|| $a->judgename cmp $b->judgename
		} @panels
	) {
		$letter++;
		$panel->letter($letter);
		$panel->update();
	}

	my $msg = "Sections assigned and renumbered by flight";
	$m->redirect("/panel/schemat/show.mhtml?round_id=".$round->id."&disp=1&msg=$msg");

</%init>

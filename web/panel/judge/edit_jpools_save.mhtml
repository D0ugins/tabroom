<%args>
	$tourn
	$tourn_settings
	$perms
	$person
	$session
	$defaults => undef
	$category_id => undef
	$jpool_id    => undef
	$event_id    => undef
</%args>
<%init>


	my ($event, $eventsref,
		$category, $categoriesref,
		$jpool, $jpoolsref, $jpool_settingsref,
		$childrenref) = $m->comp("pools.mas",
			tourn       => $tourn,
			session     => $session,
			defaults    => $defaults,
			nsda_nats   => $tourn_settings->{"nsda_nats"},
			perms       => $perms,
			jpool_id    => $jpool_id,
			event_id    => $event_id,
			category_id => $category_id,
		);

	foreach my $jpool (@{$jpoolsref}) {

		$jpool->name($ARGS{"name_".$jpool->id});
		$jpool->site($ARGS{"site_".$jpool->id});
		$jpool->parent($ARGS{"parent_".$jpool->id});
		$jpool->update;

		$jpool->setting("code", $ARGS{"code_".$jpool->id});
		$jpool->setting("code", 0) unless $ARGS{"code_".$jpool->id};

		$jpool->setting("rounds", $ARGS{"rounds_".$jpool->id});
		$jpool->setting("rounds", 0) unless $ARGS{"rounds_".$jpool->id};


		$jpool->setting("show_judges", $ARGS{"show_judges_".$jpool->id});
		$jpool->setting("show_judges", 0) unless $ARGS{"show_judges_".$jpool->id};

		$jpool->setting("message", "text", $ARGS{"message_".$jpool->id});
		$jpool->setting("message", 0) unless $ARGS{"message_".$jpool->id};

		$jpool->setting("publish", $ARGS{"publish_".$jpool->id});
		$jpool->setting("publish", 0) unless $ARGS{"publish_".$jpool->id};

		$jpool->setting("standby", $ARGS{"standby_".$jpool->id});
		$jpool->setting("standby", 0) unless $ARGS{"standby_".$jpool->id};

		$jpool->setting("standby_timeslot", $ARGS{"standby_timeslot_".$jpool->id});
		$jpool->setting("standby_timeslot", 0) unless $ARGS{"standby_timeslot_".$jpool->id};
	}


	my $msg = "Pool settings saved";
	$m->redirect("edit_jpools.mhtml?event_id=".$event."&category_id=".$category->id."&msg=$msg");

</%init>

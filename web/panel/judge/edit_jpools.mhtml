<%args>
	$tourn
	$tourn_settings
	$person
	$jpool_id         => undef
	$category_id      => undef
	$only_category    => undef
	$pull_category_id => undef
</%args>
<%init>

	my $jpool = Tab::JPool->retrieve($jpool_id);

	my $category = Tab::Category->retrieve($category_id);

	$category = $only_category if $only_category;

	my @sites = $m->comp('/funclib/tourn_sites.mas', tourn => $tourn);

	my @timeslots = 
		sort {$a->start->epoch <=> $b->start->epoch} 
		$tourn->timeslots;

	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;

	$m->abort unless $category;

	my @jpools = sort {$a->name cmp $b->name} $category->jpools;

	unless ($jpool) { 
		$jpool = $jpools[0] if @jpools;
	}

</%init>

    <script type="text/javascript"> 
        function showMe (it, box) { 
            var vis = (box.checked) ? "inline-block" : "none"; 
            document.getElementById(it).style.display = vis;
        } 
    </script>

	<& "menu.mas",
		tourn          => $tourn,
		tourn_settings => $tourn_settings,
		category       => $category,
		whoami         => "edit_jpools",
		jpool          => $jpool,
		only_category  => $only_category
	&>

	<div class="main">

%		unless ($category) { 

			<h2>Choose a judge category at right</h2>
	
%		} else {

			<h2><% $category->name %></h2>
			
			<& "tabbar.mas", 
				category => $category,
				whoami   => "edit_jpools"
			&>

			<form 
				action = "edit_jpools_save.mhtml"
				method = "post"
			>

			<input 
				type  = "hidden"
				value = "<% $category->id %>"
				name  = "category_id"
			>

%			foreach my $jpool (@jpools) { 

				<div class="row">
					
					<span class="fifth">
						<input 
							type  = "text"
							size  = "18"
							value = "<% $jpool->name %>"
							name  = "name_<% $jpool->id %>"
						>
					</span>

					<span class="half padno">

%						my $spansize = "third";

%						if ($tourn_settings->{"nsda_nats"}) { 

%							$spansize = "quarter";

							<span class="<% $spansize %> smallish centeralign">
								Code:
								<input 
									type  = "text"
									size  = "4" 
									id    = "code_<% $jpool->id %>"
									name  = "code_<% $jpool->id %>"
									value = "<% $jpool->setting("code") %>"
								>
							</span>

							<span 
								class = "<% $spansize %> smallish centeralign"
								title = "Rounds of obligations this pool satisfies"
							>
								Rounds
								<input 
									type  = "text"
									size  = "4" 
									id    = "rounds_<% $jpool->id %>"
									name  = "rounds_<% $jpool->id %>"
									value = "<% $jpool->setting("rounds") %>"
								>
							</span>
%						}

						<label for="publish_<% $jpool->id %>">

							<span class="<% $spansize %> smallish hover marno">

								Publish:

								<input 
									type  = "checkbox"
									value = "1"
									id    = "publish_<% $jpool->id %>"
									name  = "publish_<% $jpool->id %>"
									<% $jpool->setting("publish") ? 'checked="checked"' : "" %> 
								>
							</span>
						</label>

%						my $standby_click = "showMe('standby_ts_".$jpool->id."', this)";

						<label for="standby_<% $jpool->id %>">
							<span class="<% $spansize %> smallish hover">
								Standby:

								<input 
									type    = "checkbox"
									value   = "1"
									id      = "standby_<% $jpool->id %>"
									onclick = "<% $standby_click %>"
									name    = "standby_<% $jpool->id %>"
									<% $jpool->setting("standby") ? 'checked="checked"' : "" %>
								>
							</span>
						</label>

						<span <% 	$jpool->setting("standby") 
										? "display: inline-block;" 
										: 'style="display: none;"' 
									%> 
							class="<% $spansize %> smallish hover" 
							id="standby_ts_<% $jpool->id %>"
						>

							<select 
								name="standby_timeslot_<% $jpool->id %>" 
								class="fixedtiny plain"
							> 

								<option value="">Choose When:</option>

%								foreach my $timeslot ($tourn->timeslots) { 

									<option value="<% $timeslot->id %>" 
										<% $jpool->setting("standby_timeslot") 
											&& $timeslot->id == $jpool->setting("standby_timeslot") 
											? 'selected="selected"' 
											: "" %>
									><% $timeslot->name %></option>
%	                      		}
							</select>
						</span>
					</span>

%					if (scalar @sites > 0) { 

						<span class="threetenths nospace">

							<span class="seveneighths nospace">

								<select 
									name="site_<% $jpool->id %>" 
									class="fixedsmall"
								>
%									foreach my $site (@sites) { 
										<option value="<% $site->id %>" 
											<% $site->id == $jpool->site->id 
												? 'selected="selected"' : "" %>
										><% $site->name %></option>
%									}
								</select>
							</span>
							<span class="eighth nospace rightalign">


%								my $warn = "Really delete the pool ".$jpool->name." and all round and judge assignments?";

								<a 
									class="buttonwhite fa  fa-trash redtext hover" 
									href="jpool_rm.mhtml?jpool_id=<% $jpool->id %>&category_id=<% $category_id %>"
									<& "/funclib/confirm.mas", warn => $warn &>  >
								</a>

							</span>
						</span>

%					}  else { 

						<span class="quarter rightalign nospace">

%							my $warn = "Really delete the pool ".$jpool->name." and all round and judge assignments?";

							<a 
								class="buttonwhite fa  fa-trash redtext hover" 
								href="jpool_rm.mhtml?jpool_id=<% $jpool->id %>&category_id=<% $category_id %>"
								<& "/funclib/confirm.mas", warn => $warn &> 
							>
							</a>
						</span>

%					}  


				</div>

%			}
			

			<div class="liblrow rightalign">
				<input type="submit" value=" Save Pools">
			</div>

%		}

	</div>


<%args>
	$tourn
	$tourn_settings
	$person
	$perms
	$session
	$defaults
	$jpool_id      => undef
	$event_id      => undef
	$category_id   => undef
	$only_category => undef
</%args>
<%init>

	$category_id = int($category_id);

	my ($event, $eventsref,
		$category, $categoriesref,
		$jpool, $jpoolsref, $jpool_settingsref,
		$childrenref) = $m->comp("pools.mas",
			tourn       => $tourn,
			nsda_nats   => $tourn_settings->{"nsda_nats"},
			perms       => $perms,
			jpool_id    => $jpool_id,
			event_id    => $event_id,
			session     => $session,
			defaults    => $defaults,
			category_id => $category_id
		);

	my $whoami = "index" if $category;

	unless ($tourn_settings->{"nsda_nats"}) {
		undef $jpool unless $jpool_id;
	}

	my @timeslots;
	my $nats_category++ if $category && $category->setting("nats_category");

	if ($event) {
		@timeslots = $m->comp("/funclib/event_timeslots.mas", event => $event);
	} else {
		@timeslots = $m->comp("/funclib/category_timeslots.mas", category => $category);
	}

	my ($max_judges, $max_sections, $max_timeslot, $max_timeslot_name) =
		$m->comp("/funclib/category_max_judges.mas", category => $category);

</%init>

	<& "menu.mas",
		tourn             => $tourn,
		perms             => $perms,
		event             => $event,
		category          => $category,
		whoami            => $whoami,
		tourn_settings    => $tourn_settings,
		nats_category     => $nats_category,
		eventsref         => $eventsref,
		childrenref       => $childrenref,
		categoriesref     => $categoriesref,
		jpoolsref         => $jpoolsref,
		jpool_settingsref => $jpool_settingsref,
	&>

	<div class="main">

		<h2><% $category ? $category->name : "Select A Group" %></h2>

		<& "tabbar.mas",
			category => $category,
			whoami   => $whoami,
			event    => $event,
			jpool    => $jpool,
			nsda     => $tourn_settings->{'nsda_nats'}
		&>

			<div>
				<span class="half nospace">
					<h4>Assign Judges to Rounds</h4>
				</span>
				<span class="half rightalign nospace">
					<h5 class='redtext'>For RRs, IEs and Congress only</h5>
				</span>
			</div>


			<div class="yellowrow semibold bluetext biggish padvert">
				Vital Statistics
			</div>

			<div class="row">

				<span class="half">

					<span class="threequarter">
						Events/Divisions
					</span>
					<span class="quarter">
						<% $category ? scalar $category->events : "" %>
					</span>

				</span>

				<span class="half">
					<span class="threequarter">
						Panels/Rooms
					</span>
					<span class="quarter">
						<% scalar $m->comp("/funclib/category_panels.mas", category => $category) %>
					</span>
				</span>

			</div>

			<div class="row">

				<span class="half" title="During timeslot <% $max_timeslot_name %> with <% $max_sections %> sections">
					<span class="threequarter">
						Max judges needed at one time
					</span>
					<span class="quarter">
						<% $max_judges %>
					</span>
				</span>

				<span class="half">
					<span class="threequarter">
						Timeslots
					</span>
					<span class="quarter">
						<% scalar @timeslots %>
					</span>
				</span>

			</div>

			<div class="yellowrow semibold bluetext biggish padvert martopmore">
				Repanel judge assignments:
			</div>


			<table>

				<tr class="row">

					<td class="rightalign">
						<label for="clear" class="hover">
							Erase existing assignments:
						</label>
					</td>

					<td>
						<form
							action = "category_judges.mhtml"
							method = "post"
						>

						<input
							type  = "hidden"
							name  = "category_id"
							value = "<% $category %>"
						>

						<input
							type    = "checkbox"
							id      = "clear"
							name    = "clear"
							value   = "1"
							checked = "checked"
						>
					</td>

				</tr>

				<tr class="row">

					<td class="rightalign">
						Minimum judges per panel
					</td>

					<td>
						<input
							type  = "number"
							min   = "1"
							max   = "99"
							size  = "5"
							name  = "panelsize"
							value = "1"
						>
					</td>

				</tr>


				<tr class="row">

					<td class="rightalign">
						Timeslot
					</td>

					<td>
						<select name="timeslot_id" class="fixedmed chosen">
							<option value="all">All</option>
%							foreach my $timeslot (@timeslots) {
								<option value="<% $timeslot->id %>"><% $timeslot->name %></option>
%							}
						</select>
					</td>

				</tr>

				<tr class="row">

					<td class="rightalign">
						Round Type
					</td>

					<td>
						<select name="round_type" class="fixedmed chosen">
							<option value="all">All</option>
							<option value="prelim">Prelim</option>
							<option value="elim">Elim</option>
							<option value="final">Final</option>
							<option value="runoff">Runoff</option>
						</select>
					</td>

				</tr>

				<tr class="liblrow">
					<td colspan="2" class="rightalign">
						<input type="submit" value="Reassign Judges">
						</form>
					</td>
				</tr>


			</table>



	</div>




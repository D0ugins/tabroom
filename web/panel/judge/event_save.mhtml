<%args>
	$tourn
	$person
	$event_id => undef
	$jpool_id => undef
</%args>
<%init>

	my $event = Tab::Event->retrieve($event_id);
	$m->abort unless $event->tourn->id == $tourn->id;

	foreach my $round (sort {$a->name <=> $b->name} $event->rounds) {

		if ($ARGS{"judges_".$round->id}) {
			$round->setting("num_judges", $ARGS{"judges_".$round->id});
		} else {
			$round->setting("num_judges", 1);
		}

		if ($ARGS{"target_".$round->id}) {
			$round->setting("panel_target", $ARGS{"target_".$round->id});
		} else {
			$round->setting("panel_target", 0);
		}

		if ($ARGS{"flighted_".$round->id}) {
			$round->flighted($ARGS{"flighted_".$round->id});
		} else {
			$round->flighted(1);
		}

		$round->update();

		my @rounds;
		next unless $ARGS{"jpool_".$round->id};

		if ($ARGS{"all_timeslot"}) {
			@rounds = $round->timeslot->rounds();
		} else {
			push @rounds, $round;
		}

		foreach my $oround (@rounds) {

			unless (Tab::JPoolRound->search({
				round => $oround,
				jpool => $ARGS{"jpool_".$round->id}
			})) {

				Tab::JPoolRound->create({
					round => $oround,
					jpool => $ARGS{"jpool_".$round->id}
				});
			}
		}

	}

	my $msg = $event->abbr." judge information saved";

	my $category = $event->category;

	$m->redirect("event.mhtml?jpool_id=".$jpool_id."&category_id=".$category."&event_id=".$event->id."&msg=$msg");

</%init>


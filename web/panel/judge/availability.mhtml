<%args>
	$tourn
	$perms
	$event_id   => undef
	$only_category => undef
	$category_id   => undef
</%args>
<%init>

	my ($eventref, $catref) = $m->comp(
		"/funclib/allowed_events.mas", 
		tourn => $tourn,
		perms => $perms,
		type  => "admin"
	);

	my @events = @{$eventref};
	my @categories = @{$catref};

	my $category = Tab::Category->retrieve($category_id);
	$category = $categories[0] 
		if @categories && (not defined $category);

	my $event = Tab::Event->retrieve($event_id) if $event_id;

	$event = $category->events->first if $category && (not defined $event);

</%init>

	<& "menu.mas",
		tourn         => $tourn,
		perms         => $perms,
		category      => $category,
		event         => $event,
		whoami        => "availability",
		only_category => $only_category 
	&>

	<div class="main">

		<h2><% $category->name %></h2>

%		if ($category) { 	
			<& "tabbar.mas",
				category => $category,
				event    => $event,
				whoami   => "availability"
			&>
%		}

%		if ($event) { 	
		
			<h4>Judge available in <% $event->abbr %></h4>

%			foreach my $round ($event->rounds) { 
	
				<div class="lightrow">

					<span class="half">
						<% $round->realname %>
					</span>

					<span class="half">
%						my @judge_avail = $m->comp("/funclib/judge_avail_by_rd.mas", round => $round);
						<% scalar @judge_avail %> judges
					</span>

				</div>

%			}

%		}

	</div>

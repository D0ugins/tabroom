<%args>
	$tourn
	$perms
	$tourn_settings
	$person
	$session
	$category_id   => undef
	$event_id      => undef
	$jpool_id      => undef
	$only_category => undef
</%args>
<%init>

	my ($event, $eventsref,
		$category, $categoriesref,
		$jpool, $jpoolsref, $jpool_settingsref,
		$childrenref) = $m->comp("pools.mas",
			tourn       => $tourn,
			nsda_nats   => $tourn_settings->{"nsda_nats"},
			perms       => $perms,
			jpool_id    => $jpool_id,
			event_id    => $event_id,
			category_id => $category_id,
			no_default  => 1
	);

	my $nats_category = $category->setting("nats_category") if $category;

	unless ($tourn_settings->{"nsda_nats"}) {
		undef $jpool unless $jpool_id;
		undef $event unless $event_id;
	}

	my @judges;
	my $nocodes;

	if ($jpool) {

		@judges = $m->comp( "/funclib/jpool_judges.mas", jpool => $jpool);

	} elsif ($event) {

		foreach my $jpool ($m->comp( "/funclib/event_jpools.mas", event => $event)) {
			push @judges, $m->comp(
				"/funclib/jpool_judges.mas",
				jpool => $jpool
			);
		}

	} elsif ($category) {

		@judges = $m->comp(
			"/funclib/category_judges.mas",
			category => $category
		);
	}

	if ($category) {
		$nocodes++ if $category->setting("no_codes");
	}

</%init>

%	if (${$perms}{"entry_only"}) {

		<& "/tabbing/entry/menu.mas",
			whoami         => "judges",
			session        => $session,
			tourn          => $tourn,
			perms          => $perms,
			person         => $person,
			entry_only     => 1,
			tourn_settings => $tourn_settings,
			perms          => $perms,
			noclose        => 1
		&>

%	}

	<& "menu.mas",
		tourn             => $tourn,
		event             => $event,
		jpool             => $jpool,
		perms             => $perms,
		category          => $category,
		whoami            => "activate",
		limited           => ${$perms}{"entry_only"},
		only_category     => $only_category,
		tourn_settings    => $tourn_settings,
		nats_category     => $nats_category,
		eventsref         => $eventsref,
		childrenref       => $childrenref,
		categoriesref     => $categoriesref,
		jpoolsref         => $jpoolsref,
		jpool_settingsref => $jpool_settingsref,
	&>

	<div class="main">

%		if ($category) {

%			my $tab_ratings = $category->setting("tab_ratings");

			<h2><% $category->name %></h2>

%			unless ($perms->{"limited"} || $perms->{'detailed'}) {
				<&
					"tabbar.mas",
					category => $category,
					whoami   => "activate",
					event    => $event,
					jpool    => $jpool
				&>
%			}

			<& "/funclib/tablesorter.mas",
				table => "category_judges"
			&>

			<span class="fourfifths nospace">
				<h5>Activate Judges</h5>
			</span>

			<span
				class = "fifth rightalign"
				id    = "category_judges_buttonarea"
			></span>


			<table id="category_judges">

				<thead>

					<tr class="yellowrow">

						<th class="smaller">
							<% $nocodes ? "School" : "Code" %>
						</th>

%						if ($tourn_settings->{"nsda_nats"}) {
							<th class="smaller">
								State
							</th>
%						}

%						if ($tab_ratings) {
							<th class="smaller">
								Rating
							</th>
%						}

						<th class="smaller">
							First
						</th>

						<th class="smaller">
							Last
						</th>

						<th class="smaller">
							Notes
						</th>

						<th class="smaller">
							Active
						</th>

					</tr>

				</thead>

				<tbody>

%				foreach my $judge (@judges) {

					<tr>

						<td class="smaller nowrap">
							<% $nocodes ? Tab::short_name($judge->schoolname) : $judge->code %>
						</td>

%						if ($tourn_settings->{"nsda_nats"}) {
							<td class="smaller nowrap">
								<% $judge->regioncode %>
							</td>
%						}

%						if ($tab_ratings) {
							<td class="smallish centeralign">
								<% $judge->setting("tab_rating") %>
							</td>
%						}

						<td class="smallish nospace">
							<a class="white padvert"
								href="/register/judge/edit.mhtml?judge_id=<% $judge->id %>"
							>
								<% $judge->first %>
							</a>
						</td>

						<td class="smallish nospace">
							<a class="white padvert"
								href="/register/judge/edit.mhtml?judge_id=<% $judge->id %>"
							>
								<% $judge->last %>
							</a>
						</td>

						<td class="smallish">
							<% $judge->setting('notes') %>
							<% $judge->setting('special_job') ? "(".$judge->setting('special_job').")" : "" %>
						</td>

						<td class="smallish centeralign padless">

							<span class="hidden">
								<% $judge->active ? "2" : "1" %>
							</span>

							<label class="switch">
								<input
									type          = "checkbox"
									value         = "1"
									id            = "<% $judge->id %>"
									property_name = "active"
									target_id     = "<% $judge->id %>"
									onChange      = "postSwitch( this, '/register/judge/judge_switch.mhtml');"
									<% $judge->active ? 'checked="checked"' : "" %>
								>
								<div class="slider"></div>
							</label>
						</td>

					</tr>
%				}

				</tbody>

			</table>

%		}

	</div>


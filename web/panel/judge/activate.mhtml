<%args>
	$tourn
	$category_id   => undef
	$only_category => undef
</%args>
<%init>

	my $category = Tab::Category->retrieve($category_id) if $category_id;

	$category = $only_category if $only_category;

	$category = $tourn->categories->first unless $category;

	my @judges;
	my $nocodes;

	if ($category) { 
		@judges = sort {$a->last cmp $b->last} $category->judges;
		$nocodes++ if $category->setting("no_codes");
	}


</%init>

    <script>

        function switchme(judgeid,state){
            $("#"+judgeid).iphoneSwitch(
                state,
                function() { $.post("active_switch.mhtml", { judge_id: judgeid, active: "1" }); },
                function() { $.post("active_switch.mhtml", { judge_id: judgeid }); }
            );
        };  

    </script>


	<& menu.mas, tourn => $tourn, category => $category, whoami => "activate", only_category => $only_category &>

	<div class="main">

%		if ($category) { 
	
%			my $tab_ratings = $category->setting("tab_ratings");
	
			<& /funclib/tablesorter.mas, table => "category_judges" &>

			<h2><% $category->name %></h2>
			
			<& tabbar.mas, category => $category, whoami => "activate" &>

			<table id="category_judges">

				<thead>

					<tr class="yellowrow">

						<th class="smaller">
							<% $nocodes ? "Code" : "Sch" %>
						</th>

%						if ($tab_ratings) { 
							<th class="smaller">
								Rating
							</th>
%						}

						<th class="smaller">
							First
						</th>

						<th class="smaller">
							Last
						</th>

						<th class="smaller">
							Notes
						</th>

						<th class="smaller">
							Active
						</th>

					</tr>

				</thead>

				<tbody>

%				foreach my $judge (@judges) { 

					<tr>

						<td class="smaller centeralign nowrap">
							<% $judge->school ? $judge->school->code : "Hire" %> <% $nocodes ? "" : $judge->code %>
						</td>

%						if ($tab_ratings) { 
							<td class="smallish centeralign">
								<% $judge->setting("tab_rating") %>
							</td>
%						}

						<td class="smallish">
							<a class="white" href="/register/judge/edit.mhtml?judge_id=<% $judge->id %>">
								<% $judge->first %>
							</a>
						</td>

						<td class="smallish">
							<a class="white" href="/register/judge/edit.mhtml?judge_id=<% $judge->id %>">
								<% $judge->last %>
							</a>
						</td>

						<td class="smallish">
							<% $judge->setting('notes') %>
							<% $judge->setting('special_job') ? "(".$judge->setting('special_job').")" : "" %>
						</td>

						<td class="smallish">
                            <span class="hidden">
                                <% $judge->active ? "1" : "2" %>
                            </span>
                            <script type="text/javascript"> 
                                $(function() { switchme(<% $judge->id %>,"<% ($judge->active) ? "on" : "off" %>"); });
                            </script>
                            <div class="phoneswitch" id="<% $judge->id %>"></div>
						</td>

					</tr>
%				}

				</tbody>

			</table>

%		}

	</div>


<%args>
	$tourn
	$tourn_settings
	$perms
	$person
	$session
	$category_id   => undef
	$only_category => undef
</%args>
<%init>

	my $category = Tab::Category->retrieve($category_id) if $category_id;

	$category = $only_category if $only_category;

	$category = $tourn->categories->first unless $category;

	my @judges;
	my $nocodes;

	if ($category) { 
		@judges = sort {$a->last cmp $b->last} $category->judges;
		$nocodes++ if $category->setting("no_codes");
	}

</%init>

%	if (${$perms}{"entry_only"}) { 

		<& "/tabbing/entry/menu.mas", 
			whoami         => "judges",
			session        => $session,
			tourn          => $tourn,
			person         => $person,
			entry_only     => 1,
			tourn_settings => $tourn_settings,
			perms          => $perms,
			noclose        => 1
		&>

%	} 

	<& "menu.mas",
		tourn         => $tourn,
		category      => $category,
		whoami        => "activate",
		limited       => ${$perms}{"entry_only"},
		only_category => $only_category,
	&>

	<div class="main">

%		if ($category) { 
	
%			my $tab_ratings = $category->setting("tab_ratings");
	
			<& /funclib/tablesorter.mas, table => "category_judges" &>

			<span class="fourfifth">
				<h4><% $category->name %></h4>
			</span>

			<span 
				class = "fifth rightalign"
				id    = "category_judges_buttonarea"
			></span>
			
%			if (${$perms}{"limited"}) { 
				<& 
					tabbar.mas, 
					category => $category, 
					whoami => "activate"
				&>
%			} 

			<table id="category_judges">

				<thead>

					<tr class="yellowrow">

						<th class="smaller">
							<% $nocodes ? "Code" : "Sch" %>
						</th>

%						if ($tab_ratings) { 
							<th class="smaller">
								Rating
							</th>
%						}

						<th class="smaller">
							First
						</th>

						<th class="smaller">
							Last
						</th>

						<th class="smaller">
							Notes
						</th>

						<th class="smaller">
							Active
						</th>

					</tr>

				</thead>

				<tbody>

%				foreach my $judge (@judges) { 

					<tr>

						<td class="smaller centeralign nowrap">
							<% $judge->school 
								? $judge->school->code 
								: "Hire" 
							%> <% $nocodes ? "" : $judge->code %>
						</td>

%						if ($tab_ratings) { 
							<td class="smallish centeralign">
								<% $judge->setting("tab_rating") %>
							</td>
%						}

						<td class="smallish nospace">
							<a class="white padvert" 
								href="/register/judge/edit.mhtml?judge_id=<% $judge->id %>"
							>
								<% $judge->first %>
							</a>
						</td>

						<td class="smallish nospace">
							<a class="white padvert" 
								href="/register/judge/edit.mhtml?judge_id=<% $judge->id %>"
							>
								<% $judge->last %>
							</a>
						</td>

						<td class="smallish">
							<% $judge->setting('notes') %>
							<% $judge->setting('special_job') ? "(".$judge->setting('special_job').")" : "" %>
						</td>

						<td class="smallish centeralign padless">

							<span class="hidden">
								<% $judge->active ? "2" : "1" %>
							</span> 

							<label class="switch">
								<input 
									type          = "checkbox"
									value         = "1"
									id            = "<% $judge->id %>" 
									property_name = "active"
									target_id     = "<% $judge->id %>" 
									onChange      = "postSwitch( this, '/register/judge/judge_switch.mhtml');"
									<% $judge->active ? 'checked="checked"' : "" %>
								>
								<div class="slider"></div>
							</label>
						</td>

					</tr>
%				}

				</tbody>

			</table>

%		}

	</div>


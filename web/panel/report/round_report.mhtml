<%args>
	$round_id => undef
	$person
	$session
	$tourn
	$tourn_settings
</%args>
<%init>
	use POSIX;

	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;

    my $now = DateTime->now;    
    $now->set_time_zone($tz);

	my $round = Tab::Round->retrieve($round_id);

	my $event = $round->event;

    my $event_name = $round->event->abbr;
    $event_name =~ s/[\W_]//g;

    my $round_name = $round->realname;
    $round_name =~ s/[\W_]//g;

	my $filename = "ChamberLists-$event_name-$round_name";
    my $filepath = $Tab::file_root."tmp/".$filename;

    `rm -f $filepath.*`;

    $m->comp("/funclib/printout.mas", 
        tourn    => $tourn,
        filename => $filename,
		array    => 1.5,
        head     => 1
    );  

    open (TEXOUT, ">>$filepath.tex");

	my @panels = $m->comp("/funclib/round_panels.mas", round => $round);

	my $notfirst;

	foreach my $panel (@panels) { 

		if ($notfirst++) { 
			print TEXOUT "\\newpage\n";
		}

		print TEXOUT  "{\\bf \\Large ".Tab::texify($event->name);
		print TEXOUT  " \\hfill \n";
		print TEXOUT  Tab::texify($round->realname)." chamber roster } \n";

		print TEXOUT "\\medskip\n";
		print TEXOUT "\\newline\n";

		print TEXOUT "\\strut\n";
		print TEXOUT "\\hfill\n";

		if ($event->type eq "speech") { 
			print TEXOUT "{\\bf \\huge Section ".$panel->letter." } \n";
		} else { 
			print TEXOUT "{\\bf \\huge Chamber ".$panel->letter." } \n";
		}

		print TEXOUT "\\hfill\n";
		print TEXOUT "\\strut\n";

		print TEXOUT "\\smallskip\n";
		print TEXOUT "\\newline\n";

		print TEXOUT "\\strut\n";
		print TEXOUT "\\hfill\n ";
		print TEXOUT "{\\large ".Tab::texify($panel->roomname)." } ";
		print TEXOUT " \\hfill\n";
		print TEXOUT "\\strut\n";

		print TEXOUT "\\smallskip\n";
		print TEXOUT "\\newline\n";


		my @entries = $m->comp(
			"/funclib/panel_entries.mas", 
			panel => $panel
		);

		my @judges = $m->comp(
			"/funclib/panel_judges.mas", 
			panel => $panel
		);

		print TEXOUT "\\footnotesize\n";

		print TEXOUT "\\begin{tabular}{p{.5in}p{1.5in}p{2in}p{.3in}p{1.5in}p{.3in}}\n";

		print TEXOUT "\\rowcolor[rgb]{1,.95,.74}[5.5pt][5.5pt]\n";
		print TEXOUT "{\\bf Code }  &  {\\bf Name }  &  {\\bf School }  &  {\\bf DCode }  &  {\\bf District }  &  {\\bf State } \\\\ \n";

		my $switch;

		foreach my $entry (@entries) { 

			print TEXOUT "\\rowcolor[rgb]{.91,.91,.91}\[5.5pt\]\[5.5pt\] \n" unless $switch++ % 2;

			print TEXOUT Tab::texify($entry->code)." & ";
			print TEXOUT Tab::texify($entry->name)." & ";
			print TEXOUT Tab::texify($entry->schoolname)." & ";
			print TEXOUT Tab::texify($entry->districtcode)." & ";
			print TEXOUT Tab::texify($entry->districtname)." & ";
			print TEXOUT Tab::texify($entry->state)." \\\\ \n";

		}

		undef $switch;

		print TEXOUT "\\multicolumn{6}{l}{ } \\\\ \n";
		print TEXOUT "\\multicolumn{6}{l}{\\smallskip \\newline \\bf \\large Judges : } \\\\ \n";

		foreach my $judge (@judges) { 

			print TEXOUT "\\rowcolor[rgb]{.91,.91,.91}\[5.5pt\]\[5.5pt\] \n" unless $switch++ % 2;
			print TEXOUT Tab::texify($judge->code)." & ";
			print TEXOUT Tab::texify($judge->first." ".$judge->last)." & ";
			print TEXOUT Tab::texify($judge->schoolname)." & ";
			print TEXOUT Tab::texify($judge->districtcode)." & ";
			print TEXOUT Tab::texify($judge->districtname)." & ";
			print TEXOUT Tab::texify($judge->state)." \\\\ \n";
		}

		print TEXOUT "\\end{tabular}\n";

	}

    $m->comp("/funclib/printout.mas", 
        tourn    => $tourn,
        filename => $filename,
      	tail     => 1
    );  


</%init>


<%args>
	$person
	$room_id  => undef
	$rpool_id => undef
	$value    => undef
</%args>
<%init>

	$m->clear_buffer();
	$r->content_type('application/json');

	unless ($room_id) { 
		$m->print('{ "error": true, "message": "No room ID sent"}');
		$m->abort();
	}

	unless ($rpool_id) { 
		$m->print('{ "error": true, "message": "No room pool ID sent"}');
		$m->abort();
	}

	my $existing = Tab::RPoolRoom->search( 
		room  => $room_id,
		rpool => $rpool_id
	)->first;

	my $message;

	if ($value == 1) { 

		eval { 
			$existing = Tab::RPoolRoom->create({
				room  => $room_id,
				rpool => $rpool_id
			}) unless $existing;
		};

		if ($existing) { 
			$message = "Room $room_id added to pool";
		}

	} else { 
			
		$existing->delete() if $existing;
		$message = "Room removed from pool";
	}

	$m->print('{ "error": false, "message": "'.$message.'"}');

	$m->abort();

</%init>

